if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,p.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,p.getString("id"),!0,!0,!0,!0,!0)}function o(e){V.remove(e,function(){V.add(e),V.hide(e),V.createFramePlayer(e,f,g)})}function i(e){g=e,V=new RiseVision.VideoFolder.FrameController,V.add(0),y=0,R=1,V.createFramePlayer(0,f,g)}function r(e){var t,n=V.getFrameObject(y),i=0===y?1:0;g=e,n&&(f.video.controls||(t=n.getPlaybackData(),t.total===t.index+1?t.duration-t.position>=15&&o(i):o(i)))}function a(){var e=V.getFrameObject(y);e&&e.pause()}function s(){var e=V.getFrameObject(y);h?t():e?e.play():(y=0===y?1:0,e=V.getFrameObject(y),e.play(),V.add(0===y?1:0),V.hide(0===y?1:0),V.createFramePlayer(0===y?1:0,f,g))}function c(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(f=JSON.parse(n[0]),p=new e.Prefs,document.getElementById("videoContainer").style.height=p.getInt("rsH")+"px",f.width=p.getInt("rsW"),f.height=p.getInt("rsH"),v=new RiseVision.VideoFolder.Storage(f),v.init())}function d(){h?(V.remove(y),V.remove(0===y?1:0),t()):(V.show(0===y?1:0),V.remove(y,function(){t()}))}function l(){F||(2===R?(F=!0,n()):(V.add(1),V.hide(1),R=2,V.createFramePlayer(1,f,g)))}function u(e){console.debug("video-folder::playerError()",e),F?"setup"===e.type||0===e.index?h=!0:d():V.remove(y)}function m(){a()}var f,g,y,p=null,v=null,V=null,F=!1,h=!1,R=0;return{onStorageInit:i,onStorageRefresh:r,pause:a,play:s,setAdditionalParams:c,playerEnded:d,playerReady:l,playerError:u,stop:m}}(gadgets);var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),t.go())}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.FrameController=function(){"use strict";function e(e){var t,n,o=document.getElementById(s+e);try{t=o.querySelector("iframe"),n=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument,n.remove(),t.setAttribute("src","about:blank")}catch(i){console.debug(i)}}function t(e){var t,n;t=document.getElementById(s+e),n=document.createElement("iframe"),n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),t.appendChild(n)}function n(e,t,n){var o,i=document.getElementById(s+e);o=i.querySelector("iframe"),o&&(o.onload=function(){o.onload=null;var e=o.contentWindow?o.contentWindow:o.contentDocument.document?o.contentDocument.document:o.contentDocument;e.init(t,n,config.SKIN),e.load()},o.setAttribute("src","player.html"))}function o(e){var t,n=document.getElementById(s+e);return t=n.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function i(e){document.getElementById(s+e).style.visibility="hidden"}function r(t,n){var o=document.getElementById(s+t);e(t),setTimeout(function(){for(;o.firstChild;)o.removeChild(o.firstChild);n&&"function"==typeof n&&n()},200)}function a(e){document.getElementById(s+e).style.visibility="visible"}var s="if_";return{add:t,createFramePlayer:n,getFrameObject:o,hide:i,remove:r,show:a}},function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlb0ZvbGRlciIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfcmVmcmVzaEZyYW1lIiwiZnJhbWVJbmRleCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJhZGQiLCJoaWRlIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJfYWRkaXRpb25hbFBhcmFtcyIsIl9jdXJyZW50RmlsZXMiLCJvblN0b3JhZ2VJbml0IiwidXJscyIsIkZyYW1lQ29udHJvbGxlciIsIl9jdXJyZW50RnJhbWUiLCJfZnJhbWVDb3VudCIsIm9uU3RvcmFnZVJlZnJlc2giLCJjdXJyZW50RnJhbWVEYXRhIiwiY3VycmVudEZyYW1lT2JqIiwiZ2V0RnJhbWVPYmplY3QiLCJoaWRkZW5GcmFtZUluZGV4IiwidmlkZW8iLCJjb250cm9scyIsImdldFBsYXliYWNrRGF0YSIsInRvdGFsIiwiaW5kZXgiLCJkdXJhdGlvbiIsInBvc2l0aW9uIiwicGF1c2UiLCJmcmFtZU9iaiIsInBsYXkiLCJfcGxheWJhY2tFcnJvciIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIkpTT04iLCJwYXJzZSIsIlByZWZzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiaGVpZ2h0IiwiZ2V0SW50Iiwid2lkdGgiLCJfc3RvcmFnZSIsIlN0b3JhZ2UiLCJpbml0IiwicGxheWVyRW5kZWQiLCJzaG93IiwicGxheWVyUmVhZHkiLCJfaW5pdGlhbGl6ZWQiLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiY29uc29sZSIsImRlYnVnIiwidHlwZSIsInN0b3AiLCJkYXRhIiwic3RvcmFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGV0YWlsIiwiZmlsZXMiLCJmb3JFYWNoIiwiZmlsZSIsInB1c2giLCJ1cmwiLCJfaW5pdGlhbExvYWQiLCJzZXRBdHRyaWJ1dGUiLCJjb21wYW55SWQiLCJmb2xkZXIiLCJnbyIsIl9jbGVhciIsImlmcmFtZSIsImZyYW1lQ29udGFpbmVyIiwiUFJFRklYIiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnRXaW5kb3ciLCJjb250ZW50RG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJwYXJhbXMiLCJvbmxvYWQiLCJsb2FkIiwidmlzaWJpbGl0eSIsImNhbGxiYWNrIiwic2V0VGltZW91dCIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsImdhIiwiYXN5bmMiLCJzcmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBRUEsR0FBc0IsbUJBQVhBLFFBQXdCLENBQ2pDLEdBQUlBLFNBQ0ZDLEtBQU0sa0JBR2Usb0JBQVpDLFVBQ1RBLFFBQVFDLE9BQU8sb0NBQ1pDLFNBQVMsaUJBQWtCLHdCQUMzQkEsU0FBUyxnQkFBaUIsU0FNakMsR0FBSUMsWUFBYUEsY0FDakJBLFlBQVdDLGVBRVhELFdBQVdDLFlBQWMsU0FBV0MsR0FDbEMsWUFrQkEsU0FBU0MsS0FDUEQsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGVBQWdCLEtBQU1DLEVBQU9DLFVBQVUsT0FHOUQsUUFBU0MsS0FDUE4sRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGdCQUFpQixLQUFNQyxFQUFPQyxVQUFVLE9BQzNELEdBQU0sR0FBTSxHQUFNLEdBQU0sR0FHNUIsUUFBU0UsR0FBY0MsR0FDckJDLEVBQWlCQyxPQUFP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LEdBQUloRSxTQUFTaUUscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVIsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICBTS0lOOiBcInNraW4vUlZTa2luLnhtbFwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbiAgfVxufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0ge307XG5cblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSAoZnVuY3Rpb24gKGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hZGRpdGlvbmFsUGFyYW1zO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbCxcbiAgICBfZnJhbWVDb250cm9sbGVyID0gbnVsbDtcblxuICB2YXIgX2luaXRpYWxpemVkID0gZmFsc2UsXG4gICAgX3BsYXliYWNrRXJyb3IgPSBmYWxzZTtcblxuICB2YXIgX2N1cnJlbnRGaWxlcywgX2N1cnJlbnRGcmFtZTtcblxuICB2YXIgX2ZyYW1lQ291bnQgPSAwO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoRnJhbWUoZnJhbWVJbmRleCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKGZyYW1lSW5kZXgsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKGZyYW1lSW5kZXgpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKGZyYW1lSW5kZXgpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcihmcmFtZUluZGV4LCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gICAgfSk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJscykge1xuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLkZyYW1lQ29udHJvbGxlcigpO1xuXG4gICAgLy8gYWRkIHRoZSBmaXJzdCBmcmFtZSBhbmQgY3JlYXRlIGl0cyBwbGF5ZXJcbiAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgwKTtcbiAgICBfY3VycmVudEZyYW1lID0gMDtcbiAgICBfZnJhbWVDb3VudCA9IDE7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gIH1cblxuICBmdW5jdGlvbiBvblN0b3JhZ2VSZWZyZXNoKHVybHMpIHtcbiAgICB2YXIgY3VycmVudEZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKSxcbiAgICAgIGhpZGRlbkZyYW1lSW5kZXggPSAoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCxcbiAgICAgIGN1cnJlbnRGcmFtZURhdGE7XG5cbiAgICBfY3VycmVudEZpbGVzID0gdXJscztcblxuICAgIC8vIEl0IGlzIGJlc3QgdG8gbGV0IHJlZnJlc2hpbmcgdGhlIGZyYW1lIHBsYXlsaXN0IGhhcHBlbiBpbiB0aGUgbm9ybWFsIGN5Y2xlIG9mIGZyYW1lIHN3YXBwaW5nIChwbGF5bGlzdCBjb21wbGV0aW9uKVxuICAgIC8vIEJlbG93IGlzIHRoZSBvbmx5IGNyaXRlcmlhIGZvciBzYWZlbHkgZm9yY2luZyBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIHdoaWxlIFdpZGdldCBpcyBpbiBhIFwicGxheVwiIG9yIFwicGF1c2VcIiBzdGF0ZVxuXG4gICAgLy8gV2lkZ2V0IGlzIGluIGEgc3RhdGUgb2YgXCJwbGF5XCIgb3IgXCJwYXVzZVwiIGFuZCBwbGF5bGlzdCBoYXMgbm90IGNvbXBsZXRlZC4gQSBoaWRkZW4gZnJhbWUgZGVmaW5pdGVseSBleGlzdHNcbiAgICBpZiAoY3VycmVudEZyYW1lT2JqKSB7XG4gICAgICAvLyBPbmx5IGlmIHRoZXJlIGFyZSBubyB2aWRlbyBjb250cm9scy5cbiAgICAgIC8vIFVzZXIgaW50ZXJhY3Rpbmcgd2l0aCBjb250cm9scywgcGFydGljdWxhcmx5IHNlZWtpbmcgYW5kIHNraXBwaW5nIHZpZGVvcywgd291bGQgY2F1c2UgaXNzdWVzXG4gICAgICBpZiAoIV9hZGRpdGlvbmFsUGFyYW1zLnZpZGVvLmNvbnRyb2xzKSB7XG4gICAgICAgIGN1cnJlbnRGcmFtZURhdGEgPSBjdXJyZW50RnJhbWVPYmouZ2V0UGxheWJhY2tEYXRhKCk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZURhdGEudG90YWwgPT09IChjdXJyZW50RnJhbWVEYXRhLmluZGV4ICsgMSkpIHtcbiAgICAgICAgICAvLyBUbyBiZSBzYWZlLCBvbmx5IHJlZnJlc2ggdGhlIGZyYW1lIHRoYXQncyBjdXJyZW50bHkgaGlkZGVuIGlmIGF0IGxlYXN0IDE1IHNlY29uZHMgYXJlIGxlZnQgb2YgZmluYWwgdmlkZW9cbiAgICAgICAgICBpZiAoKGN1cnJlbnRGcmFtZURhdGEuZHVyYXRpb24gLSBjdXJyZW50RnJhbWVEYXRhLnBvc2l0aW9uKSA+PSAxNSkge1xuICAgICAgICAgICAgX3JlZnJlc2hGcmFtZShoaWRkZW5GcmFtZUluZGV4KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ3VycmVudCBmcmFtZSBpcyBub3QgcGxheWluZyBsYXN0IHZpZGVvIGluIGxpc3QsIHNhZmUgdG8gcmVmcmVzaCB0aGUgZnJhbWUgdGhhdCdzIGN1cnJlbnRseSBoaWRkZW5cbiAgICAgICAgICBfcmVmcmVzaEZyYW1lKGhpZGRlbkZyYW1lSW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBmcmFtZU9iai5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmICghX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgICBmcmFtZU9iai5wbGF5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBzZXQgY3VycmVudCBmcmFtZSB0byBiZSB0aGUgb25lIHZpc2libGVcbiAgICAgICAgX2N1cnJlbnRGcmFtZSA9IChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwO1xuXG4gICAgICAgIC8vIHBsYXkgdGhlIGN1cnJlbnQgZnJhbWUgdmlkZW9cbiAgICAgICAgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuICAgICAgICBmcmFtZU9iai5wbGF5KCk7XG5cbiAgICAgICAgLy8gcmUtYWRkIHByZXZpb3VzbHkgcmVtb3ZlZCBmcmFtZSBhbmQgY3JlYXRlIHRoZSBwbGF5ZXIsIGJ1dCBoaWRlIHZpc2liaWxpdHlcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuaGlkZSgoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdvdCBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgZmlyc3QgdmlkZW9cbiAgICAgIC8vIFNlbmQgVmlld2VyIFwiZG9uZVwiXG4gICAgICBfZG9uZSgpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKSArIFwicHhcIjtcblxuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIik7XG5cbiAgICAgICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBTdG9yYWdlIG1vZHVsZSBpbnN0YW5jZVxuICAgICAgICBfc3RvcmFnZSA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgICBfc3RvcmFnZS5pbml0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRW5kZWQoKSB7XG4gICAgaWYgKF9wbGF5YmFja0Vycm9yKSB7XG4gICAgICAvLyBUaGlzIGZsYWcgb25seSBnZXRzIHNldCB1cG9uIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgYW5kIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBzZXR1cCBvciBmaXJzdCB2aWRlb1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZSgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCk7XG5cbiAgICAgIF9kb25lKCk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5zaG93KChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX2RvbmUoKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7XG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIGlmIChfZnJhbWVDb3VudCA9PT0gMikge1xuICAgICAgICAvLyBib3RoIGZyYW1lcyBoYXZlIGJlZW4gY3JlYXRlZCBhbmQgbG9hZGVkLCBjYW4gbm90aWZ5IFZpZXdlciB3aWRnZXQgaXMgcmVhZHlcbiAgICAgICAgX2luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgX3JlYWR5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBmaXJzdCBmcmFtZSBwbGF5ZXIgd2FzIHN1Y2Nlc3NmdWwgYW5kIHJlYWR5LCBjcmVhdGUgdGhlIHNlY29uZCBvbmUgYnV0IGhpZGUgaXRcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoMSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuaGlkZSgxKTtcbiAgICAgICAgX2ZyYW1lQ291bnQgPSAyO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKDEsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIFdpZGdldCBoYXMgbm90IHNlbnQgXCJyZWFkeVwiIHlldCBhbmQgdGhlcmUgaXMgYW4gZXJyb3IgKHNldHVwIG9yIHBsYXliYWNrIG9mIGZpcnN0IHZpZGVvLCBkb2Vzbid0IG1hdHRlciB3aGljaClcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUpO1xuXG4gICAgICAvLyBkbyBub3RoaW5nIG1vcmUsIGVuc3VyZSBcInJlYWR5XCIgaXMgbm90IHNlbnQgdG8gVmlld2VyIHNvIHRoYXQgdGhpcyB3aWRnZXQgY2FuIGJlIHNraXBwZWRcblxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZXJyb3IudHlwZSA9PT0gXCJzZXR1cFwiIHx8IGVycm9yLmluZGV4ID09PSAwKSB7XG4gICAgICAgIC8vIFRoaXMgb25seSBoYXBwZW5zIGluIHRoZSBldmVudCBvZiBhIHJlZnJlc2guIE5ldyBmaWxlcyBjYXVzZWQgYW4gZXJyb3IgaW4gc2V0dXAgb3IgZmlyc3QgdmlkZW8gaGFzIGFuIGlzc3VlXG4gICAgICAgIC8vIFRoZSBlcnJvciBldmVudCB3aWxsIGJlIGNvbWluZyBmcm9tIHRoZSBjdXJyZW50bHkgaGlkZGVuIGZyYW1lIHdoZW4gaXQgZ290IHJlY3JlYXRlZCB3aXRoIG5ldyBmaWxlcyB0byB1c2VcbiAgICAgICAgX3BsYXliYWNrRXJyb3IgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZm9yY2Ugd2lkZ2V0IHRvIGFjdCBhcyB0aG91Z2ggdGhlIHBsYXlsaXN0IGlzIGRvbmVcbiAgICAgICAgcGxheWVyRW5kZWQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJvblN0b3JhZ2VJbml0XCI6IG9uU3RvcmFnZUluaXQsXG4gICAgXCJvblN0b3JhZ2VSZWZyZXNoXCI6IG9uU3RvcmFnZVJlZnJlc2gsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllckVuZGVkXCI6IHBsYXllckVuZGVkLFxuICAgIFwicGxheWVyUmVhZHlcIjogcGxheWVyUmVhZHksXG4gICAgXCJwbGF5ZXJFcnJvclwiOiBwbGF5ZXJFcnJvcixcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgfHwge307XG5cblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuU3RvcmFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfaW5pdGlhbExvYWQgPSB0cnVlO1xuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Gb2xkZXJTdG9yYWdlXCIpO1xuXG4gICAgaWYgKCFzdG9yYWdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciB1cmxzID0gW107XG5cbiAgICAgIGlmIChlLmRldGFpbCAmJiBlLmRldGFpbC5maWxlcyAmJiBlLmRldGFpbC5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGUuZGV0YWlsLmZpbGVzLmZvckVhY2goZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgIHVybHMucHVzaChmaWxlLnVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChfaW5pdGlhbExvYWQpIHtcbiAgICAgICAgICBfaW5pdGlhbExvYWQgPSBmYWxzZTtcblxuICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIub25TdG9yYWdlSW5pdCh1cmxzKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIub25TdG9yYWdlUmVmcmVzaCh1cmxzKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLnN0b3JhZ2UuY29tcGFueUlkKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnN0b3JhZ2UuZm9sZGVyKTtcblxuICAgIHN0b3JhZ2UuZ28oKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgfHwge307XG5cblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuRnJhbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUFJFRklYID0gXCJpZl9cIjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCksXG4gICAgICBpZnJhbWUsIGZyYW1lT2JqO1xuXG4gICAgdHJ5IHtcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG4gICAgICBmcmFtZU9iaiA9IChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiYWJvdXQ6YmxhbmtcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmRlYnVnKGUpO1xuICAgIH1cblxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciwgaWZyYW1lO1xuXG4gICAgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG5cbiAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwgXCIwXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIiwgXCJub1wiKTtcblxuICAgIGZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVGcmFtZVBsYXllcihpbmRleCwgcGFyYW1zLCBmaWxlcykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZnJhbWUub25sb2FkID0gbnVsbDtcblxuICAgICAgICB2YXIgZnJhbWVPYmogPSAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxuICAgICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxuICAgICAgICBmcmFtZU9iai5pbml0KHBhcmFtcywgZmlsZXMsIGNvbmZpZy5TS0lOKTtcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xuICAgICAgfTtcblxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcInBsYXllci5odG1sXCIpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0RnJhbWVPYmplY3QoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgaWYgKGlmcmFtZSkge1xuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gaGlkZShpbmRleCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KS5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG5cbiAgICBfY2xlYXIoaW5kZXgpO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcbiAgICAgIHdoaWxlIChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIGZyYW1lQ29udGFpbmVyLnJlbW92ZUNoaWxkKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhpbmRleCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KS5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZDogYWRkLFxuICAgIGNyZWF0ZUZyYW1lUGxheWVyOiBjcmVhdGVGcmFtZVBsYXllcixcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXG4gICAgaGlkZTogaGlkZSxcbiAgICByZW1vdmU6IHJlbW92ZSxcbiAgICBzaG93OiBzaG93XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbHltZXJSZWFkeSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTQnXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9