function doneEvent(){parent.RiseVision.VideoFolder.playerEnded()}function readyEvent(){parent.RiseVision.VideoFolder.playerReady()}function errorEvent(e){parent.RiseVision.VideoFolder.playerError(e)}function loadVideo(e,t,n,o,i,r,a){width=e,height=t,volume=n,autoPlay=o,scaleToFit=i,pauseDuration=r,files=a.split(","),player&&player.loadVideo()}function play(){player.play()}function pause(){player.pause()}function stop(){player.stop()}function remove(){player.remove()}function PlayerJW(){function e(e){var t,n=[".mp4",".webm",".ogg",".ogv"],o=e.toLowerCase(),i=null;for(t=0;t<=n.length;t+=1)if(-1!==o.indexOf(n[t])){i=n[t].substr(n[t].lastIndexOf(".")+1);break}return"ogv"===i&&(i="ogg"),i}function t(){for(var t=[],n=0;n<files.length;n+=1)t.push({sources:[{file:files[n],type:e(files[n])}]});return t}function n(){doneEvent()}function o(){isLoading?(isLoading=!1,jwplayer().pause(),jwplayer().setMute(!1),jwplayer().setVolume(volume),readyEvent()):(pauseHandlerOn||(pauseHandlerOn=!0,jwplayer().onPause(function(){i()})),clearTimeout(pauseTimer))}function i(){viewerPaused||isLoading||(clearTimeout(pauseTimer),pauseTimer=setTimeout(function(){jwplayer().play(),jwplayer().setControls(!1),jwplayer().setControls(!0)},1e3*pauseDuration))}function r(e){e&&errorEvent({type:"video",index:jwplayer().getPlaylistIndex(),message:e.message})}function a(e){e&&errorEvent({type:"setup",index:0,message:e.message})}this.loadVideo=function(){jwplayer("player").setup({playlist:t(),width:width,height:height,controls:!autoPlay,stretching:scaleToFit?"uniform":"none"}),jwplayer().onSetupError(function(e){a(e)}),jwplayer().onReady(function(){var e,t=document.getElementById("player").getElementsByTagName("*"),i=t.length;for(e=0;i>e;e+=1)t[e].className+=" notransition";document.getElementById("player").className+=" notransition",jwplayer().onPlaylistComplete(function(){n()}),jwplayer().onPlay(function(){o()}),jwplayer().onError(function(e){r(e)}),setTimeout(function(){jwplayer().play()},200)})},this.play=function(){viewerPaused=!1,autoPlay&&jwplayer().play()},this.pause=function(){viewerPaused=!0,clearTimeout(pauseTimer),jwplayer().pause()},this.stop=function(){this.pause()},this.remove=function(){viewerPaused=!1,clearTimeout(pauseTimer),pauseTimer=null,jwplayer().remove()}}if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","http://storage-stage-rva-test.risevision.com/modal.html"))}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,V.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,V.getString("id"),!0,!0,!0,!0,!0)}function o(){var e=document.querySelector("#videoContainer iframe");return e?e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument:null}function i(){for(var e=document.getElementById("videoContainer");e.firstChild;)e.removeChild(e.firstChild)}function r(){var e=o();e&&(e.remove(),e.location.reload())}function a(){var e,t=document.getElementById("videoContainer");e=document.createElement("iframe"),e.setAttribute("allowTransparency",!0),e.setAttribute("frameborder","0"),e.setAttribute("scrolling","no"),t.appendChild(e)}function s(){R=new RiseVision.VideoFolder.Storage(h),R.init()}function l(){var e=RiseVision.VideoFolder.Template.getHTML(h,w),t=o();t&&(t.document.open(),t.document.write(e),t.document.close())}function c(e){w=e,a(),l()}function u(){}function d(){var e=o();e&&e.pause()}function p(){var e=o();e?e.play():(a(),l())}function m(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(h=JSON.parse(n[0]),V=new e.Prefs,document.getElementById("videoContainer").style.height=V.getInt("rsH")+"px",h.width=V.getInt("rsW"),h.height=V.getInt("rsH"),b=new RiseVision.Common.Background(h),b.init(s))}function g(){r(),setTimeout(function(){i(),t()},200)}function f(){k?p():(k=!0,n())}function y(e){console.debug("video-folder::playerError()",e),k?g():(r(),i())}function v(){d()}var h,w,V=null,b=null,R=null,k=!1;return{onStorageInit:c,onStorageRefresh:u,pause:d,play:p,setAdditionalParams:m,playerEnded:g,playerReady:f,playerError:y,stop:v}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){s.style.backgroundImage="url("+e.background.image.url+d+"cb="+(new Date).getTime()+")",t()},c)}function n(){a=!0,e.background.useImage&&!u&&t(),r&&"function"==typeof r&&r()}function o(){var t;s=document.getElementById("background"),l=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,s?e.background.useImage?(s.className=e.background.image.position,s.className=e.background.image.scale?s.className+" scale-to-fit":s.className,u=0!==Object.keys(e.backgroundStorage).length,u?l?(l.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.files&&e.detail.files.length>0&&(s.style.backgroundImage="url("+e.detail.files[0].url+")"),a||n()}),l.setAttribute("folder",e.backgroundStorage.folder),l.setAttribute("fileName",e.backgroundStorage.fileName),l.setAttribute("companyId",e.backgroundStorage.companyId),l.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),d=1===t.length?"?":"&",s.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function i(e){a?e&&"function"==typeof e&&e():(e&&(r=e),o())}var r=null,a=!1,s=null,l=null,c=9e5,u=!1,d="";return{init:i}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage"),o="",i="";if(t){switch(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),e.order){case"alpha-asc":o="name",i="asc";break;case"alpha-desc":o="name",i="desc";break;case"date-asc":o="date",i="asc";break;case"date-desc":o="date",i="desc";break;case"random":o="random";break;default:o="name",i="asc"}t.setAttribute("sort",o),t.setAttribute("sortDirection",i),t.go()}}var n=!0;return{init:t}};var files,volume,autoPlay,scaleToFit,pauseDuration,width,height,isLoading=!0,pauseHandlerOn=!1,viewerPaused=!1,pauseTimer=null,player=null,RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Template=function(){"use strict";function e(e,n){var o=t;return o=o.replace("%s1",e.width+"px"),o=o.replace("%s2",e.height+"px"),o=o.replace("%s3",e.video.volume),o=o.replace("%s4",e.video.autoplay),o=o.replace("%s5",e.video.scaleToFit),o=o.replace("%s6",e.pause),o=o.replace("%s7",n.join())}var t='<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title></title><script type="text/javascript" src="//s3.amazonaws.com/rise-common/scripts/jw-player/jwplayer.js"></script><script>jwplayer.key="xBXyUtAJ+brFzwc2kNhDg/Sqk8W7rmktAYliYHzVgxo="</script><script type="text/javascript" src="js/player.min.js"></script><style>	body { 		background-color: transparent; 		-moz-user-select: none; 		-webkit-user-select: none; 		-khtml-user-select: none; 		user-select: none; 	} .notransition {    -webkit-transition: none !important;    transition: none !important;  }</style></head><body style="margin:0px;"><div id="player">Loading the player...</div><script language="javascript">	window.oncontextmenu = function() {		return false;	};	try {		player = new PlayerJW();		loadVideo("%s1", "%s2", %s3, %s4, %s5, %s6, "%s7");	} catch (e) {		console.log(e.message);		parent.RiseVision.VideoFolder.playerError();	}</script></body></html>';return{getHTML:e}}(),function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiZG9uZUV2ZW50IiwicGFyZW50IiwiUmlzZVZpc2lvbiIsIlZpZGVvRm9sZGVyIiwicGxheWVyRW5kZWQiLCJyZWFkeUV2ZW50IiwicGxheWVyUmVhZHkiLCJlcnJvckV2ZW50IiwiZGF0YSIsInBsYXllckVycm9yIiwibG9hZFZpZGVvIiwid2lkdGhQYXJhbSIsImhlaWdodFBhcmFtIiwidm9sdW1lUGFyYW0iLCJhdXRvUGxheVBhcmFtIiwic2NhbGVUb0ZpdFBhcmFtIiwicGF1c2VQYXJhbSIsImZpbGVzUGFyYW0iLCJ3aWR0aCIsImhlaWdodCIsInZvbHVtZSIsImF1dG9QbGF5Iiwic2NhbGVUb0ZpdCIsInBhdXNlRHVyYXRpb24iLCJmaWxlcyIsInNwbGl0IiwicGxheWVyIiwicGxheSIsInBhdXNlIiwic3RvcCIsInJlbW92ZSIsIlBsYXllckpXIiwiZ2V0VmlkZW9GaWxlVHlwZSIsInVybCIsImkiLCJleHRlbnNpb25zIiwidXJsTG93ZXJjYXNlIiwidG9Mb3dlckNhc2UiLCJ0eXBlIiwibGVuZ3RoIiwiaW5kZXhPZiIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwiZ2V0UGxheWxpc3QiLCJwbGF5bGlzdCIsInB1c2giLCJzb3VyY2VzIiwiZmlsZSIsIm9uUGxheWxpc3RDb21wbGV0ZSIsIm9uUGxheSIsImlzTG9hZGluZyIsImp3cGxheWVyIiwic2V0TXV0ZSIsInNldFZvbHVtZSIsInBhdXNlSGFuZGxlck9uIiwib25QYXVzZSIsImNsZWFyVGltZW91dCIsInBhdXNlVGltZXIiLCJ2aWV3ZXJQYXVzZWQiLCJzZXRUaW1lb3V0Iiwic2V0Q29udHJvbHMiLCJvblBsYXllckVycm9yIiwiZXJyb3IiLCJpbmRleCIsImdldFBsYXlsaXN0SW5kZXgiLCJtZXNzYWdlIiwib25TZXR1cEVycm9yIiwidGhpcyIsInNldHVwIiwiY29udHJvbHMiLCJzdHJldGNoaW5nIiwib25SZWFkeSIsImVsZW1lbnRzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwidG90YWwiLCJjbGFzc05hbWUiLCJvbkVycm9yIiwiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwidmFsdWUiLCJnYWRnZXRzIiwiX2RvbmUiLCJycGMiLCJjYWxsIiwiX3ByZWZzIiwiZ2V0U3RyaW5nIiwiX3JlYWR5IiwiX2dldEZyYW1lT2JqZWN0IiwiaWZyYW1lIiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnRXaW5kb3ciLCJjb250ZW50RG9jdW1lbnQiLCJfY2xlYXJDb250YWluZXIiLCJjb250YWluZXIiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJfY2xlYXJGcmFtZSIsIm15RnJhbWVPYmoiLCJsb2NhdGlvbiIsInJlbG9hZCIsIl9hZGRGcmFtZSIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsIl9iYWNrZ3JvdW5kUmVhZHkiLCJfc3RvcmFnZSIsIlN0b3JhZ2UiLCJfYWRkaXRpb25hbFBhcmFtcyIsImluaXQiLCJfY3JlYXRlUGxheWVyIiwiaHRtbCIsIlRlbXBsYXRlIiwiZ2V0SFRNTCIsIl9jdXJyZW50RmlsZXMiLCJvcGVuIiwid3JpdGUiLCJjbG9zZSIsIm9uU3RvcmFnZUluaXQiLCJ1cmxzIiwib25TdG9yYWdlUmVmcmVzaCIsImZyYW1lT2JqIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJzdHlsZSIsImdldEludCIsIl9iYWNrZ3JvdW5kIiwiQ29tbW9uIiwiQmFja2dyb3VuZCIsIl9pbml0aWFsaXplZCIsImNvbnNvbGUiLCJkZWJ1ZyIsIl9yZWZyZXNoVGltZXIiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJiYWNrZ3JvdW5kIiwiaW1hZ2UiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcmVmcmVzaER1cmF0aW9uIiwidXNlSW1hZ2UiLCJfaXNTdG9yYWdlRmlsZSIsIl9jYWxsYmFjayIsIl9jb25maWd1cmUiLCJzdHIiLCJib2R5IiwiY29sb3IiLCJwb3NpdGlvbiIsInNjYWxlIiwiT2JqZWN0Iiwia2V5cyIsImJhY2tncm91bmRTdG9yYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImNvbXBhbnlJZCIsImdvIiwibG9nIiwiY2IiLCJzdG9yYWdlIiwic29ydCIsInNvcnREaXJlY3Rpb24iLCJmb3JFYWNoIiwiX2luaXRpYWxMb2FkIiwib3JkZXIiLCJwYXJhbXMiLCJodG1sU3RyaW5nIiwiVEVNUExBVEUiLCJyZXBsYWNlIiwidmlkZW8iLCJhdXRvcGxheSIsImpvaW4iLCJ3aW5kb3ciLCJwb2x5bWVyUmVhZHkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaWQiLCJyZWdpc3RlciIsInByZWZzIiwib25jb250ZXh0bWVudSIsIl9nYXEiLCJnYSIsImFzeW5jIiwic3JjIiwicHJvdG9jb2wiLCJzIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBNlpBLFFBQVNBLGFBQ1BDLE9BQU9DLFdBQVdDLFlBQVlDLGNBR2hDLFFBQVNDLGNBQ1BKLE9BQU9DLFdBQVdDLFlBQVlHLGNBR2hDLFFBQVNDLFlBQVdDLEdBQ2xCUCxPQUFPQyxXQUFXQyxZQUFZTSxZQUFZRCxHQUc1QyxRQUFTRSxXQUFVQyxFQUFZQyxFQUFhQyxFQUFhQyxFQUFlQyxFQUFpQkMsRUFBWUMsR0FDbkdDLE1BQVFQLEVBQ1JRLE9BQVNQLEVBQ1RRLE9BQVNQLEVBQ1RRLFNBQVdQLEVBQ1hRLFdBQWFQLEVBQ2JRLGNBQWdCUCxFQUNoQlEsTUFBUVAsRUFBV1EsTUFBTSxLQUVyQkMsUUFDRkEsT0FBT2hCLFlBSVgsUUFBU2lCLFFBQ1BELE9BQU9DLE9BR1QsUUFBU0MsU0FDUEYsT0FBT0UsUUFHVCxRQUFTQyxRQUNQSCxPQUFPRyxPQUdULFFBQVNDLFVBQ1BKLE9BQU9JLFNB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V0MsWUFBWTBCLE9BR3pCLFFBQVMySixLQUNQRCxFQUFPRSxvQkFBb0IsZ0JBQWlCRCxHQUV4Q0UsR0FBYSxLQUFQQSxJQUNSdEcsRUFBUUUsSUFBSXFHLFNBQVMsY0FBZ0JELEVBQUkvSixHQUN6Q3lELEVBQVFFLElBQUlxRyxTQUFTLGVBQWlCRCxFQUFJOUosR0FDMUN3RCxFQUFRRSxJQUFJcUcsU0FBUyxjQUFnQkQsRUFBSTdKLEdBRXpDdUQsRUFBUUUsSUFBSXFHLFNBQVMsZUFBaUJELEVBQUl4TCxXQUFXQyxZQUFZMEgscUJBQ2pFekMsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGNBQWUsS0FBTW1HLEdBQUssc0JBN0JuRCxHQUFJRSxHQUFRLEdBQUl4RyxHQUFRZ0QsTUFDdEJzRCxFQUFLRSxFQUFNbkcsVUFBVSxLQUd2QjhGLEdBQU9NLGNBQWdCLFdBQ3JCLE9BQU8sR0E0QlROLEVBQU90QixpQkFBaUIsZ0JBQWlCdUIsSUFFeENELE9BQVFuRyxRQUtYLElBQUkwRyxNQUFPQSxRQUVYQSxNQUFLakosTUFBTSxjQUFlLGtCQUMxQmlKLEtBQUtqSixNQUFNLG1CQUVYLFdBQ0UsR0FBSWtKLEdBQUt0SCxTQUFTZ0MsY0FBYyxTQUFXc0YsR0FBR3pKLEtBQU8sa0JBQW1CeUosRUFBR0MsT0FBUSxFQUNuRkQsRUFBR0UsS0FBTyxVQUFZeEgsU0FBUzZCLFNBQVM0RixTQUFXLGNBQWdCLGNBQWdCLDZCQUNuRixJQUFJQyxHQUFJMUgsU0FBU0UscUJBQXFCLFVBQVUsRUFBSXdILEdBQUVDLFdBQVdDLGFBQWFOLEVBQUlJIiwiZmlsZSI6ImpzL3dpZGdldC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgY29uZmlnOiB0cnVlICovXG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgY29uZmlnID09PSBcInVuZGVmaW5lZFwiKSB7XG4gIHZhciBjb25maWcgPSB7XG4gICAgLy8gdmFyaWFibGVzIGdvIGhlcmVcbiAgfTtcblxuICBpZiAodHlwZW9mIGFuZ3VsYXIgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24uY29tbW9uLmkxOG4uY29uZmlnXCIsIFtdKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJjb21wb25lbnRzL3J2LWNvbW1vbi1pMThuL2Rpc3QvbG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi53aWRnZXQuY29tbW9uLnN0b3JhZ2Utc2VsZWN0b3IuY29uZmlnXCIpXG4gICAgICAudmFsdWUoXCJTVE9SQUdFX01PREFMXCIsIFwiaHR0cDovL3N0b3JhZ2Utc3RhZ2UtcnZhLXRlc3QucmlzZXZpc2lvbi5jb20vbW9kYWwuaHRtbFwiKTtcbiAgfVxufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0ge307XG5cblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSAoZnVuY3Rpb24gKGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hZGRpdGlvbmFsUGFyYW1zO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9iYWNrZ3JvdW5kID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGw7XG5cbiAgdmFyIF9pbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gIHZhciBfY3VycmVudEZpbGVzO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRGcmFtZU9iamVjdCgpIHtcbiAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN2aWRlb0NvbnRhaW5lciBpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICByZXR1cm4gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfY2xlYXJDb250YWluZXIoKSB7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIik7XG5cbiAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcbiAgICB3aGlsZSAoY29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcbiAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZChjb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NsZWFyRnJhbWUoKSB7XG4gICAgdmFyIG15RnJhbWVPYmogPSBfZ2V0RnJhbWVPYmplY3QoKTtcblxuICAgIGlmIChteUZyYW1lT2JqKSB7XG4gICAgICBteUZyYW1lT2JqLnJlbW92ZSgpO1xuICAgICAgbXlGcmFtZU9iai5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfYWRkRnJhbWUoKSB7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIiksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwgXCIwXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIiwgXCJub1wiKTtcblxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICBfc3RvcmFnZSA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jcmVhdGVQbGF5ZXIoKSB7XG4gICAgdmFyIGh0bWwgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlRlbXBsYXRlLmdldEhUTUwoX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpLFxuICAgICAgbXlGcmFtZU9iaiA9IF9nZXRGcmFtZU9iamVjdCgpO1xuXG4gICAgaWYgKG15RnJhbWVPYmopIHtcbiAgICAgIG15RnJhbWVPYmouZG9jdW1lbnQub3BlbigpO1xuICAgICAgbXlGcmFtZU9iai5kb2N1bWVudC53cml0ZShodG1sKTtcbiAgICAgIG15RnJhbWVPYmouZG9jdW1lbnQuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJscykge1xuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuICAgIF9hZGRGcmFtZSgpO1xuICAgIF9jcmVhdGVQbGF5ZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2goLyp1cmxzKi8pIHtcbiAgICAvL1RPRE86IGhhbmRsZSBhIHJlZnJlc2hcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9nZXRGcmFtZU9iamVjdCgpO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBmcmFtZU9iai5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2dldEZyYW1lT2JqZWN0KCk7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX2FkZEZyYW1lKCk7XG4gICAgICBfY3JlYXRlUGxheWVyKCk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1swXSk7XG4gICAgICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoID0gX3ByZWZzLmdldEludChcInJzV1wiKTtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKTtcblxuICAgICAgICAvLyBjcmVhdGUgYW5kIGluaXRpYWxpemUgdGhlIEJhY2tncm91bmQgaW5zdGFuY2VcbiAgICAgICAgX2JhY2tncm91bmQgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZChfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICAgIF9iYWNrZ3JvdW5kLmluaXQoX2JhY2tncm91bmRSZWFkeSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRW5kZWQoKSB7XG4gICAgX2NsZWFyRnJhbWUoKTtcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG4gICAgICBfY2xlYXJDb250YWluZXIoKTtcbiAgICAgIF9kb25lKCk7XG5cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7XG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIF9pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICBfcmVhZHkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGxheSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVycm9yKGVycm9yKSB7XG4gICAgY29uc29sZS5kZWJ1ZyhcInZpZGVvLWZvbGRlcjo6cGxheWVyRXJyb3IoKVwiLCBlcnJvcik7XG5cbiAgICBpZiAoIV9pbml0aWFsaXplZCkge1xuICAgICAgLy8gV2lkZ2V0IGhhcyBub3Qgc2VudCBcInJlYWR5XCIgeWV0IGFuZCB0aGVyZSBpcyBhbiBlcnJvciAoc2V0dXAgb3IgcGxheWJhY2sgb2YgZmlyc3QgdmlkZW8sIGRvZXNuJ3QgbWF0dGVyIHdoaWNoKVxuICAgICAgX2NsZWFyRnJhbWUoKTtcbiAgICAgIF9jbGVhckNvbnRhaW5lcigpO1xuXG4gICAgICAvLyBkbyBub3RoaW5nIG1vcmUsIGVuc3VyZSBcInJlYWR5XCIgaXMgbm90IHNlbnQgdG8gVmlld2VyIHNvIHRoYXQgdGhpcyB3aWRnZXQgY2FuIGJlIHNraXBwZWRcblxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBmb3JjZSB3aWRnZXQgdG8gYWN0IGFzIHRob3VnaCB0aGUgcGxheWxpc3QgaXMgZG9uZVxuICAgICAgcGxheWVyRW5kZWQoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJvblN0b3JhZ2VJbml0XCI6IG9uU3RvcmFnZUluaXQsXG4gICAgXCJvblN0b3JhZ2VSZWZyZXNoXCI6IG9uU3RvcmFnZVJlZnJlc2gsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllckVuZGVkXCI6IHBsYXllckVuZGVkLFxuICAgIFwicGxheWVyUmVhZHlcIjogcGxheWVyUmVhZHksXG4gICAgXCJwbGF5ZXJFcnJvclwiOiBwbGF5ZXJFcnJvcixcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfY2FsbGJhY2sgPSBudWxsLFxuICAgIF9yZWFkeSA9IGZhbHNlLFxuICAgIF9iYWNrZ3JvdW5kID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX3JlZnJlc2hEdXJhdGlvbiA9IDkwMDAwMCwgLy8gMTUgbWludXRlc1xuICAgIF9pc1N0b3JhZ2VGaWxlID0gZmFsc2UsXG4gICAgX3NlcGFyYXRvciA9IFwiXCI7XG5cbiAgLypcbiAgICogUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfcmVmcmVzaFRpbWVyKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gYmFja2dyb3VuZFJlZnJlc2goKSB7XG4gICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBfc2VwYXJhdG9yICsgXCJjYj1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgXCIpXCI7XG4gICAgICBfcmVmcmVzaFRpbWVyKCk7XG4gICAgfSwgX3JlZnJlc2hEdXJhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIF9yZWFkeSA9IHRydWU7XG5cbiAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlICYmICFfaXNTdG9yYWdlRmlsZSkge1xuICAgICAgLy8gc3RhcnQgdGhlIHJlZnJlc2ggcG9sbCBmb3Igbm9uLXN0b3JhZ2UgYmFja2dyb3VuZCBpbWFnZVxuICAgICAgX3JlZnJlc2hUaW1lcigpO1xuICAgIH1cblxuICAgIGlmIChfY2FsbGJhY2sgJiYgdHlwZW9mIF9jYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBfY2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfY29uZmlndXJlKCkge1xuICAgIHZhciBzdHI7XG5cbiAgICBfYmFja2dyb3VuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmFja2dyb3VuZFwiKTtcbiAgICBfc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmFja2dyb3VuZFN0b3JhZ2VcIik7XG5cbiAgICAvLyBzZXQgdGhlIGRvY3VtZW50IGJhY2tncm91bmRcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmJhY2tncm91bmQgPSBkYXRhLmJhY2tncm91bmQuY29sb3I7XG5cbiAgICBpZiAoX2JhY2tncm91bmQpIHtcbiAgICAgIGlmIChkYXRhLmJhY2tncm91bmQudXNlSW1hZ2UpIHtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnBvc2l0aW9uO1xuICAgICAgICBfYmFja2dyb3VuZC5jbGFzc05hbWUgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2Uuc2NhbGUgPyBfYmFja2dyb3VuZC5jbGFzc05hbWUgKyBcIiBzY2FsZS10by1maXRcIlxuICAgICAgICAgIDogX2JhY2tncm91bmQuY2xhc3NOYW1lO1xuXG4gICAgICAgIF9pc1N0b3JhZ2VGaWxlID0gKE9iamVjdC5rZXlzKGRhdGEuYmFja2dyb3VuZFN0b3JhZ2UpLmxlbmd0aCAhPT0gMCk7XG5cbiAgICAgICAgaWYgKCFfaXNTdG9yYWdlRmlsZSkge1xuICAgICAgICAgIHN0ciA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwuc3BsaXQoXCI/XCIpO1xuXG4gICAgICAgICAgLy8gc3RvcmUgdGhpcyBmb3IgdGhlIHJlZnJlc2ggdGltZXJcbiAgICAgICAgICBfc2VwYXJhdG9yID0gKHN0ci5sZW5ndGggPT09IDEpID8gXCI/XCIgOiBcIiZcIjtcblxuICAgICAgICAgIF9iYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnVybCArIFwiKVwiO1xuICAgICAgICAgIF9iYWNrZ3JvdW5kUmVhZHkoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoX3N0b3JhZ2UpIHtcbiAgICAgICAgICAgIC8vIFJpc2UgU3RvcmFnZVxuICAgICAgICAgICAgX3N0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICBpZiAoZS5kZXRhaWwgJiYgZS5kZXRhaWwuZmlsZXMgJiYgZS5kZXRhaWwuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIF9iYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZS5kZXRhaWwuZmlsZXNbMF0udXJsICsgXCIpXCI7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoIV9yZWFkeSkge1xuICAgICAgICAgICAgICAgIF9iYWNrZ3JvdW5kUmVhZHkoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZvbGRlcik7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmaWxlTmFtZVwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmZpbGVOYW1lKTtcbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLmJhY2tncm91bmRTdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgICAgICAgICBfc3RvcmFnZS5nbygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kU3RvcmFnZSdcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBlbGVtZW50IHdpdGggaWQgdmFsdWUgb2YgJ2JhY2tncm91bmQnXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdChjYikge1xuICAgIGlmICghX3JlYWR5KSB7XG4gICAgICBpZiAoY2IpIHtcbiAgICAgICAgX2NhbGxiYWNrID0gY2I7XG4gICAgICB9XG5cbiAgICAgIF9jb25maWd1cmUoKTtcblxuICAgIH0gZWxzZSBpZiAoY2IgJiYgdHlwZW9mIGNiID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGNiKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgfHwge307XG5cblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuU3RvcmFnZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfaW5pdGlhbExvYWQgPSB0cnVlO1xuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICB2YXIgc3RvcmFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Gb2xkZXJTdG9yYWdlXCIpLFxuICAgICAgc29ydCA9IFwiXCIsXG4gICAgICBzb3J0RGlyZWN0aW9uID0gXCJcIjtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgdXJscyA9IFtdO1xuXG4gICAgICBpZiAoZS5kZXRhaWwgJiYgZS5kZXRhaWwuZmlsZXMgJiYgZS5kZXRhaWwuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBlLmRldGFpbC5maWxlcy5mb3JFYWNoKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICB1cmxzLnB1c2goZmlsZS51cmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoX2luaXRpYWxMb2FkKSB7XG4gICAgICAgICAgX2luaXRpYWxMb2FkID0gZmFsc2U7XG5cbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLm9uU3RvcmFnZUluaXQodXJscyk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLm9uU3RvcmFnZVJlZnJlc2godXJscyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5zdG9yYWdlLmZvbGRlcik7XG5cbiAgICAvLyBTb3J0aW5nXG4gICAgc3dpdGNoIChkYXRhLm9yZGVyKSB7XG4gICAgICBjYXNlIFwiYWxwaGEtYXNjXCI6XG4gICAgICAgIHNvcnQgPSBcIm5hbWVcIjtcbiAgICAgICAgc29ydERpcmVjdGlvbiA9IFwiYXNjXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImFscGhhLWRlc2NcIjpcbiAgICAgICAgc29ydCA9IFwibmFtZVwiO1xuICAgICAgICBzb3J0RGlyZWN0aW9uID0gXCJkZXNjXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImRhdGUtYXNjXCI6XG4gICAgICAgIHNvcnQgPSBcImRhdGVcIjtcbiAgICAgICAgc29ydERpcmVjdGlvbiA9IFwiYXNjXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImRhdGUtZGVzY1wiOlxuICAgICAgICBzb3J0ID0gXCJkYXRlXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImRlc2NcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmFuZG9tXCI6XG4gICAgICAgIHNvcnQgPSBcInJhbmRvbVwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHNvcnQgPSBcIm5hbWVcIjtcbiAgICAgICAgc29ydERpcmVjdGlvbiA9IFwiYXNjXCI7XG4gICAgfVxuXG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJzb3J0XCIsIHNvcnQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwic29ydERpcmVjdGlvblwiLCBzb3J0RGlyZWN0aW9uKTtcbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG52YXIgZmlsZXM7XG52YXIgdm9sdW1lLCBhdXRvUGxheSwgc2NhbGVUb0ZpdCwgcGF1c2VEdXJhdGlvbjtcbnZhciB3aWR0aCwgaGVpZ2h0O1xuXG52YXIgaXNMb2FkaW5nID0gdHJ1ZSxcbiAgcGF1c2VIYW5kbGVyT24gPSBmYWxzZTtcblxudmFyIHZpZXdlclBhdXNlZCA9IGZhbHNlO1xudmFyIHBhdXNlVGltZXIgPSBudWxsO1xuXG52YXIgcGxheWVyID0gbnVsbDtcblxuZnVuY3Rpb24gZG9uZUV2ZW50KCkge1xuICBwYXJlbnQuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5ZXJFbmRlZCgpO1xufVxuXG5mdW5jdGlvbiByZWFkeUV2ZW50KCkge1xuICBwYXJlbnQuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5ZXJSZWFkeSgpO1xufVxuXG5mdW5jdGlvbiBlcnJvckV2ZW50KGRhdGEpIHtcbiAgcGFyZW50LlJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGxheWVyRXJyb3IoZGF0YSk7XG59XG5cbmZ1bmN0aW9uIGxvYWRWaWRlbyh3aWR0aFBhcmFtLCBoZWlnaHRQYXJhbSwgdm9sdW1lUGFyYW0sIGF1dG9QbGF5UGFyYW0sIHNjYWxlVG9GaXRQYXJhbSwgcGF1c2VQYXJhbSwgZmlsZXNQYXJhbSkge1xuICB3aWR0aCA9IHdpZHRoUGFyYW07XG4gIGhlaWdodCA9IGhlaWdodFBhcmFtO1xuICB2b2x1bWUgPSB2b2x1bWVQYXJhbTtcbiAgYXV0b1BsYXkgPSBhdXRvUGxheVBhcmFtO1xuICBzY2FsZVRvRml0ID0gc2NhbGVUb0ZpdFBhcmFtO1xuICBwYXVzZUR1cmF0aW9uID0gcGF1c2VQYXJhbTtcbiAgZmlsZXMgPSBmaWxlc1BhcmFtLnNwbGl0KFwiLFwiKTtcblxuICBpZiAocGxheWVyKSB7XG4gICAgcGxheWVyLmxvYWRWaWRlbygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHBsYXkoKSB7XG4gIHBsYXllci5wbGF5KCk7XG59XG5cbmZ1bmN0aW9uIHBhdXNlKCkge1xuICBwbGF5ZXIucGF1c2UoKTtcbn1cblxuZnVuY3Rpb24gc3RvcCgpIHtcbiAgcGxheWVyLnN0b3AoKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlKCkge1xuICBwbGF5ZXIucmVtb3ZlKCk7XG59XG5cbmZ1bmN0aW9uIFBsYXllckpXKCkge1xuICBmdW5jdGlvbiBnZXRWaWRlb0ZpbGVUeXBlKHVybCkge1xuICAgIHZhciBleHRlbnNpb25zID0gW1wiLm1wNFwiLCBcIi53ZWJtXCIsIFwiLm9nZ1wiLCBcIi5vZ3ZcIl0sXG4gICAgICB1cmxMb3dlcmNhc2UgPSB1cmwudG9Mb3dlckNhc2UoKSxcbiAgICAgIHR5cGUgPSBudWxsLFxuICAgICAgaTtcblxuICAgIGZvciAoaSA9IDA7IGkgPD0gZXh0ZW5zaW9ucy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgaWYgKHVybExvd2VyY2FzZS5pbmRleE9mKGV4dGVuc2lvbnNbaV0pICE9PSAtMSkge1xuICAgICAgICB0eXBlID0gZXh0ZW5zaW9uc1tpXS5zdWJzdHIoZXh0ZW5zaW9uc1tpXS5sYXN0SW5kZXhPZihcIi5cIikgKyAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHR5cGUgPT09IFwib2d2XCIpIHtcbiAgICAgIHR5cGUgPSBcIm9nZ1wiO1xuICAgIH1cblxuICAgIHJldHVybiB0eXBlO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0UGxheWxpc3QoKSB7XG4gICAgdmFyIHBsYXlsaXN0ID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBwbGF5bGlzdC5wdXNoKHtcbiAgICAgICAgc291cmNlczogW3tcbiAgICAgICAgICBmaWxlOiBmaWxlc1tpXSxcbiAgICAgICAgICB0eXBlOiBnZXRWaWRlb0ZpbGVUeXBlKGZpbGVzW2ldKVxuICAgICAgICB9XVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBsYXlsaXN0O1xuICB9XG5cbiAgZnVuY3Rpb24gb25QbGF5bGlzdENvbXBsZXRlKCkge1xuICAgIGRvbmVFdmVudCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25QbGF5KCkge1xuICAgIGlmIChpc0xvYWRpbmcpIHtcbiAgICAgIGlzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICBqd3BsYXllcigpLnBhdXNlKCk7XG4gICAgICBqd3BsYXllcigpLnNldE11dGUoZmFsc2UpO1xuICAgICAgandwbGF5ZXIoKS5zZXRWb2x1bWUodm9sdW1lKTtcblxuICAgICAgcmVhZHlFdmVudCgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghcGF1c2VIYW5kbGVyT24pIHtcbiAgICAgICAgcGF1c2VIYW5kbGVyT24gPSB0cnVlO1xuXG4gICAgICAgIC8vIG5vdyBkZWZpbmUgcGF1c2UgaGFuZGxlclxuICAgICAgICBqd3BsYXllcigpLm9uUGF1c2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG9uUGF1c2UoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNsZWFyVGltZW91dChwYXVzZVRpbWVyKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGF1c2UoKSB7XG4gICAgaWYgKCF2aWV3ZXJQYXVzZWQgJiYgIWlzTG9hZGluZykge1xuICAgICAgLy8gdXNlciBoYXMgcGF1c2VkLCBzZXQgYSB0aW1lciB0byBwbGF5IGFnYWluXG4gICAgICBjbGVhclRpbWVvdXQocGF1c2VUaW1lcik7XG5cbiAgICAgIHBhdXNlVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBjb250aW51ZSBwbGF5aW5nIHRoZSBjdXJyZW50IHZpZGVvXG4gICAgICAgIGp3cGxheWVyKCkucGxheSgpO1xuXG4gICAgICAgIC8vIHdvcmthcm91bmQgZm9yIGNvbnRyb2xzIHJlbWFpbmluZyB2aXNpYmxlLCB0dXJuIHRoZW0gb2ZmIGFuZCBvbiBhZ2FpblxuICAgICAgICBqd3BsYXllcigpLnNldENvbnRyb2xzKGZhbHNlKTtcbiAgICAgICAgandwbGF5ZXIoKS5zZXRDb250cm9scyh0cnVlKTtcblxuICAgICAgfSwgcGF1c2VEdXJhdGlvbiAqIDEwMDApO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGxheWVyRXJyb3IoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGVycm9yRXZlbnQoe1xuICAgICAgICB0eXBlOiBcInZpZGVvXCIsXG4gICAgICAgIGluZGV4OiBqd3BsYXllcigpLmdldFBsYXlsaXN0SW5kZXgoKSxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25TZXR1cEVycm9yKGVycm9yKSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBlcnJvckV2ZW50KHtcbiAgICAgICAgdHlwZTogXCJzZXR1cFwiLFxuICAgICAgICBpbmRleDogMCxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgdGhpcy5sb2FkVmlkZW8gPSBmdW5jdGlvbigpIHtcbiAgICBqd3BsYXllcihcInBsYXllclwiKS5zZXR1cCh7XG4gICAgICBwbGF5bGlzdDogZ2V0UGxheWxpc3QoKSxcbiAgICAgIHdpZHRoIDogd2lkdGgsXG4gICAgICBoZWlnaHQgOiBoZWlnaHQsXG4gICAgICBjb250cm9sczogIWF1dG9QbGF5LFxuICAgICAgc3RyZXRjaGluZyA6IHNjYWxlVG9GaXQgPyBcInVuaWZvcm1cIiA6IFwibm9uZVwiXG4gICAgfSk7XG5cbiAgICBqd3BsYXllcigpLm9uU2V0dXBFcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIG9uU2V0dXBFcnJvcihlcnJvcik7XG4gICAgfSk7XG5cbiAgICBqd3BsYXllcigpLm9uUmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5ZXJcIikuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCIqXCIpLFxuICAgICAgICB0b3RhbCA9IGVsZW1lbnRzLmxlbmd0aCxcbiAgICAgICAgaTtcblxuICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgQ2hyb21lIEFwcCBQbGF5ZXIgPHdlYnZpZXc+IG5vdCBoYW5kbGluZyBDU1MzIHRyYW5zaXRpb25cbiAgICAgIGZvciAoaSA9IDA7IGkgPCB0b3RhbDsgaSArPSAxKSB7XG4gICAgICAgIGVsZW1lbnRzW2ldLmNsYXNzTmFtZSArPSBcIiBub3RyYW5zaXRpb25cIjtcbiAgICAgIH1cblxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5ZXJcIikuY2xhc3NOYW1lICs9IFwiIG5vdHJhbnNpdGlvblwiO1xuXG4gICAgICBqd3BsYXllcigpLm9uUGxheWxpc3RDb21wbGV0ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIG9uUGxheWxpc3RDb21wbGV0ZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGp3cGxheWVyKCkub25QbGF5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb25QbGF5KCk7XG4gICAgICB9KTtcblxuICAgICAgandwbGF5ZXIoKS5vbkVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBvblBsYXllckVycm9yKGVycm9yKTtcbiAgICAgIH0pO1xuXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gbmVlZCB0byB0ZXN0IGlmIHRoZXJlIGlzIGFuIGVycm9yIHBsYXlpbmcgZmlyc3QgdmlkZW9cbiAgICAgICAgandwbGF5ZXIoKS5wbGF5KCk7XG4gICAgICB9LCAyMDApO1xuXG4gICAgfSk7XG4gIH07XG5cbiAgdGhpcy5wbGF5ID0gZnVuY3Rpb24oKSB7XG4gICAgdmlld2VyUGF1c2VkID0gZmFsc2U7XG4gICAgaWYgKGF1dG9QbGF5KSB7XG4gICAgICBqd3BsYXllcigpLnBsYXkoKTtcbiAgICB9XG4gIH07XG5cbiAgdGhpcy5wYXVzZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZpZXdlclBhdXNlZCA9IHRydWU7XG4gICAgY2xlYXJUaW1lb3V0KHBhdXNlVGltZXIpO1xuICAgIGp3cGxheWVyKCkucGF1c2UoKTtcbiAgfTtcblxuICB0aGlzLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnBhdXNlKCk7XG4gIH07XG5cbiAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbigpIHtcbiAgICB2aWV3ZXJQYXVzZWQgPSBmYWxzZTtcbiAgICBjbGVhclRpbWVvdXQocGF1c2VUaW1lcik7XG4gICAgcGF1c2VUaW1lciA9IG51bGw7XG4gICAgandwbGF5ZXIoKS5yZW1vdmUoKTtcbiAgfTtcblxufVxuXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlRlbXBsYXRlID0gKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIFRFTVBMQVRFID0gXCJcIiArXG4gICAgXCI8aHRtbD5cIiArXG4gICAgXCI8aGVhZD5cIiArXG4gICAgXCI8bWV0YSBodHRwLWVxdWl2PVxcXCJjb250ZW50LXR5cGVcXFwiIGNvbnRlbnQ9XFxcInRleHQvaHRtbDsgY2hhcnNldD1VVEYtOFxcXCI+XCIgK1xuICAgIFwiPHRpdGxlPjwvdGl0bGU+XCIgK1xuICAgIFwiPHNjcmlwdCB0eXBlPVxcXCJ0ZXh0L2phdmFzY3JpcHRcXFwiIHNyYz1cXFwiLy9zMy5hbWF6b25hd3MuY29tL3Jpc2UtY29tbW9uL3NjcmlwdHMvanctcGxheWVyL2p3cGxheWVyLmpzXFxcIj48L3NjcmlwdD5cIiArXG4gICAgXCI8c2NyaXB0Pmp3cGxheWVyLmtleT1cXFwieEJYeVV0QUorYnJGendjMmtOaERnL1NxazhXN3Jta3RBWWxpWUh6Vmd4bz1cXFwiPC9zY3JpcHQ+XCIgK1xuICAgIFwiPHNjcmlwdCB0eXBlPVxcXCJ0ZXh0L2phdmFzY3JpcHRcXFwiIHNyYz1cXFwianMvcGxheWVyLm1pbi5qc1xcXCI+PC9zY3JpcHQ+XCIgK1xuICAgIFwiPHN0eWxlPlwiICtcbiAgICBcIlx0Ym9keSB7IFwiICtcbiAgICBcIlx0XHRiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsgXCIgK1xuICAgIFwiXHRcdC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7IFwiICtcbiAgICBcIlx0XHQtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOyBcIiArXG4gICAgXCJcdFx0LWtodG1sLXVzZXItc2VsZWN0OiBub25lOyBcIiArXG4gICAgXCJcdFx0dXNlci1zZWxlY3Q6IG5vbmU7IFwiICtcbiAgICBcIlx0fVwiICtcbiAgICBcIiAubm90cmFuc2l0aW9uIHsgXCIgK1xuICAgIFwiICAgLXdlYmtpdC10cmFuc2l0aW9uOiBub25lICFpbXBvcnRhbnQ7IFwiICtcbiAgICBcIiAgIHRyYW5zaXRpb246IG5vbmUgIWltcG9ydGFudDsgXCIgK1xuICAgIFwiIH1cIiArXG4gICAgXCI8L3N0eWxlPlwiICtcbiAgICBcIjwvaGVhZD5cIiArXG4gICAgXCI8Ym9keSBzdHlsZT1cXFwibWFyZ2luOjBweDtcXFwiPlwiICtcbiAgICBcIjxkaXYgaWQ9XFxcInBsYXllclxcXCI+TG9hZGluZyB0aGUgcGxheWVyLi4uPC9kaXY+XCIgK1xuICAgIFwiPHNjcmlwdCBsYW5ndWFnZT1cXFwiamF2YXNjcmlwdFxcXCI+XCIgK1xuICAgIFwiXHR3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uKCkge1wiICtcbiAgICBcIlx0XHRyZXR1cm4gZmFsc2U7XCIgK1xuICAgIFwiXHR9O1wiICtcbiAgICBcIlx0dHJ5IHtcIiArXG4gICAgXCJcdFx0cGxheWVyID0gbmV3IFBsYXllckpXKCk7XCIgK1xuICAgIFwiXHRcdGxvYWRWaWRlbyhcXFwiJXMxXFxcIiwgXFxcIiVzMlxcXCIsICVzMywgJXM0LCAlczUsICVzNiwgXFxcIiVzN1xcXCIpO1wiICtcbiAgICBcIlx0fSBjYXRjaCAoZSkge1wiICtcbiAgICBcIlx0XHRjb25zb2xlLmxvZyhlLm1lc3NhZ2UpO1wiICtcbiAgICBcIlx0XHRwYXJlbnQuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5ZXJFcnJvcigpO1wiICtcbiAgICBcIlx0fVwiICtcbiAgICBcIjwvc2NyaXB0PlwiICtcbiAgICBcIjwvYm9keT5cIiArXG4gICAgXCI8L2h0bWw+XCI7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBnZXRIVE1MKHBhcmFtcywgZmlsZXMpIHtcbiAgICB2YXIgaHRtbFN0cmluZyA9IFRFTVBMQVRFO1xuXG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzMVwiLCBwYXJhbXMud2lkdGggKyBcInB4XCIpO1xuICAgIGh0bWxTdHJpbmcgPSBodG1sU3RyaW5nLnJlcGxhY2UoXCIlczJcIiwgcGFyYW1zLmhlaWdodCArIFwicHhcIik7XG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzM1wiLCBwYXJhbXMudmlkZW8udm9sdW1lKTtcbiAgICBodG1sU3RyaW5nID0gaHRtbFN0cmluZy5yZXBsYWNlKFwiJXM0XCIsIHBhcmFtcy52aWRlby5hdXRvcGxheSk7XG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzNVwiLCBwYXJhbXMudmlkZW8uc2NhbGVUb0ZpdCk7XG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzNlwiLCBwYXJhbXMucGF1c2UpO1xuICAgIGh0bWxTdHJpbmcgPSBodG1sU3RyaW5nLnJlcGxhY2UoXCIlczdcIiwgZmlsZXMuam9pbigpKTtcblxuICAgIHJldHVybiBodG1sU3RyaW5nO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImdldEhUTUxcIjogZ2V0SFRNTFxuICB9O1xuXG59KSgpO1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbHltZXJSZWFkeSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTQnXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9