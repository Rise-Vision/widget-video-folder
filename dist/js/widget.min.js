if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","http://storage-stage-rva-test.risevision.com/modal.html"))}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,h.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,h.getString("id"),!0,!0,!0,!0,!0)}function o(){var e=document.querySelector("#videoContainer iframe");return e?e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument:null}function i(){for(var e=document.getElementById("videoContainer");e.firstChild;)e.removeChild(e.firstChild)}function r(){var e=o();e&&(e.remove(),document.querySelector("#videoContainer iframe").setAttribute("src","about:blank"))}function a(){var e,t=document.getElementById("videoContainer");e=document.createElement("iframe"),e.setAttribute("allowTransparency",!0),e.setAttribute("frameborder","0"),e.setAttribute("scrolling","no"),t.appendChild(e)}function s(){R=new RiseVision.VideoFolder.Storage(b),R.init()}function c(){var e=document.querySelector("#videoContainer iframe");e&&(e.onload=function(){e.onload=null;var t=o();t.init(b,V)},e.setAttribute("src","player.html"))}function d(e){V=e,a(),c()}function l(){}function u(){var e=o();e&&e.pause()}function g(){var e=o();e?e.play():(a(),c())}function m(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(b=JSON.parse(n[0]),h=new e.Prefs,document.getElementById("videoContainer").style.height=h.getInt("rsH")+"px",b.width=h.getInt("rsW"),b.height=h.getInt("rsH"),k=new RiseVision.Common.Background(b),k.init(s))}function f(){r(),setTimeout(function(){i(),t()},200)}function p(){A?g():(A=!0,n())}function v(e){console.debug("video-folder::playerError()",e),A?f():(r(),i())}function y(){u()}var b,V,h=null,k=null,R=null,A=!1;return{onStorageInit:d,onStorageRefresh:l,pause:u,play:g,setAdditionalParams:m,playerEnded:f,playerReady:p,playerError:v,stop:y}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){s.style.backgroundImage="url("+e.background.image.url+u+"cb="+(new Date).getTime()+")",t()},d)}function n(){a=!0,e.background.useImage&&!l&&t(),r&&"function"==typeof r&&r()}function o(){var t;s=document.getElementById("background"),c=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,s?e.background.useImage?(s.className=e.background.image.position,s.className=e.background.image.scale?s.className+" scale-to-fit":s.className,l=0!==Object.keys(e.backgroundStorage).length,l?c?(c.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.files&&e.detail.files.length>0&&(s.style.backgroundImage="url("+e.detail.files[0].url+")"),a||n()}),c.setAttribute("folder",e.backgroundStorage.folder),c.setAttribute("fileName",e.backgroundStorage.fileName),c.setAttribute("companyId",e.backgroundStorage.companyId),c.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),u=1===t.length?"?":"&",s.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function i(e){a?e&&"function"==typeof e&&e():(e&&(r=e),o())}var r=null,a=!1,s=null,c=null,d=9e5,l=!1,u="";return{init:i}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage"),o="",i="";if(t){switch(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),e.order){case"alpha-asc":o="name",i="asc";break;case"alpha-desc":o="name",i="desc";break;case"date-asc":o="date",i="asc";break;case"date-desc":o="date",i="desc";break;case"random":o="random";break;default:o="name",i="asc"}t.setAttribute("sort",o),t.setAttribute("sortDirection",i),t.go()}}var n=!0;return{init:t}},function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwidmFsdWUiLCJSaXNlVmlzaW9uIiwiVmlkZW9Gb2xkZXIiLCJnYWRnZXRzIiwiX2RvbmUiLCJycGMiLCJjYWxsIiwiX3ByZWZzIiwiZ2V0U3RyaW5nIiwiX3JlYWR5IiwiX2dldEZyYW1lT2JqZWN0IiwiaWZyYW1lIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsIl9jbGVhckNvbnRhaW5lciIsImNvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiX2NsZWFyRnJhbWUiLCJteUZyYW1lT2JqIiwicmVtb3ZlIiwic2V0QXR0cmlidXRlIiwiX2FkZEZyYW1lIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiX2JhY2tncm91bmRSZWFkeSIsIl9zdG9yYWdlIiwiU3RvcmFnZSIsIl9hZGRpdGlvbmFsUGFyYW1zIiwiaW5pdCIsIl9jcmVhdGVQbGF5ZXIiLCJvbmxvYWQiLCJmcmFtZU9iaiIsIl9jdXJyZW50RmlsZXMiLCJvblN0b3JhZ2VJbml0IiwidXJscyIsIm9uU3RvcmFnZVJlZnJlc2giLCJwYXVzZSIsInBsYXkiLCJzZXRBZGRpdGlvbmFsUGFyYW1zIiwibmFtZXMiLCJ2YWx1ZXMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJKU09OIiwicGFyc2UiLCJQcmVmcyIsInN0eWxlIiwiaGVpZ2h0IiwiZ2V0SW50Iiwid2lkdGgiLCJfYmFja2dyb3VuZCIsIkNvbW1vbiIsIkJhY2tncm91bmQiLCJwbGF5ZXJFbmRlZCIsInNldFRpbWVvdXQiLCJwbGF5ZXJSZWFkeSIsIl9pbml0aWFsaXplZCIsInBsYXllckVycm9yIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVidWciLCJzdG9wIiwiZGF0YSIsIl9yZWZyZXNoVGltZXIiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJiYWNrZ3JvdW5kIiwiaW1hZ2UiLCJ1cmwiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcmVmcmVzaER1cmF0aW9uIiwidXNlSW1hZ2UiLCJfaXNTdG9yYWdlRmlsZSIsIl9jYWxsYmFjayIsIl9jb25maWd1cmUiLCJzdHIiLCJib2R5IiwiY29sb3IiLCJjbGFzc05hbWUiLCJwb3NpdGlvbiIsInNjYWxlIiwiT2JqZWN0Iiwia2V5cyIsImJhY2tncm91bmRTdG9yYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJmaWxlcyIsImZvbGRlciIsImZpbGVOYW1lIiwiY29tcGFueUlkIiwiZ28iLCJsb2ciLCJzcGxpdCIsImNiIiwic3RvcmFnZSIsInNvcnQiLCJzb3J0RGlyZWN0aW9uIiwiZm9yRWFjaCIsImZpbGUiLCJwdXNoIiwiX2luaXRpYWxMb2FkIiwib3JkZXIiLCJ3aW5kb3ciLCJwb2x5bWVyUmVhZHkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaWQiLCJyZWdpc3RlciIsInByZWZzIiwib25jb250ZXh0bWVudSIsIl9nYXEiLCJnYSIsInR5cGUiLCJhc3luYyIsInNyYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFFQSxHQUFzQixtQkFBWEEsUUFBd0IsQ0FDakMsR0FBSUEsVUFJbUIsb0JBQVpDLFdBQ1RBLFFBQVFDLE9BQU8sb0NBQ1pDLFNBQVMsaUJBQWtCLHVEQUMzQkEsU0FBUyxnQkFBaUIsU0FFN0JGLFFBQVFDLE9BQU8sb0RBQ1pFLE1BQU0sZ0JBQWlCLDREQU05QixHQUFJQyxZQUFhQSxjQUNqQkEsWUFBV0MsZUFFWEQsV0FBV0MsWUFBYyxTQUFXQyxHQUNsQyxZQWVBLFNBQVNDLEtBQ1BELEVBQVFFLElBQUlDLEtBQUssR0FBSSxlQUFnQixLQUFNQyxFQUFPQyxVQUFVLE9BRzlELFFBQVND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Y0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUkvRyxTQUFTZ0gscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVQsRUFBSU0iLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvLyB2YXJpYWJsZXMgZ28gaGVyZVxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImNvbXBvbmVudHMvcnYtY29tbW9uLWkxOG4vZGlzdC9sb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24uc3RvcmFnZS1zZWxlY3Rvci5jb25maWdcIilcbiAgICAgIC52YWx1ZShcIlNUT1JBR0VfTU9EQUxcIiwgXCJodHRwOi8vc3RvcmFnZS1zdGFnZS1ydmEtdGVzdC5yaXNldmlzaW9uLmNvbS9tb2RhbC5odG1sXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IChmdW5jdGlvbiAoZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FkZGl0aW9uYWxQYXJhbXM7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX2JhY2tncm91bmQgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbDtcblxuICB2YXIgX2luaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgdmFyIF9jdXJyZW50RmlsZXM7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2RvbmUoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfZG9uZVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIikpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2dldEZyYW1lT2JqZWN0KCkge1xuICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ZpZGVvQ29udGFpbmVyIGlmcmFtZVwiKTtcblxuICAgIGlmIChpZnJhbWUpIHtcbiAgICAgIHJldHVybiAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxuICAgICAgICAoaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCkgPyBpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50IDogaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jbGVhckNvbnRhaW5lcigpIHtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKTtcblxuICAgIC8vIHJlbW92ZSB0aGUgaWZyYW1lIGJ5IGNsZWFyaW5nIGFsbCBlbGVtZW50cyBpbnNpZGUgZGl2IGNvbnRhaW5lclxuICAgIHdoaWxlIChjb250YWluZXIuZmlyc3RDaGlsZCkge1xuICAgICAgY29udGFpbmVyLnJlbW92ZUNoaWxkKGNvbnRhaW5lci5maXJzdENoaWxkKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfY2xlYXJGcmFtZSgpIHtcbiAgICB2YXIgbXlGcmFtZU9iaiA9IF9nZXRGcmFtZU9iamVjdCgpO1xuXG4gICAgaWYgKG15RnJhbWVPYmopIHtcbiAgICAgIG15RnJhbWVPYmoucmVtb3ZlKCk7XG5cbiAgICAgIC8vIGRlc3Ryb3kgdGhlIGNvbnRlbnRzIG9mIHRoZSBpZnJhbWVcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdmlkZW9Db250YWluZXIgaWZyYW1lXCIpLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcImFib3V0OmJsYW5rXCIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9hZGRGcmFtZSgpIHtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImFsbG93VHJhbnNwYXJlbmN5XCIsIHRydWUpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNjcm9sbGluZ1wiLCBcIm5vXCIpO1xuXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuU3RvcmFnZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgX3N0b3JhZ2UuaW5pdCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2NyZWF0ZVBsYXllcigpIHtcbiAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN2aWRlb0NvbnRhaW5lciBpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZnJhbWUub25sb2FkID0gbnVsbDtcblxuICAgICAgICB2YXIgZnJhbWVPYmogPSBfZ2V0RnJhbWVPYmplY3QoKTtcblxuICAgICAgICAvLyBpbml0aWFsaXplIGFuZCBsb2FkIHRoZSBwbGF5ZXIgaW5zaWRlIHRoZSBpZnJhbWVcbiAgICAgICAgZnJhbWVPYmouaW5pdChfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gICAgICB9O1xuXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwicGxheWVyLmh0bWxcIik7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBvblN0b3JhZ2VJbml0KHVybHMpIHtcbiAgICBfY3VycmVudEZpbGVzID0gdXJscztcbiAgICBfYWRkRnJhbWUoKTtcbiAgICBfY3JlYXRlUGxheWVyKCk7XG4gIH1cblxuICBmdW5jdGlvbiBvblN0b3JhZ2VSZWZyZXNoKC8qdXJscyovKSB7XG4gICAgLy9UT0RPOiBoYW5kbGUgYSByZWZyZXNoXG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZ2V0RnJhbWVPYmplY3QoKTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9nZXRGcmFtZU9iamVjdCgpO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBmcmFtZU9iai5wbGF5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9hZGRGcmFtZSgpO1xuICAgICAgX2NyZWF0ZVBsYXllcigpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKSArIFwicHhcIjtcblxuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIik7XG5cbiAgICAgICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBCYWNrZ3JvdW5kIGluc3RhbmNlXG4gICAgICAgIF9iYWNrZ3JvdW5kID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLkJhY2tncm91bmQoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgICBfYmFja2dyb3VuZC5pbml0KF9iYWNrZ3JvdW5kUmVhZHkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVuZGVkKCkge1xuICAgIF9jbGVhckZyYW1lKCk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuICAgICAgX2NsZWFyQ29udGFpbmVyKCk7XG4gICAgICBfZG9uZSgpO1xuXG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIGlmICghX2luaXRpYWxpemVkKSB7XG4gICAgICBfaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgX3JlYWR5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgaWYgKCFfaW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIFdpZGdldCBoYXMgbm90IHNlbnQgXCJyZWFkeVwiIHlldCBhbmQgdGhlcmUgaXMgYW4gZXJyb3IgKHNldHVwIG9yIHBsYXliYWNrIG9mIGZpcnN0IHZpZGVvLCBkb2Vzbid0IG1hdHRlciB3aGljaClcbiAgICAgIF9jbGVhckZyYW1lKCk7XG4gICAgICBfY2xlYXJDb250YWluZXIoKTtcblxuICAgICAgLy8gZG8gbm90aGluZyBtb3JlLCBlbnN1cmUgXCJyZWFkeVwiIGlzIG5vdCBzZW50IHRvIFZpZXdlciBzbyB0aGF0IHRoaXMgd2lkZ2V0IGNhbiBiZSBza2lwcGVkXG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZm9yY2Ugd2lkZ2V0IHRvIGFjdCBhcyB0aG91Z2ggdGhlIHBsYXlsaXN0IGlzIGRvbmVcbiAgICAgIHBsYXllckVuZGVkKCk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwib25TdG9yYWdlSW5pdFwiOiBvblN0b3JhZ2VJbml0LFxuICAgIFwib25TdG9yYWdlUmVmcmVzaFwiOiBvblN0b3JhZ2VSZWZyZXNoLFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLkJhY2tncm91bmQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2NhbGxiYWNrID0gbnVsbCxcbiAgICBfcmVhZHkgPSBmYWxzZSxcbiAgICBfYmFja2dyb3VuZCA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9yZWZyZXNoRHVyYXRpb24gPSA5MDAwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlLFxuICAgIF9zZXBhcmF0b3IgPSBcIlwiO1xuXG4gIC8qXG4gICAqIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX3JlZnJlc2hUaW1lcigpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIGJhY2tncm91bmRSZWZyZXNoKCkge1xuICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsICsgX3NlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIFwiKVwiO1xuICAgICAgX3JlZnJlc2hUaW1lcigpO1xuICAgIH0sIF9yZWZyZXNoRHVyYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICBfcmVhZHkgPSB0cnVlO1xuXG4gICAgaWYgKGRhdGEuYmFja2dyb3VuZC51c2VJbWFnZSAmJiAhX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgIC8vIHN0YXJ0IHRoZSByZWZyZXNoIHBvbGwgZm9yIG5vbi1zdG9yYWdlIGJhY2tncm91bmQgaW1hZ2VcbiAgICAgIF9yZWZyZXNoVGltZXIoKTtcbiAgICB9XG5cbiAgICBpZiAoX2NhbGxiYWNrICYmIHR5cGVvZiBfY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgX2NhbGxiYWNrKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NvbmZpZ3VyZSgpIHtcbiAgICB2YXIgc3RyO1xuXG4gICAgX2JhY2tncm91bmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRcIik7XG4gICAgX3N0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRTdG9yYWdlXCIpO1xuXG4gICAgLy8gc2V0IHRoZSBkb2N1bWVudCBiYWNrZ3JvdW5kXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kID0gZGF0YS5iYWNrZ3JvdW5kLmNvbG9yO1xuXG4gICAgaWYgKF9iYWNrZ3JvdW5kKSB7XG4gICAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlKSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5wb3NpdGlvbjtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnNjYWxlID8gX2JhY2tncm91bmQuY2xhc3NOYW1lICsgXCIgc2NhbGUtdG8tZml0XCJcbiAgICAgICAgICA6IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZTtcblxuICAgICAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhkYXRhLmJhY2tncm91bmRTdG9yYWdlKS5sZW5ndGggIT09IDApO1xuXG4gICAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgICBzdHIgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3NlcGFyYXRvciA9IChzdHIubGVuZ3RoID09PSAxKSA/IFwiP1wiIDogXCImXCI7XG5cbiAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBcIilcIjtcbiAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF9zdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgICAgICAgIF9zdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGUuZGV0YWlsLmZpbGVzWzBdLnVybCArIFwiKVwiO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKCFfcmVhZHkpIHtcbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5mb2xkZXIpO1xuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5jb21wYW55SWQpO1xuICAgICAgICAgICAgX3N0b3JhZ2UuZ28oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCB2YWx1ZSBvZiAnYmFja2dyb3VuZFN0b3JhZ2UnXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kJ1wiKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoY2IpIHtcbiAgICBpZiAoIV9yZWFkeSkge1xuICAgICAgaWYgKGNiKSB7XG4gICAgICAgIF9jYWxsYmFjayA9IGNiO1xuICAgICAgfVxuXG4gICAgICBfY29uZmlndXJlKCk7XG5cbiAgICB9IGVsc2UgaWYgKGNiICYmIHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjYigpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2luaXRpYWxMb2FkID0gdHJ1ZTtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvRm9sZGVyU3RvcmFnZVwiKSxcbiAgICAgIHNvcnQgPSBcIlwiLFxuICAgICAgc29ydERpcmVjdGlvbiA9IFwiXCI7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHVybHMgPSBbXTtcblxuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZS5kZXRhaWwuZmlsZXMuZm9yRWFjaChmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgdXJscy5wdXNoKGZpbGUudXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VJbml0KHVybHMpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VSZWZyZXNoKHVybHMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuXG4gICAgLy8gU29ydGluZ1xuICAgIHN3aXRjaCAoZGF0YS5vcmRlcikge1xuICAgICAgY2FzZSBcImFscGhhLWFzY1wiOlxuICAgICAgICBzb3J0ID0gXCJuYW1lXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhbHBoYS1kZXNjXCI6XG4gICAgICAgIHNvcnQgPSBcIm5hbWVcIjtcbiAgICAgICAgc29ydERpcmVjdGlvbiA9IFwiZGVzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkYXRlLWFzY1wiOlxuICAgICAgICBzb3J0ID0gXCJkYXRlXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkYXRlLWRlc2NcIjpcbiAgICAgICAgc29ydCA9IFwiZGF0ZVwiO1xuICAgICAgICBzb3J0RGlyZWN0aW9uID0gXCJkZXNjXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInJhbmRvbVwiOlxuICAgICAgICBzb3J0ID0gXCJyYW5kb21cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzb3J0ID0gXCJuYW1lXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgIH1cblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwic29ydFwiLCBzb3J0KTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcInNvcnREaXJlY3Rpb25cIiwgc29ydERpcmVjdGlvbik7XG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxuLyogZ2xvYmFsIGdhZGdldHMsIFJpc2VWaXNpb24gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpZCA9IHByZWZzLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnBsYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zdG9wKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwb2x5bWVyUmVhZHkoKSB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuc2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9seW1lci1yZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG59KSh3aW5kb3csIGdhZGdldHMpO1xuXG5cblxuLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xudmFyIF9nYXEgPSBfZ2FxIHx8IFtdO1xuXG5fZ2FxLnB1c2goWydfc2V0QWNjb3VudCcsICdVQS01NzA5MjE1OS00J10pO1xuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnXSk7XG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7IGdhLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsgZ2EuYXN5bmMgPSB0cnVlO1xuICBnYS5zcmMgPSAoJ2h0dHBzOicgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAnaHR0cHM6Ly9zc2wnIDogJ2h0dHA6Ly93d3cnKSArICcuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnO1xuICB2YXIgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYSwgcyk7XG59KSgpO1xuLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==