if("undefined"==typeof config){var config={SKIN:""};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","https://storage-stage-rva-test.risevision.com/files/"))}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,v.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,v.getString("id"),!0,!0,!0,!0,!0)}function o(){V=new RiseVision.VideoFolder.Storage(f),V.init()}function i(e){h.remove(e,function(){h.add(e),h.hide(e),h.createFramePlayer(e,f,y)})}function r(e){y=e,h=new RiseVision.VideoFolder.FrameController,h.add(0),p=0,F=1,h.createFramePlayer(0,f,y)}function a(e){var t,n=h.getFrameObject(p),o=0===p?1:0;y=e,n&&(f.video.controls||(t=n.getPlaybackData(),t.total===t.index+1?t.duration-t.position>=15&&i(o):i(o)))}function s(){var e=h.getFrameObject(p);e&&e.pause()}function c(){var e=h.getFrameObject(p);k?t():e?e.play():(p=0===p?1:0,e=h.getFrameObject(p),e.play(),h.add(0===p?1:0),h.hide(0===p?1:0),h.createFramePlayer(0===p?1:0,f,y))}function d(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(f=JSON.parse(n[0]),v=new e.Prefs,document.getElementById("videoContainer").style.height=v.getInt("rsH")+"px",f.width=v.getInt("rsW"),f.height=v.getInt("rsH"),b=new RiseVision.Common.Background(f),b.init(o))}function l(){k?(h.remove(p),h.remove(0===p?1:0),t()):(h.show(0===p?1:0),h.remove(p,function(){t()}))}function u(){R||(2===F?(R=!0,n()):(h.add(1),h.hide(1),F=2,h.createFramePlayer(1,f,y)))}function m(e){console.debug("video-folder::playerError()",e),R?"setup"===e.type||0===e.index?k=!0:l():h.remove(p)}function g(){s()}var f,y,p,v=null,b=null,V=null,h=null,R=!1,k=!1,F=0;return{onStorageInit:r,onStorageRefresh:a,pause:s,play:c,setAdditionalParams:d,playerEnded:l,playerReady:u,playerError:m,stop:g}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){s.style.backgroundImage="url("+e.background.image.url+u+"cb="+(new Date).getTime()+")",t()},d)}function n(){a=!0,e.background.useImage&&!l&&t(),r&&"function"==typeof r&&r()}function o(){var t;s=document.getElementById("background"),c=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,s?e.background.useImage?(s.className=e.background.image.position,s.className=e.background.image.scale?s.className+" scale-to-fit":s.className,l=0!==Object.keys(e.backgroundStorage).length,l?c?(c.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.files&&e.detail.files.length>0&&(s.style.backgroundImage="url("+e.detail.files[0].url+")"),a||n()}),c.setAttribute("folder",e.backgroundStorage.folder),c.setAttribute("fileName",e.backgroundStorage.fileName),c.setAttribute("companyId",e.backgroundStorage.companyId),c.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),u=1===t.length?"?":"&",s.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function i(e){a?e&&"function"==typeof e&&e():(e&&(r=e),o())}var r=null,a=!1,s=null,c=null,d=9e5,l=!1,u="";return{init:i}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage"),o="",i="";if(t){switch(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),e.order){case"alpha-asc":o="name",i="asc";break;case"alpha-desc":o="name",i="desc";break;case"date-asc":o="date",i="asc";break;case"date-desc":o="date",i="desc";break;case"random":o="random";break;default:o="name",i="asc"}t.setAttribute("sort",o),t.setAttribute("sortDirection",i),t.go()}}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.FrameController=function(){"use strict";function e(e){var t,n,o=document.getElementById(s+e);try{t=o.querySelector("iframe"),n=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument,n.remove(),t.setAttribute("src","about:blank")}catch(i){console.debug(i)}}function t(e){var t,n;t=document.getElementById(s+e),n=document.createElement("iframe"),n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),t.appendChild(n)}function n(e,t,n){var o,i=document.getElementById(s+e);o=i.querySelector("iframe"),o&&(o.onload=function(){o.onload=null;var e=o.contentWindow?o.contentWindow:o.contentDocument.document?o.contentDocument.document:o.contentDocument;e.init(t,n,config.SKIN)},o.setAttribute("src","player.html"))}function o(e){var t,n=document.getElementById(s+e);return t=n.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function i(e){document.getElementById(s+e).style.visibility="hidden"}function r(t,n){var o=document.getElementById(s+t);e(t),setTimeout(function(){for(;o.firstChild;)o.removeChild(o.firstChild);n&&"function"==typeof n&&n()},200)}function a(e){document.getElementById(s+e).style.visibility="visible"}var s="if_";return{add:t,createFramePlayer:n,getFrameObject:o,hide:i,remove:r,show:a}},function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsInZhbHVlIiwiUmlzZVZpc2lvbiIsIlZpZGVvRm9sZGVyIiwiZ2FkZ2V0cyIsIl9kb25lIiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl9yZWFkeSIsIl9iYWNrZ3JvdW5kUmVhZHkiLCJfc3RvcmFnZSIsIlN0b3JhZ2UiLCJfYWRkaXRpb25hbFBhcmFtcyIsImluaXQiLCJfcmVmcmVzaEZyYW1lIiwiZnJhbWVJbmRleCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJhZGQiLCJoaWRlIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJfY3VycmVudEZpbGVzIiwib25TdG9yYWdlSW5pdCIsInVybHMiLCJGcmFtZUNvbnRyb2xsZXIiLCJfY3VycmVudEZyYW1lIiwiX2ZyYW1lQ291bnQiLCJvblN0b3JhZ2VSZWZyZXNoIiwiY3VycmVudEZyYW1lRGF0YSIsImN1cnJlbnRGcmFtZU9iaiIsImdldEZyYW1lT2JqZWN0IiwiaGlkZGVuRnJhbWVJbmRleCIsInZpZGVvIiwiY29udHJvbHMiLCJnZXRQbGF5YmFja0RhdGEiLCJ0b3RhbCIsImluZGV4IiwiZHVyYXRpb24iLCJwb3NpdGlvbiIsInBhdXNlIiwiZnJhbWVPYmoiLCJwbGF5IiwiX3BsYXliYWNrRXJyb3IiLCJzZXRBZGRpdGlvbmFsUGFyYW1zIiwibmFtZXMiLCJ2YWx1ZXMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJKU09OIiwicGFyc2UiLCJQcmVmcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImhlaWdodCIsImdldEludCIsIndpZHRoIiwiX2JhY2tncm91bmQiLCJDb21tb24iLCJCYWNrZ3JvdW5kIiwicGxheWVyRW5kZWQiLCJzaG93IiwicGxheWVyUmVhZHkiLCJfaW5pdGlhbGl6ZWQiLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiY29uc29sZSIsImRlYnVnIiwidHlwZSIsInN0b3AiLCJkYXRhIiwiX3JlZnJlc2hUaW1lciIsInNldFRpbWVvdXQiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJiYWNrZ3JvdW5kIiwiaW1hZ2UiLCJ1cmwiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcmVmcmVzaER1cmF0aW9uIiwidXNlSW1hZ2UiLCJfaXNTdG9yYWdlRmlsZSIsIl9jYWxsYmFjayIsIl9jb25maWd1cmUiLCJzdHIiLCJib2R5IiwiY29sb3IiLCJjbGFzc05hbWUiLCJzY2FsZSIsIk9iamVjdCIsImtleXMiLCJiYWNrZ3JvdW5kU3RvcmFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGV0YWlsIiwiZmlsZXMiLCJzZXRBdHRyaWJ1dGUiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImNvbXBhbnlJZCIsImdvIiwibG9nIiwic3BsaXQiLCJjYiIsInN0b3JhZ2UiLCJzb3J0Iiwic29ydERpcmVjdGlvbiIsImZvckVhY2giLCJmaWxlIiwicHVzaCIsIl9pbml0aWFsTG9hZCIsIm9yZGVyIiwiX2NsZWFyIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJQUkVGSVgiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsIm9ubG9hZCIsInZpc2liaWxpdHkiLCJjYWxsYmFjayIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsImdhIiwiYXN5bmMiLCJzcmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBRUEsR0FBc0IsbUJB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RSxFQUFNL0gsVUFBVSxLQUd2QjBILEdBQU9NLGNBQWdCLFdBQ3JCLE9BQU8sR0E0QlROLEVBQU9uQyxpQkFBaUIsZ0JBQWlCb0MsSUFFeENELE9BQVEvSCxRQUtYLElBQUlzSSxNQUFPQSxRQUVYQSxNQUFLekIsTUFBTSxjQUFlLGtCQUMxQnlCLEtBQUt6QixNQUFNLG1CQUVYLFdBQ0UsR0FBSTBCLEdBQUtyRixTQUFTcUUsY0FBYyxTQUFXZ0IsR0FBR3BFLEtBQU8sa0JBQW1Cb0UsRUFBR0MsT0FBUSxFQUNuRkQsRUFBR0UsS0FBTyxVQUFZdkYsU0FBU3dGLFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUkxRixTQUFTMkYscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVIsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvKlxuICAgICBOT1RFOiBSZWxhdGl2ZSBwYXRoIHRvIHNraW4gZmlsZSBkb2VzIG5vdCB3b3JrIHdoZW4gdmlld2luZy90ZXN0aW5nIGxvY2FsbHkgdXNpbmcgUHJldmlldyBhcHBcblxuICAgICBXaGVuIG5lZWRpbmcgdG8gd29yayBvbiBza2luIGZpbGUgXCJzaXgueG1sXCIsIHVwbG9hZCBmaWxlIHRvIHNlcnZlciBhbmQgY2hhbmdlIFNLSU4gdmFsdWUgdG8gcG9pbnQgdG8gc2VydmVyIGxvY2F0aW9uXG4gICAgIENPUlMgd2lsbCBiZSByZXF1aXJlZC4gSGFuZHkgQ09SUyBDaHJvbWUgZXh0ZW5zaW9uIGNhbiBiZSBmb3VuZCBoZXJlXG4gICAgIGh0dHBzOi8vY2hyb21lLmdvb2dsZS5jb20vd2Vic3RvcmUvZGV0YWlsL2FsbG93LWNvbnRyb2wtYWxsb3ctb3JpZ2kvbmxmYm1ib2pwZWFjZmdoa3BiamhkZGlobGtraWxqYmk/aGw9ZW5cbiAgICAgKi9cbiAgICBTS0lOOiBcIlwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwiY29tcG9uZW50cy9ydi1jb21tb24taTE4bi9kaXN0L2xvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24ud2lkZ2V0LmNvbW1vbi5zdG9yYWdlLXNlbGVjdG9yLmNvbmZpZ1wiKVxuICAgICAgLnZhbHVlKFwiU1RPUkFHRV9NT0RBTFwiLCBcImh0dHBzOi8vc3RvcmFnZS1zdGFnZS1ydmEtdGVzdC5yaXNldmlzaW9uLmNvbS9maWxlcy9cIik7XG4gIH1cbn1cblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcztcblxuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfYmFja2dyb3VuZCA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBudWxsO1xuXG4gIHZhciBfaW5pdGlhbGl6ZWQgPSBmYWxzZSxcbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuXG4gIHZhciBfY3VycmVudEZpbGVzLCBfY3VycmVudEZyYW1lO1xuXG4gIHZhciBfZnJhbWVDb3VudCA9IDA7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2RvbmUoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfZG9uZVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIikpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICBfc3RvcmFnZSA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWZyZXNoRnJhbWUoZnJhbWVJbmRleCkge1xuICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKGZyYW1lSW5kZXgsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKGZyYW1lSW5kZXgpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKGZyYW1lSW5kZXgpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcihmcmFtZUluZGV4LCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gICAgfSk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJscykge1xuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLkZyYW1lQ29udHJvbGxlcigpO1xuXG4gICAgLy8gYWRkIHRoZSBmaXJzdCBmcmFtZSBhbmQgY3JlYXRlIGl0cyBwbGF5ZXJcbiAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgwKTtcbiAgICBfY3VycmVudEZyYW1lID0gMDtcbiAgICBfZnJhbWVDb3VudCA9IDE7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigwLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gIH1cblxuICBmdW5jdGlvbiBvblN0b3JhZ2VSZWZyZXNoKHVybHMpIHtcbiAgICB2YXIgY3VycmVudEZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKSxcbiAgICAgIGhpZGRlbkZyYW1lSW5kZXggPSAoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCxcbiAgICAgIGN1cnJlbnRGcmFtZURhdGE7XG5cbiAgICBfY3VycmVudEZpbGVzID0gdXJscztcblxuICAgIC8vIEl0IGlzIGJlc3QgdG8gbGV0IHJlZnJlc2hpbmcgdGhlIGZyYW1lIHBsYXlsaXN0IGhhcHBlbiBpbiB0aGUgbm9ybWFsIGN5Y2xlIG9mIGZyYW1lIHN3YXBwaW5nIChwbGF5bGlzdCBjb21wbGV0aW9uKVxuICAgIC8vIEJlbG93IGlzIHRoZSBvbmx5IGNyaXRlcmlhIGZvciBzYWZlbHkgZm9yY2luZyBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIHdoaWxlIFdpZGdldCBpcyBpbiBhIFwicGxheVwiIG9yIFwicGF1c2VcIiBzdGF0ZVxuXG4gICAgLy8gV2lkZ2V0IGlzIGluIGEgc3RhdGUgb2YgXCJwbGF5XCIgb3IgXCJwYXVzZVwiIGFuZCBwbGF5bGlzdCBoYXMgbm90IGNvbXBsZXRlZC4gQSBoaWRkZW4gZnJhbWUgZGVmaW5pdGVseSBleGlzdHNcbiAgICBpZiAoY3VycmVudEZyYW1lT2JqKSB7XG4gICAgICAvLyBPbmx5IGlmIHRoZXJlIGFyZSBubyB2aWRlbyBjb250cm9scy5cbiAgICAgIC8vIFVzZXIgaW50ZXJhY3Rpbmcgd2l0aCBjb250cm9scywgcGFydGljdWxhcmx5IHNlZWtpbmcgYW5kIHNraXBwaW5nIHZpZGVvcywgd291bGQgY2F1c2UgaXNzdWVzXG4gICAgICBpZiAoIV9hZGRpdGlvbmFsUGFyYW1zLnZpZGVvLmNvbnRyb2xzKSB7XG4gICAgICAgIGN1cnJlbnRGcmFtZURhdGEgPSBjdXJyZW50RnJhbWVPYmouZ2V0UGxheWJhY2tEYXRhKCk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZURhdGEudG90YWwgPT09IChjdXJyZW50RnJhbWVEYXRhLmluZGV4ICsgMSkpIHtcbiAgICAgICAgICAvLyBUbyBiZSBzYWZlLCBvbmx5IHJlZnJlc2ggdGhlIGZyYW1lIHRoYXQncyBjdXJyZW50bHkgaGlkZGVuIGlmIGF0IGxlYXN0IDE1IHNlY29uZHMgYXJlIGxlZnQgb2YgZmluYWwgdmlkZW9cbiAgICAgICAgICBpZiAoKGN1cnJlbnRGcmFtZURhdGEuZHVyYXRpb24gLSBjdXJyZW50RnJhbWVEYXRhLnBvc2l0aW9uKSA+PSAxNSkge1xuICAgICAgICAgICAgX3JlZnJlc2hGcmFtZShoaWRkZW5GcmFtZUluZGV4KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ3VycmVudCBmcmFtZSBpcyBub3QgcGxheWluZyBsYXN0IHZpZGVvIGluIGxpc3QsIHNhZmUgdG8gcmVmcmVzaCB0aGUgZnJhbWUgdGhhdCdzIGN1cnJlbnRseSBoaWRkZW5cbiAgICAgICAgICBfcmVmcmVzaEZyYW1lKGhpZGRlbkZyYW1lSW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBmcmFtZU9iai5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmICghX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgICBmcmFtZU9iai5wbGF5KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBzZXQgY3VycmVudCBmcmFtZSB0byBiZSB0aGUgb25lIHZpc2libGVcbiAgICAgICAgX2N1cnJlbnRGcmFtZSA9IChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwO1xuXG4gICAgICAgIC8vIHBsYXkgdGhlIGN1cnJlbnQgZnJhbWUgdmlkZW9cbiAgICAgICAgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuICAgICAgICBmcmFtZU9iai5wbGF5KCk7XG5cbiAgICAgICAgLy8gcmUtYWRkIHByZXZpb3VzbHkgcmVtb3ZlZCBmcmFtZSBhbmQgY3JlYXRlIHRoZSBwbGF5ZXIsIGJ1dCBoaWRlIHZpc2liaWxpdHlcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuaGlkZSgoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdvdCBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgZmlyc3QgdmlkZW9cbiAgICAgIC8vIFNlbmQgVmlld2VyIFwiZG9uZVwiXG4gICAgICBfZG9uZSgpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKSArIFwicHhcIjtcblxuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIik7XG5cbiAgICAgICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBCYWNrZ3JvdW5kIGluc3RhbmNlXG4gICAgICAgIF9iYWNrZ3JvdW5kID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLkJhY2tncm91bmQoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgICBfYmFja2dyb3VuZC5pbml0KF9iYWNrZ3JvdW5kUmVhZHkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVuZGVkKCkge1xuICAgIGlmIChfcGxheWJhY2tFcnJvcikge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ2V0cyBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgZmlyc3QgdmlkZW9cbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApO1xuXG4gICAgICBfZG9uZSgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuc2hvdygoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9kb25lKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIGlmICghX2luaXRpYWxpemVkKSB7XG4gICAgICBpZiAoX2ZyYW1lQ291bnQgPT09IDIpIHtcbiAgICAgICAgLy8gYm90aCBmcmFtZXMgaGF2ZSBiZWVuIGNyZWF0ZWQgYW5kIGxvYWRlZCwgY2FuIG5vdGlmeSBWaWV3ZXIgd2lkZ2V0IGlzIHJlYWR5XG4gICAgICAgIF9pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIF9yZWFkeSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZmlyc3QgZnJhbWUgcGxheWVyIHdhcyBzdWNjZXNzZnVsIGFuZCByZWFkeSwgY3JlYXRlIHRoZSBzZWNvbmQgb25lIGJ1dCBoaWRlIGl0XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDEpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoMSk7XG4gICAgICAgIF9mcmFtZUNvdW50ID0gMjtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigxLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRXJyb3IoZXJyb3IpIHtcbiAgICBjb25zb2xlLmRlYnVnKFwidmlkZW8tZm9sZGVyOjpwbGF5ZXJFcnJvcigpXCIsIGVycm9yKTtcblxuICAgIGlmICghX2luaXRpYWxpemVkKSB7XG4gICAgICAvLyBXaWRnZXQgaGFzIG5vdCBzZW50IFwicmVhZHlcIiB5ZXQgYW5kIHRoZXJlIGlzIGFuIGVycm9yIChzZXR1cCBvciBwbGF5YmFjayBvZiBmaXJzdCB2aWRlbywgZG9lc24ndCBtYXR0ZXIgd2hpY2gpXG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lKTtcblxuICAgICAgLy8gZG8gbm90aGluZyBtb3JlLCBlbnN1cmUgXCJyZWFkeVwiIGlzIG5vdCBzZW50IHRvIFZpZXdlciBzbyB0aGF0IHRoaXMgd2lkZ2V0IGNhbiBiZSBza2lwcGVkXG5cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVycm9yLnR5cGUgPT09IFwic2V0dXBcIiB8fCBlcnJvci5pbmRleCA9PT0gMCkge1xuICAgICAgICAvLyBUaGlzIG9ubHkgaGFwcGVucyBpbiB0aGUgZXZlbnQgb2YgYSByZWZyZXNoLiBOZXcgZmlsZXMgY2F1c2VkIGFuIGVycm9yIGluIHNldHVwIG9yIGZpcnN0IHZpZGVvIGhhcyBhbiBpc3N1ZVxuICAgICAgICAvLyBUaGUgZXJyb3IgZXZlbnQgd2lsbCBiZSBjb21pbmcgZnJvbSB0aGUgY3VycmVudGx5IGhpZGRlbiBmcmFtZSB3aGVuIGl0IGdvdCByZWNyZWF0ZWQgd2l0aCBuZXcgZmlsZXMgdG8gdXNlXG4gICAgICAgIF9wbGF5YmFja0Vycm9yID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGZvcmNlIHdpZGdldCB0byBhY3QgYXMgdGhvdWdoIHRoZSBwbGF5bGlzdCBpcyBkb25lXG4gICAgICAgIHBsYXllckVuZGVkKCk7XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwib25TdG9yYWdlSW5pdFwiOiBvblN0b3JhZ2VJbml0LFxuICAgIFwib25TdG9yYWdlUmVmcmVzaFwiOiBvblN0b3JhZ2VSZWZyZXNoLFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLkJhY2tncm91bmQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2NhbGxiYWNrID0gbnVsbCxcbiAgICBfcmVhZHkgPSBmYWxzZSxcbiAgICBfYmFja2dyb3VuZCA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9yZWZyZXNoRHVyYXRpb24gPSA5MDAwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlLFxuICAgIF9zZXBhcmF0b3IgPSBcIlwiO1xuXG4gIC8qXG4gICAqIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX3JlZnJlc2hUaW1lcigpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIGJhY2tncm91bmRSZWZyZXNoKCkge1xuICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsICsgX3NlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIFwiKVwiO1xuICAgICAgX3JlZnJlc2hUaW1lcigpO1xuICAgIH0sIF9yZWZyZXNoRHVyYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICBfcmVhZHkgPSB0cnVlO1xuXG4gICAgaWYgKGRhdGEuYmFja2dyb3VuZC51c2VJbWFnZSAmJiAhX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgIC8vIHN0YXJ0IHRoZSByZWZyZXNoIHBvbGwgZm9yIG5vbi1zdG9yYWdlIGJhY2tncm91bmQgaW1hZ2VcbiAgICAgIF9yZWZyZXNoVGltZXIoKTtcbiAgICB9XG5cbiAgICBpZiAoX2NhbGxiYWNrICYmIHR5cGVvZiBfY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgX2NhbGxiYWNrKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NvbmZpZ3VyZSgpIHtcbiAgICB2YXIgc3RyO1xuXG4gICAgX2JhY2tncm91bmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRcIik7XG4gICAgX3N0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRTdG9yYWdlXCIpO1xuXG4gICAgLy8gc2V0IHRoZSBkb2N1bWVudCBiYWNrZ3JvdW5kXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kID0gZGF0YS5iYWNrZ3JvdW5kLmNvbG9yO1xuXG4gICAgaWYgKF9iYWNrZ3JvdW5kKSB7XG4gICAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlKSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5wb3NpdGlvbjtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnNjYWxlID8gX2JhY2tncm91bmQuY2xhc3NOYW1lICsgXCIgc2NhbGUtdG8tZml0XCJcbiAgICAgICAgICA6IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZTtcblxuICAgICAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhkYXRhLmJhY2tncm91bmRTdG9yYWdlKS5sZW5ndGggIT09IDApO1xuXG4gICAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgICBzdHIgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3NlcGFyYXRvciA9IChzdHIubGVuZ3RoID09PSAxKSA/IFwiP1wiIDogXCImXCI7XG5cbiAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBcIilcIjtcbiAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF9zdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgICAgICAgIF9zdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGUuZGV0YWlsLmZpbGVzWzBdLnVybCArIFwiKVwiO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKCFfcmVhZHkpIHtcbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5mb2xkZXIpO1xuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5jb21wYW55SWQpO1xuICAgICAgICAgICAgX3N0b3JhZ2UuZ28oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCB2YWx1ZSBvZiAnYmFja2dyb3VuZFN0b3JhZ2UnXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kJ1wiKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoY2IpIHtcbiAgICBpZiAoIV9yZWFkeSkge1xuICAgICAgaWYgKGNiKSB7XG4gICAgICAgIF9jYWxsYmFjayA9IGNiO1xuICAgICAgfVxuXG4gICAgICBfY29uZmlndXJlKCk7XG5cbiAgICB9IGVsc2UgaWYgKGNiICYmIHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjYigpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2luaXRpYWxMb2FkID0gdHJ1ZTtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvRm9sZGVyU3RvcmFnZVwiKSxcbiAgICAgIHNvcnQgPSBcIlwiLFxuICAgICAgc29ydERpcmVjdGlvbiA9IFwiXCI7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHVybHMgPSBbXTtcblxuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZS5kZXRhaWwuZmlsZXMuZm9yRWFjaChmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgdXJscy5wdXNoKGZpbGUudXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VJbml0KHVybHMpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VSZWZyZXNoKHVybHMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuXG4gICAgLy8gU29ydGluZ1xuICAgIHN3aXRjaCAoZGF0YS5vcmRlcikge1xuICAgICAgY2FzZSBcImFscGhhLWFzY1wiOlxuICAgICAgICBzb3J0ID0gXCJuYW1lXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhbHBoYS1kZXNjXCI6XG4gICAgICAgIHNvcnQgPSBcIm5hbWVcIjtcbiAgICAgICAgc29ydERpcmVjdGlvbiA9IFwiZGVzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkYXRlLWFzY1wiOlxuICAgICAgICBzb3J0ID0gXCJkYXRlXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkYXRlLWRlc2NcIjpcbiAgICAgICAgc29ydCA9IFwiZGF0ZVwiO1xuICAgICAgICBzb3J0RGlyZWN0aW9uID0gXCJkZXNjXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInJhbmRvbVwiOlxuICAgICAgICBzb3J0ID0gXCJyYW5kb21cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzb3J0ID0gXCJuYW1lXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgIH1cblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwic29ydFwiLCBzb3J0KTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcInNvcnREaXJlY3Rpb25cIiwgc29ydERpcmVjdGlvbik7XG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxuLyogZ2xvYmFsIGNvbmZpZyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9jbGVhcihpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KSxcbiAgICAgIGlmcmFtZSwgZnJhbWVPYmo7XG5cbiAgICB0cnkge1xuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcbiAgICAgIGZyYW1lT2JqID0gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgICBmcmFtZU9iai5yZW1vdmUoKTtcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZGVidWcoZSk7XG4gICAgfVxuXG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG5cbiAgZnVuY3Rpb24gYWRkKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyLCBpZnJhbWU7XG5cbiAgICBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcblxuICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImFsbG93VHJhbnNwYXJlbmN5XCIsIHRydWUpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNjcm9sbGluZ1wiLCBcIm5vXCIpO1xuXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzKSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcblxuICAgIGlmIChpZnJhbWUpIHtcbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmcmFtZS5vbmxvYWQgPSBudWxsO1xuXG4gICAgICAgIHZhciBmcmFtZU9iaiA9IChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG5cbiAgICAgICAgLy8gaW5pdGlhbGl6ZSBhbmQgbG9hZCB0aGUgcGxheWVyIGluc2lkZSB0aGUgaWZyYW1lXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgY29uZmlnLlNLSU4pO1xuICAgICAgfTtcblxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcInBsYXllci5odG1sXCIpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0RnJhbWVPYmplY3QoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgaWYgKGlmcmFtZSkge1xuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gaGlkZShpbmRleCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KS5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG5cbiAgICBfY2xlYXIoaW5kZXgpO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcbiAgICAgIHdoaWxlIChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIGZyYW1lQ29udGFpbmVyLnJlbW92ZUNoaWxkKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhpbmRleCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KS5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZDogYWRkLFxuICAgIGNyZWF0ZUZyYW1lUGxheWVyOiBjcmVhdGVGcmFtZVBsYXllcixcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXG4gICAgaGlkZTogaGlkZSxcbiAgICByZW1vdmU6IHJlbW92ZSxcbiAgICBzaG93OiBzaG93XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbHltZXJSZWFkeSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTQnXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9