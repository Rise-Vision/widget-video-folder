if("undefined"==typeof config){var config={SKIN:""};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","https://storage-stage-rva-test.risevision.com/files/"))}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,y.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,y.getString("id"),!0,!0,!0,!0,!0)}function o(e){V.remove(e,function(){V.add(e),V.hide(e),V.createFramePlayer(e,g,f)})}function i(e){f=e,V=new RiseVision.VideoFolder.FrameController,V.add(0),p=0,R=1,V.createFramePlayer(0,g,f)}function r(e){var t,n=V.getFrameObject(p),i=0===p?1:0;f=e,n&&(g.video.controls||(t=n.getPlaybackData(),t.total===t.index+1?t.duration-t.position>=15&&o(i):o(i)))}function a(){var e=V.getFrameObject(p);e&&e.pause()}function s(){var e=V.getFrameObject(p);F?t():e?e.play():(p=0===p?1:0,e=V.getFrameObject(p),e.play(),V.add(0===p?1:0),V.hide(0===p?1:0),V.createFramePlayer(0===p?1:0,g,f))}function c(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(g=JSON.parse(n[0]),y=new e.Prefs,document.getElementById("videoContainer").style.height=y.getInt("rsH")+"px",g.width=y.getInt("rsW"),g.height=y.getInt("rsH"),v=new RiseVision.VideoFolder.Storage(g),v.init())}function d(){F?(V.remove(p),V.remove(0===p?1:0),t()):(V.show(0===p?1:0),V.remove(p,function(){t()}))}function l(){h||(2===R?(h=!0,n()):(V.add(1),V.hide(1),R=2,V.createFramePlayer(1,g,f)))}function u(e){console.debug("video-folder::playerError()",e),h?"setup"===e.type||0===e.index?F=!0:d():V.remove(p)}function m(){a()}var g,f,p,y=null,v=null,V=null,h=!1,F=!1,R=0;return{onStorageInit:i,onStorageRefresh:r,pause:a,play:s,setAdditionalParams:c,playerEnded:d,playerReady:l,playerError:u,stop:m}}(gadgets);var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),t.go())}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.FrameController=function(){"use strict";function e(e){var t,n,o=document.getElementById(s+e);try{t=o.querySelector("iframe"),n=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument,n.remove(),t.setAttribute("src","about:blank")}catch(i){console.debug(i)}}function t(e){var t,n;t=document.getElementById(s+e),n=document.createElement("iframe"),n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),t.appendChild(n)}function n(e,t,n){var o,i=document.getElementById(s+e);o=i.querySelector("iframe"),o&&(o.onload=function(){o.onload=null;var e=o.contentWindow?o.contentWindow:o.contentDocument.document?o.contentDocument.document:o.contentDocument;e.init(t,n,config.SKIN)},o.setAttribute("src","player.html"))}function o(e){var t,n=document.getElementById(s+e);return t=n.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function i(e){document.getElementById(s+e).style.visibility="hidden"}function r(t,n){var o=document.getElementById(s+t);e(t),setTimeout(function(){for(;o.firstChild;)o.removeChild(o.firstChild);n&&"function"==typeof n&&n()},200)}function a(e){document.getElementById(s+e).style.visibility="visible"}var s="if_";return{add:t,createFramePlayer:n,getFrameObject:o,hide:i,remove:r,show:a}},function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsInZhbHVlIiwiUmlzZVZpc2lvbiIsIlZpZGVvRm9sZGVyIiwiZ2FkZ2V0cyIsIl9kb25lIiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl9yZWFkeSIsIl9yZWZyZXNoRnJhbWUiLCJmcmFtZUluZGV4IiwiX2ZyYW1lQ29udHJvbGxlciIsInJlbW92ZSIsImFkZCIsImhpZGUiLCJjcmVhdGVGcmFtZVBsYXllciIsIl9hZGRpdGlvbmFsUGFyYW1zIiwiX2N1cnJlbnRGaWxlcyIsIm9uU3RvcmFnZUluaXQiLCJ1cmxzIiwiRnJhbWVDb250cm9sbGVyIiwiX2N1cnJlbnRGcmFtZSIsIl9mcmFtZUNvdW50Iiwib25TdG9yYWdlUmVmcmVzaCIsImN1cnJlbnRGcmFtZURhdGEiLCJjdXJyZW50RnJhbWVPYmoiLCJnZXRGcmFtZU9iamVjdCIsImhpZGRlbkZyYW1lSW5kZXgiLCJ2aWRlbyIsImNvbnRyb2xzIiwiZ2V0UGxheWJhY2tEYXRhIiwidG90YWwiLCJpbmRleCIsImR1cmF0aW9uIiwicG9zaXRpb24iLCJwYXVzZSIsImZyYW1lT2JqIiwicGxheSIsIl9wbGF5YmFja0Vycm9yIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJ3aWR0aCIsIl9zdG9yYWdlIiwiU3RvcmFnZSIsImluaXQiLCJwbGF5ZXJFbmRlZCIsInNob3ciLCJwbGF5ZXJSZWFkeSIsIl9pbml0aWFsaXplZCIsInBsYXllckVycm9yIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVidWciLCJ0eXBlIiwic3RvcCIsImRhdGEiLCJzdG9yYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJmaWxlcyIsImZvckVhY2giLCJmaWxlIiwicHVzaCIsInVybCIsIl9pbml0aWFsTG9hZCIsInNldEF0dHJpYnV0ZSIsImNvbXBhbnlJZCIsImZvbGRlciIsImdvIiwiX2NsZWFyIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJQUkVGSVgiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsIm9ubG9hZCIsInZpc2liaWxpdHkiLCJjYWxsYmFjayIsInNldFRpbWVvdXQiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJ3aW5kb3ciLCJwb2x5bWVyUmVhZHkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaWQiLCJyZWdpc3RlciIsInByZWZzIiwib25jb250ZXh0bWVudSIsIl9nYXEiLCJnYSIsImFzeW5jIiwic3JjIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUVBLEdBQXNCLG1CQUFYQSxRQUF3QixDQUNqQyxHQUFJQSxTQVFGQyxLQUFNLEdBR2Usb0JBQVpDLFdBQ1RBLFFBQVFDLE9BQU8sb0NBQ1pDLFNBQVMsaUJBQWtCLHVEQUMzQkEsU0FBUyxnQkFBaUIsU0FFN0JGLFFBQVFDLE9BQU8sb0RBQ1pFLE1BQU0sZ0JBQWlCLHlEQU05QixHQUFJQyxZQUFhQSxjQUNqQkEsWUFBV0MsZUFFWEQsV0FBV0MsWUFBYyxTQUFXQyxHQUNsQyxZQWtCQSxTQUFTQyxLQUNQRCxFQUFRRSxJQUFJQyxLQUFLLEdBQUksZUFBZ0IsS0FBTUMsRUFBT0MsVUFBVSxPQUc5RCxRQUFTQyxLQUNQTixFQUFRRSxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FDM0QsR0FBTSxHQUFNLEdBQU0sR0FB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LGNBQWdCLGNBQWdCLDZCQUNuRixJQUFJQyxHQUFJL0QsU0FBU2dFLHFCQUFxQixVQUFVLEVBQUlELEdBQUVFLFdBQVdDLGFBQWFSLEVBQUlLIiwiZmlsZSI6ImpzL3dpZGdldC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgY29uZmlnOiB0cnVlICovXG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgY29uZmlnID09PSBcInVuZGVmaW5lZFwiKSB7XG4gIHZhciBjb25maWcgPSB7XG4gICAgLypcbiAgICAgTk9URTogUmVsYXRpdmUgcGF0aCB0byBza2luIGZpbGUgZG9lcyBub3Qgd29yayB3aGVuIHZpZXdpbmcvdGVzdGluZyBsb2NhbGx5IHVzaW5nIFByZXZpZXcgYXBwXG5cbiAgICAgV2hlbiBuZWVkaW5nIHRvIHdvcmsgb24gc2tpbiBmaWxlIFwic2l4LnhtbFwiLCB1cGxvYWQgZmlsZSB0byBzZXJ2ZXIgYW5kIGNoYW5nZSBTS0lOIHZhbHVlIHRvIHBvaW50IHRvIHNlcnZlciBsb2NhdGlvblxuICAgICBDT1JTIHdpbGwgYmUgcmVxdWlyZWQuIEhhbmR5IENPUlMgQ2hyb21lIGV4dGVuc2lvbiBjYW4gYmUgZm91bmQgaGVyZVxuICAgICBodHRwczovL2Nocm9tZS5nb29nbGUuY29tL3dlYnN0b3JlL2RldGFpbC9hbGxvdy1jb250cm9sLWFsbG93LW9yaWdpL25sZmJtYm9qcGVhY2ZnaGtwYmpoZGRpaGxra2lsamJpP2hsPWVuXG4gICAgICovXG4gICAgU0tJTjogXCJcIlxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImNvbXBvbmVudHMvcnYtY29tbW9uLWkxOG4vZGlzdC9sb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24uc3RvcmFnZS1zZWxlY3Rvci5jb25maWdcIilcbiAgICAgIC52YWx1ZShcIlNUT1JBR0VfTU9EQUxcIiwgXCJodHRwczovL3N0b3JhZ2Utc3RhZ2UtcnZhLXRlc3QucmlzZXZpc2lvbi5jb20vZmlsZXMvXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IChmdW5jdGlvbiAoZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FkZGl0aW9uYWxQYXJhbXM7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBudWxsO1xuXG4gIHZhciBfaW5pdGlhbGl6ZWQgPSBmYWxzZSxcbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuXG4gIHZhciBfY3VycmVudEZpbGVzLCBfY3VycmVudEZyYW1lO1xuXG4gIHZhciBfZnJhbWVDb3VudCA9IDA7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2RvbmUoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfZG9uZVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIikpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2hGcmFtZShmcmFtZUluZGV4KSB7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoZnJhbWVJbmRleCwgZnVuY3Rpb24gKCkge1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoZnJhbWVJbmRleCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoZnJhbWVJbmRleCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKGZyYW1lSW5kZXgsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gb25TdG9yYWdlSW5pdCh1cmxzKSB7XG4gICAgX2N1cnJlbnRGaWxlcyA9IHVybHM7XG5cbiAgICBfZnJhbWVDb250cm9sbGVyID0gbmV3IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAvLyBhZGQgdGhlIGZpcnN0IGZyYW1lIGFuZCBjcmVhdGUgaXRzIHBsYXllclxuICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgIF9jdXJyZW50RnJhbWUgPSAwO1xuICAgIF9mcmFtZUNvdW50ID0gMTtcbiAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKDAsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJscykge1xuICAgIHZhciBjdXJyZW50RnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpLFxuICAgICAgaGlkZGVuRnJhbWVJbmRleCA9IChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwLFxuICAgICAgY3VycmVudEZyYW1lRGF0YTtcblxuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuXG4gICAgLy8gSXQgaXMgYmVzdCB0byBsZXQgcmVmcmVzaGluZyB0aGUgZnJhbWUgcGxheWxpc3QgaGFwcGVuIGluIHRoZSBub3JtYWwgY3ljbGUgb2YgZnJhbWUgc3dhcHBpbmcgKHBsYXlsaXN0IGNvbXBsZXRpb24pXG4gICAgLy8gQmVsb3cgaXMgdGhlIG9ubHkgY3JpdGVyaWEgZm9yIHNhZmVseSBmb3JjaW5nIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgd2hpbGUgV2lkZ2V0IGlzIGluIGEgXCJwbGF5XCIgb3IgXCJwYXVzZVwiIHN0YXRlXG5cbiAgICAvLyBXaWRnZXQgaXMgaW4gYSBzdGF0ZSBvZiBcInBsYXlcIiBvciBcInBhdXNlXCIgYW5kIHBsYXlsaXN0IGhhcyBub3QgY29tcGxldGVkLiBBIGhpZGRlbiBmcmFtZSBkZWZpbml0ZWx5IGV4aXN0c1xuICAgIGlmIChjdXJyZW50RnJhbWVPYmopIHtcbiAgICAgIC8vIE9ubHkgaWYgdGhlcmUgYXJlIG5vIHZpZGVvIGNvbnRyb2xzLlxuICAgICAgLy8gVXNlciBpbnRlcmFjdGluZyB3aXRoIGNvbnRyb2xzLCBwYXJ0aWN1bGFybHkgc2Vla2luZyBhbmQgc2tpcHBpbmcgdmlkZW9zLCB3b3VsZCBjYXVzZSBpc3N1ZXNcbiAgICAgIGlmICghX2FkZGl0aW9uYWxQYXJhbXMudmlkZW8uY29udHJvbHMpIHtcbiAgICAgICAgY3VycmVudEZyYW1lRGF0YSA9IGN1cnJlbnRGcmFtZU9iai5nZXRQbGF5YmFja0RhdGEoKTtcblxuICAgICAgICBpZiAoY3VycmVudEZyYW1lRGF0YS50b3RhbCA9PT0gKGN1cnJlbnRGcmFtZURhdGEuaW5kZXggKyAxKSkge1xuICAgICAgICAgIC8vIFRvIGJlIHNhZmUsIG9ubHkgcmVmcmVzaCB0aGUgZnJhbWUgdGhhdCdzIGN1cnJlbnRseSBoaWRkZW4gaWYgYXQgbGVhc3QgMTUgc2Vjb25kcyBhcmUgbGVmdCBvZiBmaW5hbCB2aWRlb1xuICAgICAgICAgIGlmICgoY3VycmVudEZyYW1lRGF0YS5kdXJhdGlvbiAtIGN1cnJlbnRGcmFtZURhdGEucG9zaXRpb24pID49IDE1KSB7XG4gICAgICAgICAgICBfcmVmcmVzaEZyYW1lKGhpZGRlbkZyYW1lSW5kZXgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBDdXJyZW50IGZyYW1lIGlzIG5vdCBwbGF5aW5nIGxhc3QgdmlkZW8gaW4gbGlzdCwgc2FmZSB0byByZWZyZXNoIHRoZSBmcmFtZSB0aGF0J3MgY3VycmVudGx5IGhpZGRlblxuICAgICAgICAgIF9yZWZyZXNoRnJhbWUoaGlkZGVuRnJhbWVJbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGZyYW1lT2JqLnBhdXNlKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgaWYgKCFfcGxheWJhY2tFcnJvcikge1xuICAgICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHNldCBjdXJyZW50IGZyYW1lIHRvIGJlIHRoZSBvbmUgdmlzaWJsZVxuICAgICAgICBfY3VycmVudEZyYW1lID0gKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDA7XG5cbiAgICAgICAgLy8gcGxheSB0aGUgY3VycmVudCBmcmFtZSB2aWRlb1xuICAgICAgICBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcblxuICAgICAgICAvLyByZS1hZGQgcHJldmlvdXNseSByZW1vdmVkIGZyYW1lIGFuZCBjcmVhdGUgdGhlIHBsYXllciwgYnV0IGhpZGUgdmlzaWJpbGl0eVxuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCkpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCksIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ290IHNldCB1cG9uIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgYW5kIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBzZXR1cCBvciBmaXJzdCB2aWRlb1xuICAgICAgLy8gU2VuZCBWaWV3ZXIgXCJkb25lXCJcbiAgICAgIF9kb25lKCk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1swXSk7XG4gICAgICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoID0gX3ByZWZzLmdldEludChcInJzV1wiKTtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKTtcblxuICAgICAgICAvLyBjcmVhdGUgYW5kIGluaXRpYWxpemUgdGhlIFN0b3JhZ2UgbW9kdWxlIGluc3RhbmNlXG4gICAgICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuU3RvcmFnZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFbmRlZCgpIHtcbiAgICBpZiAoX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdldHMgc2V0IHVwb24gYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSBhbmQgdGhlcmUgd2FzIGFuIGVycm9yIGluIHNldHVwIG9yIGZpcnN0IHZpZGVvXG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lKTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKTtcblxuICAgICAgX2RvbmUoKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnNob3coKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBfZG9uZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgICBpZiAoIV9pbml0aWFsaXplZCkge1xuICAgICAgaWYgKF9mcmFtZUNvdW50ID09PSAyKSB7XG4gICAgICAgIC8vIGJvdGggZnJhbWVzIGhhdmUgYmVlbiBjcmVhdGVkIGFuZCBsb2FkZWQsIGNhbiBub3RpZnkgVmlld2VyIHdpZGdldCBpcyByZWFkeVxuICAgICAgICBfaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICBfcmVhZHkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGZpcnN0IGZyYW1lIHBsYXllciB3YXMgc3VjY2Vzc2Z1bCBhbmQgcmVhZHksIGNyZWF0ZSB0aGUgc2Vjb25kIG9uZSBidXQgaGlkZSBpdFxuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgxKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKDEpO1xuICAgICAgICBfZnJhbWVDb3VudCA9IDI7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMSwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVycm9yKGVycm9yKSB7XG4gICAgY29uc29sZS5kZWJ1ZyhcInZpZGVvLWZvbGRlcjo6cGxheWVyRXJyb3IoKVwiLCBlcnJvcik7XG5cbiAgICBpZiAoIV9pbml0aWFsaXplZCkge1xuICAgICAgLy8gV2lkZ2V0IGhhcyBub3Qgc2VudCBcInJlYWR5XCIgeWV0IGFuZCB0aGVyZSBpcyBhbiBlcnJvciAoc2V0dXAgb3IgcGxheWJhY2sgb2YgZmlyc3QgdmlkZW8sIGRvZXNuJ3QgbWF0dGVyIHdoaWNoKVxuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICAgIC8vIGRvIG5vdGhpbmcgbW9yZSwgZW5zdXJlIFwicmVhZHlcIiBpcyBub3Qgc2VudCB0byBWaWV3ZXIgc28gdGhhdCB0aGlzIHdpZGdldCBjYW4gYmUgc2tpcHBlZFxuXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChlcnJvci50eXBlID09PSBcInNldHVwXCIgfHwgZXJyb3IuaW5kZXggPT09IDApIHtcbiAgICAgICAgLy8gVGhpcyBvbmx5IGhhcHBlbnMgaW4gdGhlIGV2ZW50IG9mIGEgcmVmcmVzaC4gTmV3IGZpbGVzIGNhdXNlZCBhbiBlcnJvciBpbiBzZXR1cCBvciBmaXJzdCB2aWRlbyBoYXMgYW4gaXNzdWVcbiAgICAgICAgLy8gVGhlIGVycm9yIGV2ZW50IHdpbGwgYmUgY29taW5nIGZyb20gdGhlIGN1cnJlbnRseSBoaWRkZW4gZnJhbWUgd2hlbiBpdCBnb3QgcmVjcmVhdGVkIHdpdGggbmV3IGZpbGVzIHRvIHVzZVxuICAgICAgICBfcGxheWJhY2tFcnJvciA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBmb3JjZSB3aWRnZXQgdG8gYWN0IGFzIHRob3VnaCB0aGUgcGxheWxpc3QgaXMgZG9uZVxuICAgICAgICBwbGF5ZXJFbmRlZCgpO1xuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0ZvbGRlclN0b3JhZ2VcIik7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHVybHMgPSBbXTtcblxuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZS5kZXRhaWwuZmlsZXMuZm9yRWFjaChmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgdXJscy5wdXNoKGZpbGUudXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VJbml0KHVybHMpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VSZWZyZXNoKHVybHMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuXG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxuLyogZ2xvYmFsIGNvbmZpZyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9jbGVhcihpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KSxcbiAgICAgIGlmcmFtZSwgZnJhbWVPYmo7XG5cbiAgICB0cnkge1xuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcbiAgICAgIGZyYW1lT2JqID0gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgICBmcmFtZU9iai5yZW1vdmUoKTtcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJhYm91dDpibGFua1wiKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZGVidWcoZSk7XG4gICAgfVxuXG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG5cbiAgZnVuY3Rpb24gYWRkKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyLCBpZnJhbWU7XG5cbiAgICBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcblxuICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImFsbG93VHJhbnNwYXJlbmN5XCIsIHRydWUpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJmcmFtZWJvcmRlclwiLCBcIjBcIik7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNjcm9sbGluZ1wiLCBcIm5vXCIpO1xuXG4gICAgZnJhbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lUGxheWVyKGluZGV4LCBwYXJhbXMsIGZpbGVzKSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcblxuICAgIGlmIChpZnJhbWUpIHtcbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmcmFtZS5vbmxvYWQgPSBudWxsO1xuXG4gICAgICAgIHZhciBmcmFtZU9iaiA9IChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG5cbiAgICAgICAgLy8gaW5pdGlhbGl6ZSBhbmQgbG9hZCB0aGUgcGxheWVyIGluc2lkZSB0aGUgaWZyYW1lXG4gICAgICAgIGZyYW1lT2JqLmluaXQocGFyYW1zLCBmaWxlcywgY29uZmlnLlNLSU4pO1xuICAgICAgfTtcblxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcInBsYXllci5odG1sXCIpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0RnJhbWVPYmplY3QoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgaWYgKGlmcmFtZSkge1xuICAgICAgcmV0dXJuIChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gaGlkZShpbmRleCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KS5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZShpbmRleCwgY2FsbGJhY2spIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG5cbiAgICBfY2xlYXIoaW5kZXgpO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyByZW1vdmUgdGhlIGlmcmFtZSBieSBjbGVhcmluZyBhbGwgZWxlbWVudHMgaW5zaWRlIGRpdiBjb250YWluZXJcbiAgICAgIHdoaWxlIChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIGZyYW1lQ29udGFpbmVyLnJlbW92ZUNoaWxkKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9LCAyMDApO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhpbmRleCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KS5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZDogYWRkLFxuICAgIGNyZWF0ZUZyYW1lUGxheWVyOiBjcmVhdGVGcmFtZVBsYXllcixcbiAgICBnZXRGcmFtZU9iamVjdDogZ2V0RnJhbWVPYmplY3QsXG4gICAgaGlkZTogaGlkZSxcbiAgICByZW1vdmU6IHJlbW92ZSxcbiAgICBzaG93OiBzaG93XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbHltZXJSZWFkeSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTQnXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9