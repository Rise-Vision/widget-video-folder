if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,y.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,y.getString("id"),!0,!0,!0,!0,!0)}function i(e){V.remove(e,function(){V.add(e),V.hide(e),V.createFramePlayer(e,f,g,config.SKIN,"player.html")})}function o(e){g=e,V=new RiseVision.Common.Video.FrameController,V.add(0),p=0,F=1,V.createFramePlayer(0,f,g,config.SKIN,"player.html")}function r(e){var t,n=V.getFrameObject(p),o=0===p?1:0;g=e,n&&(f.video.controls||(t=n.getPlaybackData(),t.total===t.index+1?t.duration-t.position>=15&&i(o):i(o)))}function a(){var e=V.getFrameObject(p);e&&e.pause()}function s(){var e=V.getFrameObject(p);R?t():e?e.play():(p=0===p?1:0,e=V.getFrameObject(p),e.play(),V.add(0===p?1:0),V.hide(0===p?1:0),V.createFramePlayer(0===p?1:0,f,g,config.SKIN,"player.html"))}function l(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(f=JSON.parse(n[0]),y=new e.Prefs,document.getElementById("videoContainer").style.height=y.getInt("rsH")+"px",f.width=y.getInt("rsW"),f.height=y.getInt("rsH"),v=new RiseVision.VideoFolder.Storage(f),v.init())}function c(){R?(V.remove(p),V.remove(0===p?1:0),t()):(V.show(0===p?1:0),V.remove(p,function(){t()}))}function d(){h||(2===F?(h=!0,n()):(V.add(1),V.hide(1),F=2,V.createFramePlayer(1,f,g,config.SKIN,"player.html")))}function u(e){console.debug("video-folder::playerError()",e),h?"setup"===e.type||0===e.index?R=!0:c():V.remove(p)}function m(){a()}var f,g,p,y=null,v=null,V=null,h=!1,R=!1,F=0;return{onStorageInit:o,onStorageRefresh:r,pause:a,play:s,setAdditionalParams:l,playerEnded:c,playerReady:d,playerError:u,stop:m}}(gadgets);var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),t.go())}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(l+e)}function t(t){var n,i=e(t);return n=i.querySelector("iframe"),n?n.contentWindow?n.contentWindow:n.contentDocument.document?n.contentDocument.document:n.contentDocument:null}function n(n){var i,o=e(n),r=t(n);r&&(i=o.querySelector("iframe"),r.remove(),i.setAttribute("src","about:blank"))}function i(t){var n=e(t),i=document.createElement("iframe");i.setAttribute("allowTransparency",!0),i.setAttribute("frameborder","0"),i.setAttribute("scrolling","no"),n.appendChild(i)}function o(n,i,o,r,a){var s,l=e(n),c=t(n);c&&(s=l.querySelector("iframe"),s.onload=function(){s.onload=null,c.init(i,o,r),c.load()},s.setAttribute("src",a))}function r(t){var n=e(t);n.style.visibility="hidden"}function a(e,t){var i=document.getElementById(l+e);n(e),setTimeout(function(){for(;i.firstChild;)i.removeChild(i.firstChild);t&&"function"==typeof t&&t()},200)}function s(t){var n=e(t);n.style.visibility="visible"}var l="if_";return{add:i,createFramePlayer:o,getFrameContainer:e,getFrameObject:t,hide:r,remove:a,show:s}},function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function i(){RiseVision.VideoFolder.pause()}function o(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,i),t.rpc.register("rscmd_stop_"+s,o),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlb0ZvbGRlciIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfcmVmcmVzaEZyYW1lIiwiZnJhbWVJbmRleCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJhZGQiLCJoaWRlIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJfYWRkaXRpb25hbFBhcmFtcyIsIl9jdXJyZW50RmlsZXMiLCJvblN0b3JhZ2VJbml0IiwidXJscyIsIkNvbW1vbiIsIlZpZGVvIiwiRnJhbWVDb250cm9sbGVyIiwiX2N1cnJlbnRGcmFtZSIsIl9mcmFtZUNvdW50Iiwib25TdG9yYWdlUmVmcmVzaCIsImN1cnJlbnRGcmFtZURhdGEiLCJjdXJyZW50RnJhbWVPYmoiLCJnZXRGcmFtZU9iamVjdCIsImhpZGRlbkZyYW1lSW5kZXgiLCJ2aWRlbyIsImNvbnRyb2xzIiwiZ2V0UGxheWJhY2tEYXRhIiwidG90YWwiLCJpbmRleCIsImR1cmF0aW9uIiwicG9zaXRpb24iLCJwYXVzZSIsImZyYW1lT2JqIiwicGxheSIsIl9wbGF5YmFja0Vycm9yIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJ3aWR0aCIsIl9zdG9yYWdlIiwiU3RvcmFnZSIsImluaXQiLCJwbGF5ZXJFbmRlZCIsInNob3ciLCJwbGF5ZXJSZWFkeSIsIl9pbml0aWFsaXplZCIsInBsYXllckVycm9yIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVidWciLCJ0eXBlIiwic3RvcCIsImRhdGEiLCJzdG9yYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJmaWxlcyIsImZvckVhY2giLCJmaWxlIiwicHVzaCIsInVybCIsIl9pbml0aWFsTG9hZCIsInNldEF0dHJpYnV0ZSIsImNvbXBhbnlJZCIsImZvbGRlciIsImdvIiwiZ2V0RnJhbWVDb250YWluZXIiLCJQUkVGSVgiLCJpZnJhbWUiLCJmcmFtZUNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50V2luZG93IiwiY29udGVudERvY3VtZW50IiwiX2NsZWFyIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwicGFyYW1zIiwic2tpbiIsInNyYyIsIm9ubG9hZCIsImxvYWQiLCJ2aXNpYmlsaXR5IiwiY2FsbGJhY2siLCJzZXRUaW1lb3V0IiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwid2luZG93IiwicG9seW1lclJlYWR5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlkIiwicmVnaXN0ZXIiLCJwcmVmcyIsIm9uY29udGV4dG1lbnUiLCJfZ2FxIiwiZ2EiLCJhc3luYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFFQSxHQUFzQixtQkFBWEEsUUFBd0IsQ0FDakMsR0FBSUEsU0FDRkMsS0FBTSxrQkFHZSxvQkFBWkMsVUFDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0Isd0JBQzNCQSxTQUFTLGdCQUFpQixTQU1qQyxHQUFJQyxZQUFhQSxjQUNqQkEsWUFBV0MsZUFFWEQsV0FBV0MsWUFBYyxTQUFXQyxHQUNsQyxZQWtCQSxTQUFTQyxLQUNQRCxFQUFRRSxJQUFJQyxLQUFLLEdBQUksZUFBZ0IsS0FBTUMsRUFBT0MsVUFBVSxPQUc5RCxRQUFTQyxLQUNQTixFQUFRRSxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FDM0QsR0FBTSxHQUFNLEdB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U0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSWxFLFNBQVNtRSxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUCxFQUFJSSIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIFNLSU46IFwic2tpbi9SVlNraW4ueG1sXCJcbiAgfTtcblxuICBpZiAodHlwZW9mIGFuZ3VsYXIgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24uY29tbW9uLmkxOG4uY29uZmlnXCIsIFtdKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJsb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgICAgLmNvbnN0YW50KFwiTE9DQUxFU19TVUZJWFwiLCBcIi5qc29uXCIpO1xuICB9XG59XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcztcblxuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG51bGw7XG5cbiAgdmFyIF9pbml0aWFsaXplZCA9IGZhbHNlLFxuICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2U7XG5cbiAgdmFyIF9jdXJyZW50RmlsZXMsIF9jdXJyZW50RnJhbWU7XG5cbiAgdmFyIF9mcmFtZUNvdW50ID0gMDtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVmcmVzaEZyYW1lKGZyYW1lSW5kZXgpIHtcbiAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShmcmFtZUluZGV4LCBmdW5jdGlvbiAoKSB7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmFkZChmcmFtZUluZGV4KTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuaGlkZShmcmFtZUluZGV4KTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoZnJhbWVJbmRleCwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMsIGNvbmZpZy5TS0lOLCBcInBsYXllci5odG1sXCIpO1xuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBvblN0b3JhZ2VJbml0KHVybHMpIHtcbiAgICBfY3VycmVudEZpbGVzID0gdXJscztcblxuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAvLyBhZGQgdGhlIGZpcnN0IGZyYW1lIGFuZCBjcmVhdGUgaXRzIHBsYXllclxuICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgIF9jdXJyZW50RnJhbWUgPSAwO1xuICAgIF9mcmFtZUNvdW50ID0gMTtcbiAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKDAsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJscykge1xuICAgIHZhciBjdXJyZW50RnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpLFxuICAgICAgaGlkZGVuRnJhbWVJbmRleCA9IChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwLFxuICAgICAgY3VycmVudEZyYW1lRGF0YTtcblxuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuXG4gICAgLy8gSXQgaXMgYmVzdCB0byBsZXQgcmVmcmVzaGluZyB0aGUgZnJhbWUgcGxheWxpc3QgaGFwcGVuIGluIHRoZSBub3JtYWwgY3ljbGUgb2YgZnJhbWUgc3dhcHBpbmcgKHBsYXlsaXN0IGNvbXBsZXRpb24pXG4gICAgLy8gQmVsb3cgaXMgdGhlIG9ubHkgY3JpdGVyaWEgZm9yIHNhZmVseSBmb3JjaW5nIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgd2hpbGUgV2lkZ2V0IGlzIGluIGEgXCJwbGF5XCIgb3IgXCJwYXVzZVwiIHN0YXRlXG5cbiAgICAvLyBXaWRnZXQgaXMgaW4gYSBzdGF0ZSBvZiBcInBsYXlcIiBvciBcInBhdXNlXCIgYW5kIHBsYXlsaXN0IGhhcyBub3QgY29tcGxldGVkLiBBIGhpZGRlbiBmcmFtZSBkZWZpbml0ZWx5IGV4aXN0c1xuICAgIGlmIChjdXJyZW50RnJhbWVPYmopIHtcbiAgICAgIC8vIE9ubHkgaWYgdGhlcmUgYXJlIG5vIHZpZGVvIGNvbnRyb2xzLlxuICAgICAgLy8gVXNlciBpbnRlcmFjdGluZyB3aXRoIGNvbnRyb2xzLCBwYXJ0aWN1bGFybHkgc2Vla2luZyBhbmQgc2tpcHBpbmcgdmlkZW9zLCB3b3VsZCBjYXVzZSBpc3N1ZXNcbiAgICAgIGlmICghX2FkZGl0aW9uYWxQYXJhbXMudmlkZW8uY29udHJvbHMpIHtcbiAgICAgICAgY3VycmVudEZyYW1lRGF0YSA9IGN1cnJlbnRGcmFtZU9iai5nZXRQbGF5YmFja0RhdGEoKTtcblxuICAgICAgICBpZiAoY3VycmVudEZyYW1lRGF0YS50b3RhbCA9PT0gKGN1cnJlbnRGcmFtZURhdGEuaW5kZXggKyAxKSkge1xuICAgICAgICAgIC8vIFRvIGJlIHNhZmUsIG9ubHkgcmVmcmVzaCB0aGUgZnJhbWUgdGhhdCdzIGN1cnJlbnRseSBoaWRkZW4gaWYgYXQgbGVhc3QgMTUgc2Vjb25kcyBhcmUgbGVmdCBvZiBmaW5hbCB2aWRlb1xuICAgICAgICAgIGlmICgoY3VycmVudEZyYW1lRGF0YS5kdXJhdGlvbiAtIGN1cnJlbnRGcmFtZURhdGEucG9zaXRpb24pID49IDE1KSB7XG4gICAgICAgICAgICBfcmVmcmVzaEZyYW1lKGhpZGRlbkZyYW1lSW5kZXgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBDdXJyZW50IGZyYW1lIGlzIG5vdCBwbGF5aW5nIGxhc3QgdmlkZW8gaW4gbGlzdCwgc2FmZSB0byByZWZyZXNoIHRoZSBmcmFtZSB0aGF0J3MgY3VycmVudGx5IGhpZGRlblxuICAgICAgICAgIF9yZWZyZXNoRnJhbWUoaGlkZGVuRnJhbWVJbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGZyYW1lT2JqLnBhdXNlKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICB2YXIgZnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpO1xuXG4gICAgaWYgKCFfcGxheWJhY2tFcnJvcikge1xuICAgICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHNldCBjdXJyZW50IGZyYW1lIHRvIGJlIHRoZSBvbmUgdmlzaWJsZVxuICAgICAgICBfY3VycmVudEZyYW1lID0gKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDA7XG5cbiAgICAgICAgLy8gcGxheSB0aGUgY3VycmVudCBmcmFtZSB2aWRlb1xuICAgICAgICBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG4gICAgICAgIGZyYW1lT2JqLnBsYXkoKTtcblxuICAgICAgICAvLyByZS1hZGQgcHJldmlvdXNseSByZW1vdmVkIGZyYW1lIGFuZCBjcmVhdGUgdGhlIHBsYXllciwgYnV0IGhpZGUgdmlzaWJpbGl0eVxuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCkpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCksIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ290IHNldCB1cG9uIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgYW5kIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBzZXR1cCBvciBmaXJzdCB2aWRlb1xuICAgICAgLy8gU2VuZCBWaWV3ZXIgXCJkb25lXCJcbiAgICAgIF9kb25lKCk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBuYW1lc1swXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1swXSk7XG4gICAgICAgIF9wcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCk7XG5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKS5zdHlsZS5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpICsgXCJweFwiO1xuXG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLndpZHRoID0gX3ByZWZzLmdldEludChcInJzV1wiKTtcbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKTtcblxuICAgICAgICAvLyBjcmVhdGUgYW5kIGluaXRpYWxpemUgdGhlIFN0b3JhZ2UgbW9kdWxlIGluc3RhbmNlXG4gICAgICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuU3RvcmFnZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFbmRlZCgpIHtcbiAgICBpZiAoX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdldHMgc2V0IHVwb24gYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSBhbmQgdGhlcmUgd2FzIGFuIGVycm9yIGluIHNldHVwIG9yIGZpcnN0IHZpZGVvXG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lKTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKTtcblxuICAgICAgX2RvbmUoKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnNob3coKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBfZG9uZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgICBpZiAoIV9pbml0aWFsaXplZCkge1xuICAgICAgaWYgKF9mcmFtZUNvdW50ID09PSAyKSB7XG4gICAgICAgIC8vIGJvdGggZnJhbWVzIGhhdmUgYmVlbiBjcmVhdGVkIGFuZCBsb2FkZWQsIGNhbiBub3RpZnkgVmlld2VyIHdpZGdldCBpcyByZWFkeVxuICAgICAgICBfaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICBfcmVhZHkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGZpcnN0IGZyYW1lIHBsYXllciB3YXMgc3VjY2Vzc2Z1bCBhbmQgcmVhZHksIGNyZWF0ZSB0aGUgc2Vjb25kIG9uZSBidXQgaGlkZSBpdFxuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgxKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKDEpO1xuICAgICAgICBfZnJhbWVDb3VudCA9IDI7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMSwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMsIGNvbmZpZy5TS0lOLCBcInBsYXllci5odG1sXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVycm9yKGVycm9yKSB7XG4gICAgY29uc29sZS5kZWJ1ZyhcInZpZGVvLWZvbGRlcjo6cGxheWVyRXJyb3IoKVwiLCBlcnJvcik7XG5cbiAgICBpZiAoIV9pbml0aWFsaXplZCkge1xuICAgICAgLy8gV2lkZ2V0IGhhcyBub3Qgc2VudCBcInJlYWR5XCIgeWV0IGFuZCB0aGVyZSBpcyBhbiBlcnJvciAoc2V0dXAgb3IgcGxheWJhY2sgb2YgZmlyc3QgdmlkZW8sIGRvZXNuJ3QgbWF0dGVyIHdoaWNoKVxuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICAgIC8vIGRvIG5vdGhpbmcgbW9yZSwgZW5zdXJlIFwicmVhZHlcIiBpcyBub3Qgc2VudCB0byBWaWV3ZXIgc28gdGhhdCB0aGlzIHdpZGdldCBjYW4gYmUgc2tpcHBlZFxuXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChlcnJvci50eXBlID09PSBcInNldHVwXCIgfHwgZXJyb3IuaW5kZXggPT09IDApIHtcbiAgICAgICAgLy8gVGhpcyBvbmx5IGhhcHBlbnMgaW4gdGhlIGV2ZW50IG9mIGEgcmVmcmVzaC4gTmV3IGZpbGVzIGNhdXNlZCBhbiBlcnJvciBpbiBzZXR1cCBvciBmaXJzdCB2aWRlbyBoYXMgYW4gaXNzdWVcbiAgICAgICAgLy8gVGhlIGVycm9yIGV2ZW50IHdpbGwgYmUgY29taW5nIGZyb20gdGhlIGN1cnJlbnRseSBoaWRkZW4gZnJhbWUgd2hlbiBpdCBnb3QgcmVjcmVhdGVkIHdpdGggbmV3IGZpbGVzIHRvIHVzZVxuICAgICAgICBfcGxheWJhY2tFcnJvciA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBmb3JjZSB3aWRnZXQgdG8gYWN0IGFzIHRob3VnaCB0aGUgcGxheWxpc3QgaXMgZG9uZVxuICAgICAgICBwbGF5ZXJFbmRlZCgpO1xuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0ZvbGRlclN0b3JhZ2VcIik7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHVybHMgPSBbXTtcblxuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZS5kZXRhaWwuZmlsZXMuZm9yRWFjaChmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgdXJscy5wdXNoKGZpbGUudXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VJbml0KHVybHMpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VSZWZyZXNoKHVybHMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuXG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8gPSBSaXNlVmlzaW9uLkNvbW1vbi5WaWRlbyB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uVmlkZW8uRnJhbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUFJFRklYID0gXCJpZl9cIjtcblxuICBmdW5jdGlvbiBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCkge1xuICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRGcmFtZU9iamVjdChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICByZXR1cm4gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCksXG4gICAgICBmcmFtZU9iaiA9IGdldEZyYW1lT2JqZWN0KGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcbiAgICAgIGZyYW1lT2JqLnJlbW92ZSgpO1xuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcImFib3V0OmJsYW5rXCIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG5cbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiYWxsb3dUcmFuc3BhcmVuY3lcIiwgdHJ1ZSk7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImZyYW1lYm9yZGVyXCIsIFwiMFwiKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlRnJhbWVQbGF5ZXIoaW5kZXgsIHBhcmFtcywgZmlsZXMsIHNraW4sIHNyYykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGZyYW1lT2JqID0gZ2V0RnJhbWVPYmplY3QoaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZnJhbWUub25sb2FkID0gbnVsbDtcblxuICAgICAgICAvLyBpbml0aWFsaXplIGFuZCBsb2FkIHRoZSBwbGF5ZXIgaW5zaWRlIHRoZSBpZnJhbWVcbiAgICAgICAgZnJhbWVPYmouaW5pdChwYXJhbXMsIGZpbGVzLCBza2luKTtcbiAgICAgICAgZnJhbWVPYmoubG9hZCgpO1xuICAgICAgfTtcblxuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBzcmMpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gaGlkZShpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KTtcblxuICAgIGZyYW1lQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlKGluZGV4LCBjYWxsYmFjaykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcblxuICAgIF9jbGVhcihpbmRleCk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIHJlbW92ZSB0aGUgaWZyYW1lIGJ5IGNsZWFyaW5nIGFsbCBlbGVtZW50cyBpbnNpZGUgZGl2IGNvbnRhaW5lclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgZnJhbWVDb250YWluZXIucmVtb3ZlQ2hpbGQoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH0sIDIwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBzaG93KGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpO1xuXG4gICAgZnJhbWVDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhZGQ6IGFkZCxcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXG4gICAgZ2V0RnJhbWVDb250YWluZXI6IGdldEZyYW1lQ29udGFpbmVyLFxuICAgIGdldEZyYW1lT2JqZWN0OiBnZXRGcmFtZU9iamVjdCxcbiAgICBoaWRlOiBoaWRlLFxuICAgIHJlbW92ZTogcmVtb3ZlLFxuICAgIHNob3c6IHNob3dcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9seW1lci1yZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG4gICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfc3RvcF9cIiArIGlkLCBzdG9wKTtcblxuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnNldEFkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktNCddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=