if("undefined"==typeof config){var config={SKIN:""};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","http://storage-stage-rva-test.risevision.com/modal.html#/files/"))}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,v.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,v.getString("id"),!0,!0,!0,!0,!0)}function o(){V=new RiseVision.VideoFolder.Storage(f),V.init()}function i(e){h.remove(e,function(){h.add(e),h.hide(e),h.createFramePlayer(e,f,y)})}function r(e){y=e,h=new RiseVision.VideoFolder.FrameController,h.add(0),p=0,F=1,h.createFramePlayer(0,f,y)}function a(e){var t,n=h.getFrameObject(p),o=0===p?1:0;y=e,n&&f.video.autoplay&&(t=n.getPlaybackData(),t.total===t.index+1?t.duration-t.position>=15&&i(o):i(o))}function s(){var e=h.getFrameObject(p);e&&e.pause()}function c(){var e=h.getFrameObject(p);k?t():e?e.play():(p=0===p?1:0,e=h.getFrameObject(p),e.play(),h.add(0===p?1:0),h.hide(0===p?1:0),h.createFramePlayer(0===p?1:0,f,y))}function d(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(f=JSON.parse(n[0]),v=new e.Prefs,document.getElementById("videoContainer").style.height=v.getInt("rsH")+"px",f.width=v.getInt("rsW"),f.height=v.getInt("rsH"),b=new RiseVision.Common.Background(f),b.init(o))}function l(){k?(h.remove(p),h.remove(0===p?1:0),t()):(h.show(0===p?1:0),h.remove(p,function(){t()}))}function u(){R||(2===F?(R=!0,n()):(h.add(1),h.hide(1),F=2,h.createFramePlayer(1,f,y)))}function m(e){console.debug("video-folder::playerError()",e),R?"setup"===e.type||0===e.index?k=!0:l():h.remove(p)}function g(){s()}var f,y,p,v=null,b=null,V=null,h=null,R=!1,k=!1,F=0;return{onStorageInit:r,onStorageRefresh:a,pause:s,play:c,setAdditionalParams:d,playerEnded:l,playerReady:u,playerError:m,stop:g}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){s.style.backgroundImage="url("+e.background.image.url+u+"cb="+(new Date).getTime()+")",t()},d)}function n(){a=!0,e.background.useImage&&!l&&t(),r&&"function"==typeof r&&r()}function o(){var t;s=document.getElementById("background"),c=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,s?e.background.useImage?(s.className=e.background.image.position,s.className=e.background.image.scale?s.className+" scale-to-fit":s.className,l=0!==Object.keys(e.backgroundStorage).length,l?c?(c.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.files&&e.detail.files.length>0&&(s.style.backgroundImage="url("+e.detail.files[0].url+")"),a||n()}),c.setAttribute("folder",e.backgroundStorage.folder),c.setAttribute("fileName",e.backgroundStorage.fileName),c.setAttribute("companyId",e.backgroundStorage.companyId),c.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),u=1===t.length?"?":"&",s.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function i(e){a?e&&"function"==typeof e&&e():(e&&(r=e),o())}var r=null,a=!1,s=null,c=null,d=9e5,l=!1,u="";return{init:i}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage"),o="",i="";if(t){switch(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),e.order){case"alpha-asc":o="name",i="asc";break;case"alpha-desc":o="name",i="desc";break;case"date-asc":o="date",i="asc";break;case"date-desc":o="date",i="desc";break;case"random":o="random";break;default:o="name",i="asc"}t.setAttribute("sort",o),t.setAttribute("sortDirection",i),t.go()}}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.FrameController=function(){"use strict";function e(e){var t,n,o=document.getElementById(s+e);try{t=o.querySelector("iframe"),n=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument,n.remove(),t.setAttribute("src","about:blank")}catch(i){console.debug(i)}}function t(e){var t,n;t=document.getElementById(s+e),n=document.createElement("iframe"),n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),t.appendChild(n)}function n(e,t,n){var o,i=document.getElementById(s+e);o=i.querySelector("iframe"),o&&(o.onload=function(){o.onload=null;var e=o.contentWindow?o.contentWindow:o.contentDocument.document?o.contentDocument.document:o.contentDocument;e.init(t,n,config.SKIN)},o.setAttribute("src","player.html"))}function o(e){var t,n=document.getElementById(s+e);return t=n.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function i(e){document.getElementById(s+e).style.visibility="hidden"}function r(t,n){var o=document.getElementById(s+t);e(t),setTimeout(function(){for(;o.firstChild;)o.removeChild(o.firstChild);n&&"function"==typeof n&&n()},200)}function a(e){document.getElementById(s+e).style.visibility="visible"}var s="if_";return{add:t,createFramePlayer:n,getFrameObject:o,hide:i,remove:r,show:a}},function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsInZhbHVlIiwiUmlzZVZpc2lvbiIsIlZpZGVvRm9sZGVyIiwiZ2FkZ2V0cyIsIl9kb25lIiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl9yZWFkeSIsIl9iYWNrZ3JvdW5kUmVhZHkiLCJfc3RvcmFnZSIsIlN0b3JhZ2UiLCJfYWRkaXRpb25hbFBhcmFtcyIsImluaXQiLCJfcmVmcmVzaEZyYW1lIiwiZnJhbWVJbmRleCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJhZGQiLCJoaWRlIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJfY3VycmVudEZpbGVzIiwib25TdG9yYWdlSW5pdCIsInVybHMiLCJGcmFtZUNvbnRyb2xsZXIiLCJfY3VycmVudEZyYW1lIiwiX2ZyYW1lQ291bnQiLCJvblN0b3JhZ2VSZWZyZXNoIiwiY3VycmVudEZyYW1lRGF0YSIsImN1cnJlbnRGcmFtZU9iaiIsImdldEZyYW1lT2JqZWN0IiwiaGlkZGVuRnJhbWVJbmRleCIsInZpZGVvIiwiYXV0b3BsYXkiLCJnZXRQbGF5YmFja0RhdGEiLCJ0b3RhbCIsImluZGV4IiwiZHVyYXRpb24iLCJwb3NpdGlvbiIsInBhdXNlIiwiZnJhbWVPYmoiLCJwbGF5IiwiX3BsYXliYWNrRXJyb3IiLCJzZXRBZGRpdGlvbmFsUGFyYW1zIiwibmFtZXMiLCJ2YWx1ZXMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJKU09OIiwicGFyc2UiLCJQcmVmcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzdHlsZSIsImhlaWdodCIsImdldEludCIsIndpZHRoIiwiX2JhY2tncm91bmQiLCJDb21tb24iLCJCYWNrZ3JvdW5kIiwicGxheWVyRW5kZWQiLCJzaG93IiwicGxheWVyUmVhZHkiLCJfaW5pdGlhbGl6ZWQiLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiY29uc29sZSIsImRlYnVnIiwidHlwZSIsInN0b3AiLCJkYXRhIiwiX3JlZnJlc2hUaW1lciIsInNldFRpbWVvdXQiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJiYWNrZ3JvdW5kIiwiaW1hZ2UiLCJ1cmwiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcmVmcmVzaER1cmF0aW9uIiwidXNlSW1hZ2UiLCJfaXNTdG9yYWdlRmlsZSIsIl9jYWxsYmFjayIsIl9jb25maWd1cmUiLCJzdHIiLCJib2R5IiwiY29sb3IiLCJjbGFzc05hbWUiLCJzY2FsZSIsIk9iamVjdCIsImtleXMiLCJiYWNrZ3JvdW5kU3RvcmFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGV0YWlsIiwiZmlsZXMiLCJzZXRBdHRyaWJ1dGUiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImNvbXBhbnlJZCIsImdvIiwibG9nIiwic3BsaXQiLCJjYiIsInN0b3JhZ2UiLCJzb3J0Iiwic29ydERpcmVjdGlvbiIsImZvckVhY2giLCJmaWxlIiwicHVzaCIsIl9pbml0aWFsTG9hZCIsIm9yZGVyIiwiX2NsZWFyIiwiaWZyYW1lIiwiZnJhbWVDb250YWluZXIiLCJQUkVGSVgiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudFdpbmRvdyIsImNvbnRlbnREb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmFtcyIsIm9ubG9hZCIsInZpc2liaWxpdHkiLCJjYWxsYmFjayIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsImdhIiwiYXN5bmMiLCJzcmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBRUEsR0FBc0IsbUJB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RSxFQUFNL0gsVUFBVSxLQUd2QjBILEdBQU9NLGNBQWdCLFdBQ3JCLE9BQU8sR0E0QlROLEVBQU9uQyxpQkFBaUIsZ0JBQWlCb0MsSUFFeENELE9BQVEvSCxRQUtYLElBQUlzSSxNQUFPQSxRQUVYQSxNQUFLekIsTUFBTSxjQUFlLGtCQUMxQnlCLEtBQUt6QixNQUFNLG1CQUVYLFdBQ0UsR0FBSTBCLEdBQUtyRixTQUFTcUUsY0FBYyxTQUFXZ0IsR0FBR3BFLEtBQU8sa0JBQW1Cb0UsRUFBR0MsT0FBUSxFQUNuRkQsRUFBR0UsS0FBTyxVQUFZdkYsU0FBU3dGLFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUkxRixTQUFTMkYscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVIsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBjb25maWc6IHRydWUgKi9cbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBjb25maWcgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdmFyIGNvbmZpZyA9IHtcbiAgICAvKlxuICAgICBOT1RFOiBSZWxhdGl2ZSBwYXRoIHRvIHNraW4gZmlsZSBkb2VzIG5vdCB3b3JrIHdoZW4gdmlld2luZy90ZXN0aW5nIGxvY2FsbHkgdXNpbmcgUHJldmlldyBhcHBcblxuICAgICBXaGVuIG5lZWRpbmcgdG8gd29yayBvbiBza2luIGZpbGUgXCJzaXgueG1sXCIsIHVwbG9hZCBmaWxlIHRvIHNlcnZlciBhbmQgY2hhbmdlIFNLSU4gdmFsdWUgdG8gcG9pbnQgdG8gc2VydmVyIGxvY2F0aW9uXG4gICAgIENPUlMgd2lsbCBiZSByZXF1aXJlZC4gSGFuZHkgQ09SUyBDaHJvbWUgZXh0ZW5zaW9uIGNhbiBiZSBmb3VuZCBoZXJlXG4gICAgIGh0dHBzOi8vY2hyb21lLmdvb2dsZS5jb20vd2Vic3RvcmUvZGV0YWlsL2FsbG93LWNvbnRyb2wtYWxsb3ctb3JpZ2kvbmxmYm1ib2pwZWFjZmdoa3BiamhkZGlobGtraWxqYmk/aGw9ZW5cbiAgICAgKi9cbiAgICBTS0lOOiBcIlwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwiY29tcG9uZW50cy9ydi1jb21tb24taTE4bi9kaXN0L2xvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24ud2lkZ2V0LmNvbW1vbi5zdG9yYWdlLXNlbGVjdG9yLmNvbmZpZ1wiKVxuICAgICAgLnZhbHVlKFwiU1RPUkFHRV9NT0RBTFwiLCBcImh0dHA6Ly9zdG9yYWdlLXN0YWdlLXJ2YS10ZXN0LnJpc2V2aXNpb24uY29tL21vZGFsLmh0bWwjL2ZpbGVzL1wiKTtcbiAgfVxufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0ge307XG5cblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSAoZnVuY3Rpb24gKGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9hZGRpdGlvbmFsUGFyYW1zO1xuXG4gIHZhciBfcHJlZnMgPSBudWxsLFxuICAgIF9iYWNrZ3JvdW5kID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG51bGw7XG5cbiAgdmFyIF9pbml0aWFsaXplZCA9IGZhbHNlLFxuICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2U7XG5cbiAgdmFyIF9jdXJyZW50RmlsZXMsIF9jdXJyZW50RnJhbWU7XG5cbiAgdmFyIF9mcmFtZUNvdW50ID0gMDtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfYmFja2dyb3VuZFJlYWR5KCkge1xuICAgIF9zdG9yYWdlID0gbmV3IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuU3RvcmFnZShfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgX3N0b3JhZ2UuaW5pdCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3JlZnJlc2hGcmFtZShmcmFtZUluZGV4KSB7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoZnJhbWVJbmRleCwgZnVuY3Rpb24gKCkge1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoZnJhbWVJbmRleCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoZnJhbWVJbmRleCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKGZyYW1lSW5kZXgsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gb25TdG9yYWdlSW5pdCh1cmxzKSB7XG4gICAgX2N1cnJlbnRGaWxlcyA9IHVybHM7XG5cbiAgICBfZnJhbWVDb250cm9sbGVyID0gbmV3IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuRnJhbWVDb250cm9sbGVyKCk7XG5cbiAgICAvLyBhZGQgdGhlIGZpcnN0IGZyYW1lIGFuZCBjcmVhdGUgaXRzIHBsYXllclxuICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDApO1xuICAgIF9jdXJyZW50RnJhbWUgPSAwO1xuICAgIF9mcmFtZUNvdW50ID0gMTtcbiAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKDAsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJscykge1xuICAgIHZhciBjdXJyZW50RnJhbWVPYmogPSBfZnJhbWVDb250cm9sbGVyLmdldEZyYW1lT2JqZWN0KF9jdXJyZW50RnJhbWUpLFxuICAgICAgaGlkZGVuRnJhbWVJbmRleCA9IChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwLFxuICAgICAgY3VycmVudEZyYW1lRGF0YTtcblxuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuXG4gICAgLy8gSXQgaXMgYmVzdCB0byBsZXQgcmVmcmVzaGluZyB0aGUgZnJhbWUgcGxheWxpc3QgaGFwcGVuIGluIHRoZSBub3JtYWwgY3ljbGUgb2YgZnJhbWUgc3dhcHBpbmcgKHBsYXlsaXN0IGNvbXBsZXRpb24pXG4gICAgLy8gQmVsb3cgaXMgdGhlIG9ubHkgY3JpdGVyaWEgZm9yIHNhZmVseSBmb3JjaW5nIGEgcmVmcmVzaCBvZiBoaWRkZW4gZnJhbWUgd2hpbGUgV2lkZ2V0IGlzIGluIGEgXCJwbGF5XCIgb3IgXCJwYXVzZVwiIHN0YXRlXG5cbiAgICAvLyBXaWRnZXQgaXMgaW4gYSBzdGF0ZSBvZiBcInBsYXlcIiBvciBcInBhdXNlXCIgYW5kIHBsYXlsaXN0IGhhcyBub3QgY29tcGxldGVkLiBBIGhpZGRlbiBmcmFtZSBkZWZpbml0ZWx5IGV4aXN0c1xuICAgIGlmIChjdXJyZW50RnJhbWVPYmopIHtcbiAgICAgIC8vIE9ubHkgaWYgdGhlcmUgYXJlIG5vIHZpZGVvIGNvbnRyb2xzLlxuICAgICAgLy8gVXNlciBpbnRlcmFjdGluZyB3aXRoIGNvbnRyb2xzLCBwYXJ0aWN1bGFybHkgc2Vla2luZyBhbmQgc2tpcHBpbmcgdmlkZW9zLCB3b3VsZCBjYXVzZSBpc3N1ZXNcbiAgICAgIGlmIChfYWRkaXRpb25hbFBhcmFtcy52aWRlby5hdXRvcGxheSkge1xuICAgICAgICBjdXJyZW50RnJhbWVEYXRhID0gY3VycmVudEZyYW1lT2JqLmdldFBsYXliYWNrRGF0YSgpO1xuXG4gICAgICAgIGlmIChjdXJyZW50RnJhbWVEYXRhLnRvdGFsID09PSAoY3VycmVudEZyYW1lRGF0YS5pbmRleCArIDEpKSB7XG4gICAgICAgICAgLy8gVG8gYmUgc2FmZSwgb25seSByZWZyZXNoIHRoZSBmcmFtZSB0aGF0J3MgY3VycmVudGx5IGhpZGRlbiBpZiBhdCBsZWFzdCAxNSBzZWNvbmRzIGFyZSBsZWZ0IG9mIGZpbmFsIHZpZGVvXG4gICAgICAgICAgaWYgKChjdXJyZW50RnJhbWVEYXRhLmR1cmF0aW9uIC0gY3VycmVudEZyYW1lRGF0YS5wb3NpdGlvbikgPj0gMTUpIHtcbiAgICAgICAgICAgIF9yZWZyZXNoRnJhbWUoaGlkZGVuRnJhbWVJbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEN1cnJlbnQgZnJhbWUgaXMgbm90IHBsYXlpbmcgbGFzdCB2aWRlbyBpbiBsaXN0LCBzYWZlIHRvIHJlZnJlc2ggdGhlIGZyYW1lIHRoYXQncyBjdXJyZW50bHkgaGlkZGVuXG4gICAgICAgICAgX3JlZnJlc2hGcmFtZShoaWRkZW5GcmFtZUluZGV4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoIV9wbGF5YmFja0Vycm9yKSB7XG4gICAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gc2V0IGN1cnJlbnQgZnJhbWUgdG8gYmUgdGhlIG9uZSB2aXNpYmxlXG4gICAgICAgIF9jdXJyZW50RnJhbWUgPSAoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMDtcblxuICAgICAgICAvLyBwbGF5IHRoZSBjdXJyZW50IGZyYW1lIHZpZGVvXG4gICAgICAgIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuXG4gICAgICAgIC8vIHJlLWFkZCBwcmV2aW91c2x5IHJlbW92ZWQgZnJhbWUgYW5kIGNyZWF0ZSB0aGUgcGxheWVyLCBidXQgaGlkZSB2aXNpYmlsaXR5XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCkpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUaGlzIGZsYWcgb25seSBnb3Qgc2V0IHVwb24gYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSBhbmQgdGhlcmUgd2FzIGFuIGVycm9yIGluIHNldHVwIG9yIGZpcnN0IHZpZGVvXG4gICAgICAvLyBTZW5kIFZpZXdlciBcImRvbmVcIlxuICAgICAgX2RvbmUoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzBdKTtcbiAgICAgICAgX3ByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKTtcblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGggPSBfcHJlZnMuZ2V0SW50KFwicnNXXCIpO1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpO1xuXG4gICAgICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgQmFja2dyb3VuZCBpbnN0YW5jZVxuICAgICAgICBfYmFja2dyb3VuZCA9IG5ldyBSaXNlVmlzaW9uLkNvbW1vbi5CYWNrZ3JvdW5kKF9hZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgICAgX2JhY2tncm91bmQuaW5pdChfYmFja2dyb3VuZFJlYWR5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFbmRlZCgpIHtcbiAgICBpZiAoX3BsYXliYWNrRXJyb3IpIHtcbiAgICAgIC8vIFRoaXMgZmxhZyBvbmx5IGdldHMgc2V0IHVwb24gYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSBhbmQgdGhlcmUgd2FzIGFuIGVycm9yIGluIHNldHVwIG9yIGZpcnN0IHZpZGVvXG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lKTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKTtcblxuICAgICAgX2RvbmUoKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnNob3coKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBfZG9uZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJSZWFkeSgpIHtcbiAgICBpZiAoIV9pbml0aWFsaXplZCkge1xuICAgICAgaWYgKF9mcmFtZUNvdW50ID09PSAyKSB7XG4gICAgICAgIC8vIGJvdGggZnJhbWVzIGhhdmUgYmVlbiBjcmVhdGVkIGFuZCBsb2FkZWQsIGNhbiBub3RpZnkgVmlld2VyIHdpZGdldCBpcyByZWFkeVxuICAgICAgICBfaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICBfcmVhZHkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGZpcnN0IGZyYW1lIHBsYXllciB3YXMgc3VjY2Vzc2Z1bCBhbmQgcmVhZHksIGNyZWF0ZSB0aGUgc2Vjb25kIG9uZSBidXQgaGlkZSBpdFxuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgxKTtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5oaWRlKDEpO1xuICAgICAgICBfZnJhbWVDb3VudCA9IDI7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMSwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVycm9yKGVycm9yKSB7XG4gICAgY29uc29sZS5kZWJ1ZyhcInZpZGVvLWZvbGRlcjo6cGxheWVyRXJyb3IoKVwiLCBlcnJvcik7XG5cbiAgICBpZiAoIV9pbml0aWFsaXplZCkge1xuICAgICAgLy8gV2lkZ2V0IGhhcyBub3Qgc2VudCBcInJlYWR5XCIgeWV0IGFuZCB0aGVyZSBpcyBhbiBlcnJvciAoc2V0dXAgb3IgcGxheWJhY2sgb2YgZmlyc3QgdmlkZW8sIGRvZXNuJ3QgbWF0dGVyIHdoaWNoKVxuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICAgIC8vIGRvIG5vdGhpbmcgbW9yZSwgZW5zdXJlIFwicmVhZHlcIiBpcyBub3Qgc2VudCB0byBWaWV3ZXIgc28gdGhhdCB0aGlzIHdpZGdldCBjYW4gYmUgc2tpcHBlZFxuXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChlcnJvci50eXBlID09PSBcInNldHVwXCIgfHwgZXJyb3IuaW5kZXggPT09IDApIHtcbiAgICAgICAgLy8gVGhpcyBvbmx5IGhhcHBlbnMgaW4gdGhlIGV2ZW50IG9mIGEgcmVmcmVzaC4gTmV3IGZpbGVzIGNhdXNlZCBhbiBlcnJvciBpbiBzZXR1cCBvciBmaXJzdCB2aWRlbyBoYXMgYW4gaXNzdWVcbiAgICAgICAgLy8gVGhlIGVycm9yIGV2ZW50IHdpbGwgYmUgY29taW5nIGZyb20gdGhlIGN1cnJlbnRseSBoaWRkZW4gZnJhbWUgd2hlbiBpdCBnb3QgcmVjcmVhdGVkIHdpdGggbmV3IGZpbGVzIHRvIHVzZVxuICAgICAgICBfcGxheWJhY2tFcnJvciA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBmb3JjZSB3aWRnZXQgdG8gYWN0IGFzIHRob3VnaCB0aGUgcGxheWxpc3QgaXMgZG9uZVxuICAgICAgICBwbGF5ZXJFbmRlZCgpO1xuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBwYXVzZSgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcIm9uU3RvcmFnZUluaXRcIjogb25TdG9yYWdlSW5pdCxcbiAgICBcIm9uU3RvcmFnZVJlZnJlc2hcIjogb25TdG9yYWdlUmVmcmVzaCxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic2V0QWRkaXRpb25hbFBhcmFtc1wiOiBzZXRBZGRpdGlvbmFsUGFyYW1zLFxuICAgIFwicGxheWVyRW5kZWRcIjogcGxheWVyRW5kZWQsXG4gICAgXCJwbGF5ZXJSZWFkeVwiOiBwbGF5ZXJSZWFkeSxcbiAgICBcInBsYXllckVycm9yXCI6IHBsYXllckVycm9yLFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGdhZGdldHMpO1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5CYWNrZ3JvdW5kID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9jYWxsYmFjayA9IG51bGwsXG4gICAgX3JlYWR5ID0gZmFsc2UsXG4gICAgX2JhY2tncm91bmQgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbCxcbiAgICBfcmVmcmVzaER1cmF0aW9uID0gOTAwMDAwLCAvLyAxNSBtaW51dGVzXG4gICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZSxcbiAgICBfc2VwYXJhdG9yID0gXCJcIjtcblxuICAvKlxuICAgKiBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9yZWZyZXNoVGltZXIoKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiBiYWNrZ3JvdW5kUmVmcmVzaCgpIHtcbiAgICAgIF9iYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnVybCArIF9zZXBhcmF0b3IgKyBcImNiPVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBcIilcIjtcbiAgICAgIF9yZWZyZXNoVGltZXIoKTtcbiAgICB9LCBfcmVmcmVzaER1cmF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9iYWNrZ3JvdW5kUmVhZHkoKSB7XG4gICAgX3JlYWR5ID0gdHJ1ZTtcblxuICAgIGlmIChkYXRhLmJhY2tncm91bmQudXNlSW1hZ2UgJiYgIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICAvLyBzdGFydCB0aGUgcmVmcmVzaCBwb2xsIGZvciBub24tc3RvcmFnZSBiYWNrZ3JvdW5kIGltYWdlXG4gICAgICBfcmVmcmVzaFRpbWVyKCk7XG4gICAgfVxuXG4gICAgaWYgKF9jYWxsYmFjayAmJiB0eXBlb2YgX2NhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIF9jYWxsYmFjaygpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9jb25maWd1cmUoKSB7XG4gICAgdmFyIHN0cjtcblxuICAgIF9iYWNrZ3JvdW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiYWNrZ3JvdW5kXCIpO1xuICAgIF9zdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiYWNrZ3JvdW5kU3RvcmFnZVwiKTtcblxuICAgIC8vIHNldCB0aGUgZG9jdW1lbnQgYmFja2dyb3VuZFxuICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuYmFja2dyb3VuZCA9IGRhdGEuYmFja2dyb3VuZC5jb2xvcjtcblxuICAgIGlmIChfYmFja2dyb3VuZCkge1xuICAgICAgaWYgKGRhdGEuYmFja2dyb3VuZC51c2VJbWFnZSkge1xuICAgICAgICBfYmFja2dyb3VuZC5jbGFzc05hbWUgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2UucG9zaXRpb247XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5zY2FsZSA/IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSArIFwiIHNjYWxlLXRvLWZpdFwiXG4gICAgICAgICAgOiBfYmFja2dyb3VuZC5jbGFzc05hbWU7XG5cbiAgICAgICAgX2lzU3RvcmFnZUZpbGUgPSAoT2JqZWN0LmtleXMoZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZSkubGVuZ3RoICE9PSAwKTtcblxuICAgICAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICAgICAgc3RyID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnVybC5zcGxpdChcIj9cIik7XG5cbiAgICAgICAgICAvLyBzdG9yZSB0aGlzIGZvciB0aGUgcmVmcmVzaCB0aW1lclxuICAgICAgICAgIF9zZXBhcmF0b3IgPSAoc3RyLmxlbmd0aCA9PT0gMSkgPyBcIj9cIiA6IFwiJlwiO1xuXG4gICAgICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsICsgXCIpXCI7XG4gICAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChfc3RvcmFnZSkge1xuICAgICAgICAgICAgLy8gUmlzZSBTdG9yYWdlXG4gICAgICAgICAgICBfc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgIGlmIChlLmRldGFpbCAmJiBlLmRldGFpbC5maWxlcyAmJiBlLmRldGFpbC5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBlLmRldGFpbC5maWxlc1swXS51cmwgKyBcIilcIjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICghX3JlYWR5KSB7XG4gICAgICAgICAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuYmFja2dyb3VuZFN0b3JhZ2UuZm9sZGVyKTtcbiAgICAgICAgICAgIF9zdG9yYWdlLnNldEF0dHJpYnV0ZShcImZpbGVOYW1lXCIsIGRhdGEuYmFja2dyb3VuZFN0b3JhZ2UuZmlsZU5hbWUpO1xuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuYmFja2dyb3VuZFN0b3JhZ2UuY29tcGFueUlkKTtcbiAgICAgICAgICAgIF9zdG9yYWdlLmdvKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBlbGVtZW50IHdpdGggaWQgdmFsdWUgb2YgJ2JhY2tncm91bmRTdG9yYWdlJ1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kUmVhZHkoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCB2YWx1ZSBvZiAnYmFja2dyb3VuZCdcIik7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KGNiKSB7XG4gICAgaWYgKCFfcmVhZHkpIHtcbiAgICAgIGlmIChjYikge1xuICAgICAgICBfY2FsbGJhY2sgPSBjYjtcbiAgICAgIH1cblxuICAgICAgX2NvbmZpZ3VyZSgpO1xuXG4gICAgfSBlbHNlIGlmIChjYiAmJiB0eXBlb2YgY2IgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgY2IoKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIHZhciBzdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0ZvbGRlclN0b3JhZ2VcIiksXG4gICAgICBzb3J0ID0gXCJcIixcbiAgICAgIHNvcnREaXJlY3Rpb24gPSBcIlwiO1xuXG4gICAgaWYgKCFzdG9yYWdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciB1cmxzID0gW107XG5cbiAgICAgIGlmIChlLmRldGFpbCAmJiBlLmRldGFpbC5maWxlcyAmJiBlLmRldGFpbC5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGUuZGV0YWlsLmZpbGVzLmZvckVhY2goZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgIHVybHMucHVzaChmaWxlLnVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChfaW5pdGlhbExvYWQpIHtcbiAgICAgICAgICBfaW5pdGlhbExvYWQgPSBmYWxzZTtcblxuICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIub25TdG9yYWdlSW5pdCh1cmxzKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIub25TdG9yYWdlUmVmcmVzaCh1cmxzKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImNvbXBhbnlJZFwiLCBkYXRhLnN0b3JhZ2UuY29tcGFueUlkKTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcImZvbGRlclwiLCBkYXRhLnN0b3JhZ2UuZm9sZGVyKTtcblxuICAgIC8vIFNvcnRpbmdcbiAgICBzd2l0Y2ggKGRhdGEub3JkZXIpIHtcbiAgICAgIGNhc2UgXCJhbHBoYS1hc2NcIjpcbiAgICAgICAgc29ydCA9IFwibmFtZVwiO1xuICAgICAgICBzb3J0RGlyZWN0aW9uID0gXCJhc2NcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYWxwaGEtZGVzY1wiOlxuICAgICAgICBzb3J0ID0gXCJuYW1lXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImRlc2NcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZGF0ZS1hc2NcIjpcbiAgICAgICAgc29ydCA9IFwiZGF0ZVwiO1xuICAgICAgICBzb3J0RGlyZWN0aW9uID0gXCJhc2NcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZGF0ZS1kZXNjXCI6XG4gICAgICAgIHNvcnQgPSBcImRhdGVcIjtcbiAgICAgICAgc29ydERpcmVjdGlvbiA9IFwiZGVzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyYW5kb21cIjpcbiAgICAgICAgc29ydCA9IFwicmFuZG9tXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgc29ydCA9IFwibmFtZVwiO1xuICAgICAgICBzb3J0RGlyZWN0aW9uID0gXCJhc2NcIjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcInNvcnRcIiwgc29ydCk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJzb3J0RGlyZWN0aW9uXCIsIHNvcnREaXJlY3Rpb24pO1xuICAgIHN0b3JhZ2UuZ28oKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBjb25maWcgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgfHwge307XG5cblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuRnJhbWVDb250cm9sbGVyID0gZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUFJFRklYID0gXCJpZl9cIjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfY2xlYXIoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCksXG4gICAgICBpZnJhbWUsIGZyYW1lT2JqO1xuXG4gICAgdHJ5IHtcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG4gICAgICBmcmFtZU9iaiA9IChpZnJhbWUuY29udGVudFdpbmRvdykgPyBpZnJhbWUuY29udGVudFdpbmRvdyA6XG4gICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiYWJvdXQ6YmxhbmtcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmRlYnVnKGUpO1xuICAgIH1cblxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuXG4gIGZ1bmN0aW9uIGFkZChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciwgaWZyYW1lO1xuXG4gICAgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCk7XG5cbiAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwgXCIwXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIiwgXCJub1wiKTtcblxuICAgIGZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVGcmFtZVBsYXllcihpbmRleCwgcGFyYW1zLCBmaWxlcykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZnJhbWUub25sb2FkID0gbnVsbDtcblxuICAgICAgICB2YXIgZnJhbWVPYmogPSAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxuICAgICAgICAgIChpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50KSA/IGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQgOiBpZnJhbWUuY29udGVudERvY3VtZW50O1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxuICAgICAgICBmcmFtZU9iai5pbml0KHBhcmFtcywgZmlsZXMsIGNvbmZpZy5TS0lOKTtcbiAgICAgIH07XG5cbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCJwbGF5ZXIuaHRtbFwiKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEZyYW1lT2JqZWN0KGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcblxuICAgIGlmIChpZnJhbWUpIHtcbiAgICAgIHJldHVybiAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxuICAgICAgICAoaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCkgPyBpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50IDogaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGUoaW5kZXgpIHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCkuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmUoaW5kZXgsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xuXG4gICAgX2NsZWFyKGluZGV4KTtcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gcmVtb3ZlIHRoZSBpZnJhbWUgYnkgY2xlYXJpbmcgYWxsIGVsZW1lbnRzIGluc2lkZSBkaXYgY29udGFpbmVyXG4gICAgICB3aGlsZSAoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCkge1xuICAgICAgICBmcmFtZUNvbnRhaW5lci5yZW1vdmVDaGlsZChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3coaW5kZXgpIHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCkuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhZGQ6IGFkZCxcbiAgICBjcmVhdGVGcmFtZVBsYXllcjogY3JlYXRlRnJhbWVQbGF5ZXIsXG4gICAgZ2V0RnJhbWVPYmplY3Q6IGdldEZyYW1lT2JqZWN0LFxuICAgIGhpZGU6IGhpZGUsXG4gICAgcmVtb3ZlOiByZW1vdmUsXG4gICAgc2hvdzogc2hvd1xuICB9O1xufTtcblxuLyogZ2xvYmFsIGdhZGdldHMsIFJpc2VWaXNpb24gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpZCA9IHByZWZzLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnBsYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zdG9wKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwb2x5bWVyUmVhZHkoKSB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuXG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzcGFyYW1fc2V0X1wiICsgaWQsIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuc2V0QWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9seW1lci1yZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG59KSh3aW5kb3csIGdhZGdldHMpO1xuXG5cblxuLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xudmFyIF9nYXEgPSBfZ2FxIHx8IFtdO1xuXG5fZ2FxLnB1c2goWydfc2V0QWNjb3VudCcsICdVQS01NzA5MjE1OS00J10pO1xuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnXSk7XG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7IGdhLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsgZ2EuYXN5bmMgPSB0cnVlO1xuICBnYS5zcmMgPSAoJ2h0dHBzOicgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAnaHR0cHM6Ly9zc2wnIDogJ2h0dHA6Ly93d3cnKSArICcuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnO1xuICB2YXIgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYSwgcyk7XG59KSgpO1xuLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==