if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml",STORAGE_ENV:"prod"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function n(){e.rpc.call("","rsevent_done",null,p.getString("id"))}function t(){console.log("video-folder.js::_ready()",f.storage.folder),e.rpc.call("","rsevent_ready",null,p.getString("id"),!0,!0,!0,!0,!0)}function o(e){console.log("video-folder.js::onStorageInit",e),m=e,y=new RiseVision.Common.Video.FrameController,g=0,V=!0,t()}function i(e){console.log("video-folder.js::onStorageRefresh",e),m=e,R=!1}function r(){var e=y.getFrameObject(g);e&&e.pause()}function s(){var e=y.getFrameObject(g);R?n():e?e.play():m&&m.length>0?(y.add(0),y.createFramePlayer(0,f,m,config.SKIN,"player.html")):n()}function a(n,t){Array.isArray(n)&&n.length>0&&"additionalParams"===n[0]&&Array.isArray(t)&&t.length>0&&(f=JSON.parse(t[0]),p=new e.Prefs,document.getElementById("videoContainer").style.height=p.getInt("rsH")+"px",f.width=p.getInt("rsW"),f.height=p.getInt("rsH"),v=new RiseVision.VideoFolder.Storage(f),v.init())}function d(){y.remove(g,function(){n()})}function l(){var e=y.getFrameObject(g);e.play()}function c(e){console.debug("video-folder::playerError()",e),("setup"===e.type||0===e.index)&&(R=!0),d()}function u(){r()}var f,m,g,p=null,v=null,y=null,V=!1,R=!1;return{onStorageInit:o,onStorageRefresh:i,pause:r,play:s,setAdditionalParams:a,playerEnded:d,playerReady:l,playerError:c,stop:u}}(gadgets);var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function n(){return _.pluck(d,"url")}function t(e){return _.find(d,function(n){return e.name===n.name})}function o(e){var n=t(e);n&&d.splice(d.indexOf(n),1)}function i(e){var n=t(e);n&&(n.url=e.url)}function r(e){var n=t(e);n||(e.fileName=e.name.slice(e.name.lastIndexOf("/")+1,e.name.lastIndexOf(".")).toLowerCase(),d.splice(_.sortedIndex(d,e,"fileName"),0,e))}function s(){var t=document.getElementById("videoFolderStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t=e.detail;return t.added&&(r(t),a)?(a=!1,RiseVision.VideoFolder.onStorageInit(n()),void 0):(t.changed&&i(t),t.deleted&&o(t),RiseVision.VideoFolder.onStorageRefresh(n()),void 0)}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),t.setAttribute("env",config.STORAGE_ENV),t.go())}var a=!0,d=[];return{init:s}};var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Video=RiseVision.Common.Video||{},RiseVision.Common.Video.FrameController=function(){"use strict";function e(e){return document.getElementById(d+e)}function n(n){var t,o=e(n);return t=o.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function t(t){var o,i=e(t),r=n(t);r&&(o=i.querySelector("iframe"),r.remove(),o.setAttribute("src","about:blank"))}function o(n){var t=e(n),o=document.createElement("iframe");o.setAttribute("allowTransparency",!0),o.setAttribute("frameborder","0"),o.setAttribute("scrolling","no"),t.appendChild(o)}function i(t,o,i,r,s){var a,d=e(t),l=n(t);l&&(a=d.querySelector("iframe"),a.onload=function(){a.onload=null,l.init(o,i,r),l.load()},a.setAttribute("src",s))}function r(n){var t=e(n);t.style.visibility="hidden"}function s(e,n){var o=document.getElementById(d+e);t(e),setTimeout(function(){for(;o.firstChild;)o.removeChild(o.firstChild);n&&"function"==typeof n&&n()},200)}function a(n){var t=e(n);t.style.visibility="visible"}var d="if_";return{add:o,createFramePlayer:i,getFrameContainer:e,getFrameObject:n,hide:r,remove:s,show:a}},function(e,n){"use strict";function t(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("WebComponentsReady",r),a&&""!==a&&(n.rpc.register("rscmd_play_"+a,t),n.rpc.register("rscmd_pause_"+a,o),n.rpc.register("rscmd_stop_"+a,i),n.rpc.register("rsparam_set_"+a,RiseVision.VideoFolder.setAdditionalParams),n.rpc.call("","rsparam_get",null,a,["additionalParams"]))}var s=new n.Prefs,a=s.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("WebComponentsReady",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsIlNUT1JBR0VfRU5WIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiUmlzZVZpc2lvbiIsIlZpZGVvRm9sZGVyIiwiZ2FkZ2V0cyIsIl9kb25lIiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl9yZWFkeSIsImNvbnNvbGUiLCJsb2ciLCJfYWRkaXRpb25hbFBhcmFtcyIsInN0b3JhZ2UiLCJmb2xkZXIiLCJvblN0b3JhZ2VJbml0IiwidXJscyIsIl9jdXJyZW50RmlsZXMiLCJfZnJhbWVDb250cm9sbGVyIiwiQ29tbW9uIiwiVmlkZW8iLCJGcmFtZUNvbnRyb2xsZXIiLCJfY3VycmVudEZyYW1lIiwiX2luaXRpYWxpemVkIiwib25TdG9yYWdlUmVmcmVzaCIsIl9wbGF5YmFja0Vycm9yIiwicGF1c2UiLCJmcmFtZU9iaiIsImdldEZyYW1lT2JqZWN0IiwicGxheSIsImxlbmd0aCIsImFkZCIsImNyZWF0ZUZyYW1lUGxheWVyIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiSlNPTiIsInBhcnNlIiwiUHJlZnMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJoZWlnaHQiLCJnZXRJbnQiLCJ3aWR0aCIsIl9zdG9yYWdlIiwiU3RvcmFnZSIsImluaXQiLCJwbGF5ZXJFbmRlZCIsInJlbW92ZSIsInBsYXllclJlYWR5IiwicGxheWVyRXJyb3IiLCJlcnJvciIsImRlYnVnIiwidHlwZSIsImluZGV4Iiwic3RvcCIsImRhdGEiLCJfZ2V0VXJscyIsIl8iLCJwbHVjayIsIl9maWxlcyIsIl9nZXRFeGlzdGluZ0ZpbGUiLCJmaWxlIiwiZmluZCIsImYiLCJuYW1lIiwiX2RlbGV0ZUZpbGUiLCJleGlzdGluZyIsInNwbGljZSIsImluZGV4T2YiLCJfY2hhbmdlRmlsZSIsInVybCIsIl9hZGRGaWxlIiwiZmlsZU5hbWUiLCJzbGljZSIsImxhc3RJbmRleE9mIiwidG9Mb3dlckNhc2UiLCJzb3J0ZWRJbmRleCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGV0YWlsIiwiYWRkZWQiLCJfaW5pdGlhbExvYWQiLCJjaGFuZ2VkIiwiZGVsZXRlZCIsInNldEF0dHJpYnV0ZSIsImNvbXBhbnlJZCIsImdvIiwiZ2V0RnJhbWVDb250YWluZXIiLCJQUkVGSVgiLCJpZnJhbWUiLCJmcmFtZUNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50V2luZG93IiwiY29udGVudERvY3VtZW50IiwiX2NsZWFyIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwicGFyYW1zIiwiZmlsZXMiLCJza2luIiwic3JjIiwib25sb2FkIiwibG9hZCIsImhpZGUiLCJ2aXNpYmlsaXR5IiwiY2FsbGJhY2siLCJzZXRUaW1lb3V0IiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwic2hvdyIsIndpbmRvdyIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwicHJlZnMiLCJvbmNvbnRleHRtZW51IiwiX2dhcSIsInB1c2giLCJnYSIsImFzeW5jIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUVBLEdBQXNCLG1CQUFYQSxRQUF3QixDQUNqQyxHQUFJQSxTQUNGQyxLQUFNLGtCQUNOQyxZQUFhLE9BR1Esb0JBQVpDLFVBQ1RBLFFBQVFDLE9BQU8sb0NBQ1pDLFNBQVMsaUJBQWtCLHdCQUMzQkEsU0FBUyxnQkFBaUIsU0FNakMsR0FBSUMsWUFBYUEsY0FDakJBLFlBQVdDLGVBRVhELFdBQVdDLFlBQWMsU0FBV0MsR0FDbEMsWUFnQkEsU0FBU0MsS0FDUEQsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGVBQWdCLEtBQU1DLEVBQU9DLFVBQVUs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SSIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIFNLSU46IFwic2tpbi9SVlNraW4ueG1sXCIsXG4gICAgU1RPUkFHRV9FTlY6IFwicHJvZFwiXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbiAgfVxufVxuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgY29uZmlnICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IChmdW5jdGlvbiAoZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FkZGl0aW9uYWxQYXJhbXM7XG5cbiAgdmFyIF9wcmVmcyA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBudWxsO1xuXG4gIHZhciBfaW5pdGlhbGl6ZWQgPSBmYWxzZSxcbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuXG4gIHZhciBfY3VycmVudEZpbGVzLCBfY3VycmVudEZyYW1lO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBjb25zb2xlLmxvZyhcInZpZGVvLWZvbGRlci5qczo6X3JlYWR5KClcIiwgX2FkZGl0aW9uYWxQYXJhbXMuc3RvcmFnZS5mb2xkZXIpO1xuXG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJscykge1xuICAgIGNvbnNvbGUubG9nKFwidmlkZW8tZm9sZGVyLmpzOjpvblN0b3JhZ2VJbml0XCIsIHVybHMpO1xuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuXG4gICAgLy8gY3JlYXRlIHRoZSBGcmFtZUNvbnRyb2xsZXIgbW9kdWxlIGluc3RhbmNlXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG5ldyBSaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIoKTtcblxuICAgIF9jdXJyZW50RnJhbWUgPSAwO1xuICAgIF9pbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICBfcmVhZHkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2godXJscykge1xuICAgIGNvbnNvbGUubG9nKFwidmlkZW8tZm9sZGVyLmpzOjpvblN0b3JhZ2VSZWZyZXNoXCIsIHVybHMpO1xuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuXG4gICAgLy8gaW4gY2FzZSByZWZyZXNoZWQgZmlsZXMgZml4IGFuIGVycm9yIHdpdGggcHJldmlvdXMgc2V0dXAgb3IgaW5pdGlhbCBmaWxlIHByb2JsZW0sXG4gICAgLy8gZW5zdXJlIGZsYWcgaXMgcmVtb3ZlZCBzbyBwbGF5YmFjayBpcyBhdHRlbXB0ZWQgYWdhaW5cbiAgICBfcGxheWJhY2tFcnJvciA9IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoIV9wbGF5YmFja0Vycm9yKSB7XG4gICAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgICAgfSBlbHNlIHtcblxuICAgICAgICAvLyBjaGVjayB0aGUgbGlzdCBpc24ndCBlbXB0eVxuICAgICAgICBpZiAoX2N1cnJlbnRGaWxlcyAmJiBfY3VycmVudEZpbGVzLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgIC8vIGFkZCBmcmFtZSBhbmQgY3JlYXRlIHRoZSBwbGF5ZXJcbiAgICAgICAgICBfZnJhbWVDb250cm9sbGVyLmFkZCgwKTtcbiAgICAgICAgICBfZnJhbWVDb250cm9sbGVyLmNyZWF0ZUZyYW1lUGxheWVyKDAsIF9hZGRpdGlvbmFsUGFyYW1zLCBfY3VycmVudEZpbGVzLCBjb25maWcuU0tJTiwgXCJwbGF5ZXIuaHRtbFwiKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIF9kb25lKCk7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBfZG9uZSgpO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhuYW1lcywgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgbmFtZXNbMF0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMF0pO1xuICAgICAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIikuc3R5bGUuaGVpZ2h0ID0gX3ByZWZzLmdldEludChcInJzSFwiKSArIFwicHhcIjtcblxuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy53aWR0aCA9IF9wcmVmcy5nZXRJbnQoXCJyc1dcIik7XG4gICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIik7XG5cbiAgICAgICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBTdG9yYWdlIG1vZHVsZSBpbnN0YW5jZVxuICAgICAgICBfc3RvcmFnZSA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgICBfc3RvcmFnZS5pbml0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRW5kZWQoKSB7XG4gICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoX2N1cnJlbnRGcmFtZSwgZnVuY3Rpb24gKCkge1xuICAgICAgX2RvbmUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG4gICAgZnJhbWVPYmoucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRXJyb3IoZXJyb3IpIHtcbiAgICBjb25zb2xlLmRlYnVnKFwidmlkZW8tZm9sZGVyOjpwbGF5ZXJFcnJvcigpXCIsIGVycm9yKTtcblxuICAgIGlmIChlcnJvci50eXBlID09PSBcInNldHVwXCIgfHwgZXJyb3IuaW5kZXggPT09IDApIHtcbiAgICAgIC8vIEZpbGVzIGNhdXNlZCBhbiBlcnJvciBpbiBzZXR1cCBvciBmaXJzdCB2aWRlbyBoYXMgYW4gaXNzdWUsIGZsYWcgdGhpc1xuICAgICAgX3BsYXliYWNrRXJyb3IgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIGZvcmNlIHdpZGdldCB0byBhY3QgYXMgdGhvdWdoIHRoZSBwbGF5bGlzdCBpcyBkb25lXG4gICAgcGxheWVyRW5kZWQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJvblN0b3JhZ2VJbml0XCI6IG9uU3RvcmFnZUluaXQsXG4gICAgXCJvblN0b3JhZ2VSZWZyZXNoXCI6IG9uU3RvcmFnZVJlZnJlc2gsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBsYXllckVuZGVkXCI6IHBsYXllckVuZGVkLFxuICAgIFwicGxheWVyUmVhZHlcIjogcGxheWVyUmVhZHksXG4gICAgXCJwbGF5ZXJFcnJvclwiOiBwbGF5ZXJFcnJvcixcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShnYWRnZXRzKTtcblxuLyogZ2xvYmFsIGNvbmZpZywgXyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciB8fCB7fTtcblxuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5TdG9yYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9pbml0aWFsTG9hZCA9IHRydWU7XG5cbiAgdmFyIF9maWxlcyA9IFtdO1xuXG4gIGZ1bmN0aW9uIF9nZXRVcmxzKCkge1xuICAgIHJldHVybiBfLnBsdWNrKF9maWxlcywgXCJ1cmxcIik7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0RXhpc3RpbmdGaWxlKGZpbGUpIHtcbiAgICByZXR1cm4gXy5maW5kKF9maWxlcywgZnVuY3Rpb24gKGYpIHtcbiAgICAgIHJldHVybiBmaWxlLm5hbWUgPT09IGYubmFtZTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9kZWxldGVGaWxlKGZpbGUpIHtcbiAgICB2YXIgZXhpc3RpbmcgPSBfZ2V0RXhpc3RpbmdGaWxlKGZpbGUpO1xuXG4gICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICBfZmlsZXMuc3BsaWNlKF9maWxlcy5pbmRleE9mKGV4aXN0aW5nKSwgMSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NoYW5nZUZpbGUoZmlsZSkge1xuICAgIHZhciBleGlzdGluZyA9IF9nZXRFeGlzdGluZ0ZpbGUoZmlsZSk7XG5cbiAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgIGV4aXN0aW5nLnVybCA9IGZpbGUudXJsO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9hZGRGaWxlKGZpbGUpIHtcbiAgICB2YXIgZXhpc3RpbmcgPSBfZ2V0RXhpc3RpbmdGaWxlKGZpbGUpO1xuXG4gICAgaWYgKCFleGlzdGluZykge1xuICAgICAgLy8gZXh0cmFjdCB0aGUgYWN0dWFsIGZpbGUgbmFtZSBhbmQgc3RvcmUgaW4gbmV3IHByb3BlcnR5IG9uIGZpbGUgb2JqZWN0XG4gICAgICBmaWxlLmZpbGVOYW1lID0gZmlsZS5uYW1lLnNsaWNlKGZpbGUubmFtZS5sYXN0SW5kZXhPZihcIi9cIikgKyAxLCBmaWxlLm5hbWUubGFzdEluZGV4T2YoXCIuXCIpKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAvLyBpbnNlcnQgZmlsZSB0byBfZmlsZXMgbGlzdCBhdCBzcGVjaWZpYyBpbmRleCBiYXNlZCBvbiBhbHBoYWJldGljYWwgb3JkZXIgb2YgZmlsZSBuYW1lXG4gICAgICBfZmlsZXMuc3BsaWNlKF8uc29ydGVkSW5kZXgoX2ZpbGVzLCBmaWxlLCBcImZpbGVOYW1lXCIpLCAwLCBmaWxlKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvRm9sZGVyU3RvcmFnZVwiKTtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgZmlsZSA9IGUuZGV0YWlsO1xuXG4gICAgICAvLyBBZGRlZFxuICAgICAgaWYoZmlsZS5hZGRlZCkge1xuICAgICAgICBfYWRkRmlsZShmaWxlKTtcblxuICAgICAgICBpZiAoX2luaXRpYWxMb2FkKSB7XG4gICAgICAgICAgX2luaXRpYWxMb2FkID0gZmFsc2U7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VJbml0KF9nZXRVcmxzKCkpO1xuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoYW5nZWRcbiAgICAgIGlmKGZpbGUuY2hhbmdlZCkge1xuICAgICAgICBfY2hhbmdlRmlsZShmaWxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gRGVsZXRlZFxuICAgICAgaWYoZmlsZS5kZWxldGVkKSB7XG4gICAgICAgIF9kZWxldGVGaWxlKGZpbGUpO1xuICAgICAgfVxuXG4gICAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLm9uU3RvcmFnZVJlZnJlc2goX2dldFVybHMoKSk7XG5cbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZW52XCIsIGNvbmZpZy5TVE9SQUdFX0VOVik7XG5cbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlbyA9IFJpc2VWaXNpb24uQ29tbW9uLlZpZGVvIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5WaWRlby5GcmFtZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBQUkVGSVggPSBcImlmX1wiO1xuXG4gIGZ1bmN0aW9uIGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEZyYW1lT2JqZWN0KGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWZyYW1lID0gZnJhbWVDb250YWluZXIucXVlcnlTZWxlY3RvcihcImlmcmFtZVwiKTtcblxuICAgIGlmIChpZnJhbWUpIHtcbiAgICAgIHJldHVybiAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxuICAgICAgICAoaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCkgPyBpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50IDogaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jbGVhcihpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGdldEZyYW1lQ29udGFpbmVyKGluZGV4KSxcbiAgICAgIGZyYW1lT2JqID0gZ2V0RnJhbWVPYmplY3QoaW5kZXgpLFxuICAgICAgaWZyYW1lO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuICAgICAgZnJhbWVPYmoucmVtb3ZlKCk7XG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiYWJvdXQ6YmxhbmtcIik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gYWRkKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcblxuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwgXCIwXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIiwgXCJub1wiKTtcblxuICAgIGZyYW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVGcmFtZVBsYXllcihpbmRleCwgcGFyYW1zLCBmaWxlcywgc2tpbiwgc3JjKSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpLFxuICAgICAgZnJhbWVPYmogPSBnZXRGcmFtZU9iamVjdChpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICAgIGlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmcmFtZS5vbmxvYWQgPSBudWxsO1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgYW5kIGxvYWQgdGhlIHBsYXllciBpbnNpZGUgdGhlIGlmcmFtZVxuICAgICAgICBmcmFtZU9iai5pbml0KHBhcmFtcywgZmlsZXMsIHNraW4pO1xuICAgICAgICBmcmFtZU9iai5sb2FkKCk7XG4gICAgICB9O1xuXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIHNyYyk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBoaWRlKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZ2V0RnJhbWVDb250YWluZXIoaW5kZXgpO1xuXG4gICAgZnJhbWVDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmUoaW5kZXgsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xuXG4gICAgX2NsZWFyKGluZGV4KTtcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gcmVtb3ZlIHRoZSBpZnJhbWUgYnkgY2xlYXJpbmcgYWxsIGVsZW1lbnRzIGluc2lkZSBkaXYgY29udGFpbmVyXG4gICAgICB3aGlsZSAoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCkge1xuICAgICAgICBmcmFtZUNvbnRhaW5lci5yZW1vdmVDaGlsZChmcmFtZUNvbnRhaW5lci5maXJzdENoaWxkKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3coaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBnZXRGcmFtZUNvbnRhaW5lcihpbmRleCk7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZDogYWRkLFxuICAgIGNyZWF0ZUZyYW1lUGxheWVyOiBjcmVhdGVGcmFtZVBsYXllcixcbiAgICBnZXRGcmFtZUNvbnRhaW5lcjogZ2V0RnJhbWVDb250YWluZXIsXG4gICAgZ2V0RnJhbWVPYmplY3Q6IGdldEZyYW1lT2JqZWN0LFxuICAgIGhpZGU6IGhpZGUsXG4gICAgcmVtb3ZlOiByZW1vdmUsXG4gICAgc2hvdzogc2hvd1xuICB9O1xufTtcblxuLyogZ2xvYmFsIGdhZGdldHMsIFJpc2VWaXNpb24gKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBpZCA9IHByZWZzLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnBsYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zdG9wKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwb2x5bWVyUmVhZHkoKSB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJXZWJDb21wb25lbnRzUmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJXZWJDb21wb25lbnRzUmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktNCddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
