if("undefined"==typeof config){var config={SKIN:"skin/RVSkin.xml"};"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json")}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,p.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,p.getString("id"),!0,!0,!0,!0,!0)}function o(e){V.remove(e,function(){V.add(e),V.hide(e),V.createFramePlayer(e,f,g)})}function i(e){g=e,V=new RiseVision.VideoFolder.FrameController,V.add(0),y=0,R=1,V.createFramePlayer(0,f,g)}function r(e){var t,n=V.getFrameObject(y),i=0===y?1:0;g=e,n&&(f.video.controls||(t=n.getPlaybackData(),t.total===t.index+1?t.duration-t.position>=15&&o(i):o(i)))}function a(){var e=V.getFrameObject(y);e&&e.pause()}function s(){var e=V.getFrameObject(y);h?t():e?e.play():(y=0===y?1:0,e=V.getFrameObject(y),e.play(),V.add(0===y?1:0),V.hide(0===y?1:0),V.createFramePlayer(0===y?1:0,f,g))}function c(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(f=JSON.parse(n[0]),p=new e.Prefs,document.getElementById("videoContainer").style.height=p.getInt("rsH")+"px",f.width=p.getInt("rsW"),f.height=p.getInt("rsH"),v=new RiseVision.VideoFolder.Storage(f),v.init())}function d(){h?(V.remove(y),V.remove(0===y?1:0),t()):(V.show(0===y?1:0),V.remove(y,function(){t()}))}function l(){F||(2===R?(F=!0,n()):(V.add(1),V.hide(1),R=2,V.createFramePlayer(1,f,g)))}function u(e){console.debug("video-folder::playerError()",e),F?"setup"===e.type||0===e.index?h=!0:d():V.remove(y)}function m(){a()}var f,g,y,p=null,v=null,V=null,F=!1,h=!1,R=0;return{onStorageInit:i,onStorageRefresh:r,pause:a,play:s,setAdditionalParams:c,playerEnded:d,playerReady:l,playerError:u,stop:m}}(gadgets);var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage");t&&(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),t.go())}var n=!0;return{init:t}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.FrameController=function(){"use strict";function e(e){var t,n,o=document.getElementById(s+e);try{t=o.querySelector("iframe"),n=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument,n.remove(),t.setAttribute("src","about:blank")}catch(i){console.debug(i)}}function t(e){var t,n;t=document.getElementById(s+e),n=document.createElement("iframe"),n.setAttribute("allowTransparency",!0),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),t.appendChild(n)}function n(e,t,n){var o,i=document.getElementById(s+e);o=i.querySelector("iframe"),o&&(o.onload=function(){o.onload=null;var e=o.contentWindow?o.contentWindow:o.contentDocument.document?o.contentDocument.document:o.contentDocument;e.init(t,n,config.SKIN)},o.setAttribute("src","player.html"))}function o(e){var t,n=document.getElementById(s+e);return t=n.querySelector("iframe"),t?t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument:null}function i(e){document.getElementById(s+e).style.visibility="hidden"}function r(t,n){var o=document.getElementById(s+t);e(t),setTimeout(function(){for(;o.firstChild;)o.removeChild(o.firstChild);n&&"function"==typeof n&&n()},200)}function a(e){document.getElementById(s+e).style.visibility="visible"}var s="if_";return{add:t,createFramePlayer:n,getFrameObject:o,hide:i,remove:r,show:a}},function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiY29uZmlnIiwiU0tJTiIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsIlJpc2VWaXNpb24iLCJWaWRlb0ZvbGRlciIsImdhZGdldHMiLCJfZG9uZSIsInJwYyIsImNhbGwiLCJfcHJlZnMiLCJnZXRTdHJpbmciLCJfcmVhZHkiLCJfcmVmcmVzaEZyYW1lIiwiZnJhbWVJbmRleCIsIl9mcmFtZUNvbnRyb2xsZXIiLCJyZW1vdmUiLCJhZGQiLCJoaWRlIiwiY3JlYXRlRnJhbWVQbGF5ZXIiLCJfYWRkaXRpb25hbFBhcmFtcyIsIl9jdXJyZW50RmlsZXMiLCJvblN0b3JhZ2VJbml0IiwidXJscyIsIkZyYW1lQ29udHJvbGxlciIsIl9jdXJyZW50RnJhbWUiLCJfZnJhbWVDb3VudCIsIm9uU3RvcmFnZVJlZnJlc2giLCJjdXJyZW50RnJhbWVEYXRhIiwiY3VycmVudEZyYW1lT2JqIiwiZ2V0RnJhbWVPYmplY3QiLCJoaWRkZW5GcmFtZUluZGV4IiwidmlkZW8iLCJjb250cm9scyIsImdldFBsYXliYWNrRGF0YSIsInRvdGFsIiwiaW5kZXgiLCJkdXJhdGlvbiIsInBvc2l0aW9uIiwicGF1c2UiLCJmcmFtZU9iaiIsInBsYXkiLCJfcGxheWJhY2tFcnJvciIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIkpTT04iLCJwYXJzZSIsIlByZWZzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiaGVpZ2h0IiwiZ2V0SW50Iiwid2lkdGgiLCJfc3RvcmFnZSIsIlN0b3JhZ2UiLCJpbml0IiwicGxheWVyRW5kZWQiLCJzaG93IiwicGxheWVyUmVhZHkiLCJfaW5pdGlhbGl6ZWQiLCJwbGF5ZXJFcnJvciIsImVycm9yIiwiY29uc29sZSIsImRlYnVnIiwidHlwZSIsInN0b3AiLCJkYXRhIiwic3RvcmFnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGV0YWlsIiwiZmlsZXMiLCJmb3JFYWNoIiwiZmlsZSIsInB1c2giLCJ1cmwiLCJfaW5pdGlhbExvYWQiLCJzZXRBdHRyaWJ1dGUiLCJjb21wYW55SWQiLCJmb2xkZXIiLCJnbyIsIl9jbGVhciIsImlmcmFtZSIsImZyYW1lQ29udGFpbmVyIiwiUFJFRklYIiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnRXaW5kb3ciLCJjb250ZW50RG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJwYXJhbXMiLCJvbmxvYWQiLCJ2aXNpYmlsaXR5IiwiY2FsbGJhY2siLCJzZXRUaW1lb3V0IiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwid2luZG93IiwicG9seW1lclJlYWR5IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImlkIiwicmVnaXN0ZXIiLCJwcmVmcyIsIm9uY29udGV4dG1lbnUiLCJfZ2FxIiwiZ2EiLCJhc3luYyIsInNyYyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIl0sIm1hcHBpbmdzIjoiQUFFQSxHQUFzQixtQkFBWEEsUUFBd0IsQ0FDakMsR0FBSUEsU0FDRkMsS0FBTSxrQkFHZSxvQkFBWkMsVUFDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0Isd0JBQzNCQSxTQUFTLGdCQUFpQixTQU1qQyxHQUFJQyxZQUFhQSxjQUNqQkEsWUFBV0MsZUFFWEQsV0FBV0MsWUFBYyxTQUFXQyxHQUNsQyxZQWtCQSxTQUFTQyxLQUNQRCxFQUFRRSxJQUFJQyxLQUFLLEdBQUksZUFBZ0IsS0FBTUMsRUFBT0MsVUFBVSxPQUc5RCxRQUFTQyxLQUNQTixFQUFRRSxJQUFJQyxLQUFLLEdBQUksZ0JBQWlCLEtBQU1DLEVBQU9DLFVBQVUsT0FDM0QsR0FBTSxHQUFNLEdBQU0sR0FBTSxHQUc1QixRQUFTRSxHQUFjQyxHQUNyQkMsRUFBaUJDLE9BQU9GLEVBQVks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QixVQUFVLEVBQUlELEdBQUVFLFdBQVdDLGFBQWFSLEVBQUlLIiwiZmlsZSI6ImpzL3dpZGdldC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgY29uZmlnOiB0cnVlICovXG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgY29uZmlnID09PSBcInVuZGVmaW5lZFwiKSB7XG4gIHZhciBjb25maWcgPSB7XG4gICAgU0tJTjogXCJza2luL1JWU2tpbi54bWxcIlxuICB9O1xuXG4gIGlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1BSRUZJWFwiLCBcImxvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG4gIH1cbn1cblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcztcblxuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfc3RvcmFnZSA9IG51bGwsXG4gICAgX2ZyYW1lQ29udHJvbGxlciA9IG51bGw7XG5cbiAgdmFyIF9pbml0aWFsaXplZCA9IGZhbHNlLFxuICAgIF9wbGF5YmFja0Vycm9yID0gZmFsc2U7XG5cbiAgdmFyIF9jdXJyZW50RmlsZXMsIF9jdXJyZW50RnJhbWU7XG5cbiAgdmFyIF9mcmFtZUNvdW50ID0gMDtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfZG9uZSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9kb25lXCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfcmVmcmVzaEZyYW1lKGZyYW1lSW5kZXgpIHtcbiAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShmcmFtZUluZGV4LCBmdW5jdGlvbiAoKSB7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLmFkZChmcmFtZUluZGV4KTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuaGlkZShmcmFtZUluZGV4KTtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoZnJhbWVJbmRleCwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpO1xuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBvblN0b3JhZ2VJbml0KHVybHMpIHtcbiAgICBfY3VycmVudEZpbGVzID0gdXJscztcblxuICAgIF9mcmFtZUNvbnRyb2xsZXIgPSBuZXcgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5GcmFtZUNvbnRyb2xsZXIoKTtcblxuICAgIC8vIGFkZCB0aGUgZmlyc3QgZnJhbWUgYW5kIGNyZWF0ZSBpdHMgcGxheWVyXG4gICAgX2ZyYW1lQ29udHJvbGxlci5hZGQoMCk7XG4gICAgX2N1cnJlbnRGcmFtZSA9IDA7XG4gICAgX2ZyYW1lQ291bnQgPSAxO1xuICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoMCwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9yYWdlUmVmcmVzaCh1cmxzKSB7XG4gICAgdmFyIGN1cnJlbnRGcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSksXG4gICAgICBoaWRkZW5GcmFtZUluZGV4ID0gKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDAsXG4gICAgICBjdXJyZW50RnJhbWVEYXRhO1xuXG4gICAgX2N1cnJlbnRGaWxlcyA9IHVybHM7XG5cbiAgICAvLyBJdCBpcyBiZXN0IHRvIGxldCByZWZyZXNoaW5nIHRoZSBmcmFtZSBwbGF5bGlzdCBoYXBwZW4gaW4gdGhlIG5vcm1hbCBjeWNsZSBvZiBmcmFtZSBzd2FwcGluZyAocGxheWxpc3QgY29tcGxldGlvbilcbiAgICAvLyBCZWxvdyBpcyB0aGUgb25seSBjcml0ZXJpYSBmb3Igc2FmZWx5IGZvcmNpbmcgYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSB3aGlsZSBXaWRnZXQgaXMgaW4gYSBcInBsYXlcIiBvciBcInBhdXNlXCIgc3RhdGVcblxuICAgIC8vIFdpZGdldCBpcyBpbiBhIHN0YXRlIG9mIFwicGxheVwiIG9yIFwicGF1c2VcIiBhbmQgcGxheWxpc3QgaGFzIG5vdCBjb21wbGV0ZWQuIEEgaGlkZGVuIGZyYW1lIGRlZmluaXRlbHkgZXhpc3RzXG4gICAgaWYgKGN1cnJlbnRGcmFtZU9iaikge1xuICAgICAgLy8gT25seSBpZiB0aGVyZSBhcmUgbm8gdmlkZW8gY29udHJvbHMuXG4gICAgICAvLyBVc2VyIGludGVyYWN0aW5nIHdpdGggY29udHJvbHMsIHBhcnRpY3VsYXJseSBzZWVraW5nIGFuZCBza2lwcGluZyB2aWRlb3MsIHdvdWxkIGNhdXNlIGlzc3Vlc1xuICAgICAgaWYgKCFfYWRkaXRpb25hbFBhcmFtcy52aWRlby5jb250cm9scykge1xuICAgICAgICBjdXJyZW50RnJhbWVEYXRhID0gY3VycmVudEZyYW1lT2JqLmdldFBsYXliYWNrRGF0YSgpO1xuXG4gICAgICAgIGlmIChjdXJyZW50RnJhbWVEYXRhLnRvdGFsID09PSAoY3VycmVudEZyYW1lRGF0YS5pbmRleCArIDEpKSB7XG4gICAgICAgICAgLy8gVG8gYmUgc2FmZSwgb25seSByZWZyZXNoIHRoZSBmcmFtZSB0aGF0J3MgY3VycmVudGx5IGhpZGRlbiBpZiBhdCBsZWFzdCAxNSBzZWNvbmRzIGFyZSBsZWZ0IG9mIGZpbmFsIHZpZGVvXG4gICAgICAgICAgaWYgKChjdXJyZW50RnJhbWVEYXRhLmR1cmF0aW9uIC0gY3VycmVudEZyYW1lRGF0YS5wb3NpdGlvbikgPj0gMTUpIHtcbiAgICAgICAgICAgIF9yZWZyZXNoRnJhbWUoaGlkZGVuRnJhbWVJbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEN1cnJlbnQgZnJhbWUgaXMgbm90IHBsYXlpbmcgbGFzdCB2aWRlbyBpbiBsaXN0LCBzYWZlIHRvIHJlZnJlc2ggdGhlIGZyYW1lIHRoYXQncyBjdXJyZW50bHkgaGlkZGVuXG4gICAgICAgICAgX3JlZnJlc2hGcmFtZShoaWRkZW5GcmFtZUluZGV4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcblxuICAgIGlmIChmcmFtZU9iaikge1xuICAgICAgZnJhbWVPYmoucGF1c2UoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9mcmFtZUNvbnRyb2xsZXIuZ2V0RnJhbWVPYmplY3QoX2N1cnJlbnRGcmFtZSk7XG5cbiAgICBpZiAoIV9wbGF5YmFja0Vycm9yKSB7XG4gICAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gc2V0IGN1cnJlbnQgZnJhbWUgdG8gYmUgdGhlIG9uZSB2aXNpYmxlXG4gICAgICAgIF9jdXJyZW50RnJhbWUgPSAoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMDtcblxuICAgICAgICAvLyBwbGF5IHRoZSBjdXJyZW50IGZyYW1lIHZpZGVvXG4gICAgICAgIGZyYW1lT2JqID0gX2ZyYW1lQ29udHJvbGxlci5nZXRGcmFtZU9iamVjdChfY3VycmVudEZyYW1lKTtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuXG4gICAgICAgIC8vIHJlLWFkZCBwcmV2aW91c2x5IHJlbW92ZWQgZnJhbWUgYW5kIGNyZWF0ZSB0aGUgcGxheWVyLCBidXQgaGlkZSB2aXNpYmlsaXR5XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKCgoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCkpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSk7XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuY3JlYXRlRnJhbWVQbGF5ZXIoKChfY3VycmVudEZyYW1lID09PSAwKSA/IDEgOiAwKSwgX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBUaGlzIGZsYWcgb25seSBnb3Qgc2V0IHVwb24gYSByZWZyZXNoIG9mIGhpZGRlbiBmcmFtZSBhbmQgdGhlcmUgd2FzIGFuIGVycm9yIGluIHNldHVwIG9yIGZpcnN0IHZpZGVvXG4gICAgICAvLyBTZW5kIFZpZXdlciBcImRvbmVcIlxuICAgICAgX2RvbmUoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzBdKTtcbiAgICAgICAgX3ByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKTtcblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGggPSBfcHJlZnMuZ2V0SW50KFwicnNXXCIpO1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpO1xuXG4gICAgICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgU3RvcmFnZSBtb2R1bGUgaW5zdGFuY2VcbiAgICAgICAgX3N0b3JhZ2UgPSBuZXcgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5TdG9yYWdlKF9hZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgICAgX3N0b3JhZ2UuaW5pdCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllckVuZGVkKCkge1xuICAgIGlmIChfcGxheWJhY2tFcnJvcikge1xuICAgICAgLy8gVGhpcyBmbGFnIG9ubHkgZ2V0cyBzZXQgdXBvbiBhIHJlZnJlc2ggb2YgaGlkZGVuIGZyYW1lIGFuZCB0aGVyZSB3YXMgYW4gZXJyb3IgaW4gc2V0dXAgb3IgZmlyc3QgdmlkZW9cbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIucmVtb3ZlKF9jdXJyZW50RnJhbWUpO1xuICAgICAgX2ZyYW1lQ29udHJvbGxlci5yZW1vdmUoKF9jdXJyZW50RnJhbWUgPT09IDApID8gMSA6IDApO1xuXG4gICAgICBfZG9uZSgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIF9mcmFtZUNvbnRyb2xsZXIuc2hvdygoX2N1cnJlbnRGcmFtZSA9PT0gMCkgPyAxIDogMCk7XG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9kb25lKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIGlmICghX2luaXRpYWxpemVkKSB7XG4gICAgICBpZiAoX2ZyYW1lQ291bnQgPT09IDIpIHtcbiAgICAgICAgLy8gYm90aCBmcmFtZXMgaGF2ZSBiZWVuIGNyZWF0ZWQgYW5kIGxvYWRlZCwgY2FuIG5vdGlmeSBWaWV3ZXIgd2lkZ2V0IGlzIHJlYWR5XG4gICAgICAgIF9pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIF9yZWFkeSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZmlyc3QgZnJhbWUgcGxheWVyIHdhcyBzdWNjZXNzZnVsIGFuZCByZWFkeSwgY3JlYXRlIHRoZSBzZWNvbmQgb25lIGJ1dCBoaWRlIGl0XG4gICAgICAgIF9mcmFtZUNvbnRyb2xsZXIuYWRkKDEpO1xuICAgICAgICBfZnJhbWVDb250cm9sbGVyLmhpZGUoMSk7XG4gICAgICAgIF9mcmFtZUNvdW50ID0gMjtcbiAgICAgICAgX2ZyYW1lQ29udHJvbGxlci5jcmVhdGVGcmFtZVBsYXllcigxLCBfYWRkaXRpb25hbFBhcmFtcywgX2N1cnJlbnRGaWxlcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheWVyRXJyb3IoZXJyb3IpIHtcbiAgICBjb25zb2xlLmRlYnVnKFwidmlkZW8tZm9sZGVyOjpwbGF5ZXJFcnJvcigpXCIsIGVycm9yKTtcblxuICAgIGlmICghX2luaXRpYWxpemVkKSB7XG4gICAgICAvLyBXaWRnZXQgaGFzIG5vdCBzZW50IFwicmVhZHlcIiB5ZXQgYW5kIHRoZXJlIGlzIGFuIGVycm9yIChzZXR1cCBvciBwbGF5YmFjayBvZiBmaXJzdCB2aWRlbywgZG9lc24ndCBtYXR0ZXIgd2hpY2gpXG4gICAgICBfZnJhbWVDb250cm9sbGVyLnJlbW92ZShfY3VycmVudEZyYW1lKTtcblxuICAgICAgLy8gZG8gbm90aGluZyBtb3JlLCBlbnN1cmUgXCJyZWFkeVwiIGlzIG5vdCBzZW50IHRvIFZpZXdlciBzbyB0aGF0IHRoaXMgd2lkZ2V0IGNhbiBiZSBza2lwcGVkXG5cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGVycm9yLnR5cGUgPT09IFwic2V0dXBcIiB8fCBlcnJvci5pbmRleCA9PT0gMCkge1xuICAgICAgICAvLyBUaGlzIG9ubHkgaGFwcGVucyBpbiB0aGUgZXZlbnQgb2YgYSByZWZyZXNoLiBOZXcgZmlsZXMgY2F1c2VkIGFuIGVycm9yIGluIHNldHVwIG9yIGZpcnN0IHZpZGVvIGhhcyBhbiBpc3N1ZVxuICAgICAgICAvLyBUaGUgZXJyb3IgZXZlbnQgd2lsbCBiZSBjb21pbmcgZnJvbSB0aGUgY3VycmVudGx5IGhpZGRlbiBmcmFtZSB3aGVuIGl0IGdvdCByZWNyZWF0ZWQgd2l0aCBuZXcgZmlsZXMgdG8gdXNlXG4gICAgICAgIF9wbGF5YmFja0Vycm9yID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGZvcmNlIHdpZGdldCB0byBhY3QgYXMgdGhvdWdoIHRoZSBwbGF5bGlzdCBpcyBkb25lXG4gICAgICAgIHBsYXllckVuZGVkKCk7XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwib25TdG9yYWdlSW5pdFwiOiBvblN0b3JhZ2VJbml0LFxuICAgIFwib25TdG9yYWdlUmVmcmVzaFwiOiBvblN0b3JhZ2VSZWZyZXNoLFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2luaXRpYWxMb2FkID0gdHJ1ZTtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvRm9sZGVyU3RvcmFnZVwiKTtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInJpc2Utc3RvcmFnZS1yZXNwb25zZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgdXJscyA9IFtdO1xuXG4gICAgICBpZiAoZS5kZXRhaWwgJiYgZS5kZXRhaWwuZmlsZXMgJiYgZS5kZXRhaWwuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBlLmRldGFpbC5maWxlcy5mb3JFYWNoKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICB1cmxzLnB1c2goZmlsZS51cmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoX2luaXRpYWxMb2FkKSB7XG4gICAgICAgICAgX2luaXRpYWxMb2FkID0gZmFsc2U7XG5cbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLm9uU3RvcmFnZUluaXQodXJscyk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLm9uU3RvcmFnZVJlZnJlc2godXJscyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5zdG9yYWdlLmNvbXBhbnlJZCk7XG4gICAgc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5zdG9yYWdlLmZvbGRlcik7XG5cbiAgICBzdG9yYWdlLmdvKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgY29uZmlnICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyLkZyYW1lQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIFBSRUZJWCA9IFwiaWZfXCI7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX2NsZWFyKGluZGV4KSB7XG4gICAgdmFyIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpLFxuICAgICAgaWZyYW1lLCBmcmFtZU9iajtcblxuICAgIHRyeSB7XG4gICAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuICAgICAgZnJhbWVPYmogPSAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpID8gaWZyYW1lLmNvbnRlbnRXaW5kb3cgOlxuICAgICAgICAoaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCkgPyBpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50IDogaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcbiAgICAgIGZyYW1lT2JqLnJlbW92ZSgpO1xuICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBcImFib3V0OmJsYW5rXCIpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5kZWJ1ZyhlKTtcbiAgICB9XG5cbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cblxuICBmdW5jdGlvbiBhZGQoaW5kZXgpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIsIGlmcmFtZTtcblxuICAgIGZyYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpO1xuXG4gICAgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiYWxsb3dUcmFuc3BhcmVuY3lcIiwgdHJ1ZSk7XG4gICAgaWZyYW1lLnNldEF0dHJpYnV0ZShcImZyYW1lYm9yZGVyXCIsIFwiMFwiKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic2Nyb2xsaW5nXCIsIFwibm9cIik7XG5cbiAgICBmcmFtZUNvbnRhaW5lci5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlRnJhbWVQbGF5ZXIoaW5kZXgsIHBhcmFtcywgZmlsZXMpIHtcbiAgICB2YXIgZnJhbWVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChQUkVGSVggKyBpbmRleCksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBmcmFtZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiaWZyYW1lXCIpO1xuXG4gICAgaWYgKGlmcmFtZSkge1xuICAgICAgaWZyYW1lLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWZyYW1lLm9ubG9hZCA9IG51bGw7XG5cbiAgICAgICAgdmFyIGZyYW1lT2JqID0gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgICAoaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCkgPyBpZnJhbWUuY29udGVudERvY3VtZW50LmRvY3VtZW50IDogaWZyYW1lLmNvbnRlbnREb2N1bWVudDtcblxuICAgICAgICAvLyBpbml0aWFsaXplIGFuZCBsb2FkIHRoZSBwbGF5ZXIgaW5zaWRlIHRoZSBpZnJhbWVcbiAgICAgICAgZnJhbWVPYmouaW5pdChwYXJhbXMsIGZpbGVzLCBjb25maWcuU0tJTik7XG4gICAgICB9O1xuXG4gICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwicGxheWVyLmh0bWxcIik7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBnZXRGcmFtZU9iamVjdChpbmRleCkge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KSxcbiAgICAgIGlmcmFtZTtcblxuICAgIGlmcmFtZSA9IGZyYW1lQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICByZXR1cm4gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBoaWRlKGluZGV4KSB7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlKGluZGV4LCBjYWxsYmFjaykge1xuICAgIHZhciBmcmFtZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFBSRUZJWCArIGluZGV4KTtcblxuICAgIF9jbGVhcihpbmRleCk7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIHJlbW92ZSB0aGUgaWZyYW1lIGJ5IGNsZWFyaW5nIGFsbCBlbGVtZW50cyBpbnNpZGUgZGl2IGNvbnRhaW5lclxuICAgICAgd2hpbGUgKGZyYW1lQ29udGFpbmVyLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgZnJhbWVDb250YWluZXIucmVtb3ZlQ2hpbGQoZnJhbWVDb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH0sIDIwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBzaG93KGluZGV4KSB7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJFRklYICsgaW5kZXgpLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgYWRkOiBhZGQsXG4gICAgY3JlYXRlRnJhbWVQbGF5ZXI6IGNyZWF0ZUZyYW1lUGxheWVyLFxuICAgIGdldEZyYW1lT2JqZWN0OiBnZXRGcmFtZU9iamVjdCxcbiAgICBoaWRlOiBoaWRlLFxuICAgIHJlbW92ZTogcmVtb3ZlLFxuICAgIHNob3c6IHNob3dcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBnYWRnZXRzLCBSaXNlVmlzaW9uICovXG5cbihmdW5jdGlvbiAod2luZG93LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmcyA9IG5ldyBnYWRnZXRzLlByZWZzKCksXG4gICAgaWQgPSBwcmVmcy5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIuc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicG9seW1lci1yZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG4gICAgaWYgKGlkICYmIGlkICE9PSBcIlwiKSB7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfc3RvcF9cIiArIGlkLCBzdG9wKTtcblxuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnNldEFkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxufSkod2luZG93LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktNCddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=