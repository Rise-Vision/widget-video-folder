function doneEvent(){parent.RiseVision.VideoFolder.playerEnded()}function readyEvent(){parent.RiseVision.VideoFolder.playerReady()}function errorEvent(e){parent.RiseVision.VideoFolder.playerError(e)}function loadVideo(e,t,n,o,i,r,a){width=e,height=t,volume=n,autoPlay=o,scaleToFit=i,pauseDuration=r,files=a.split(","),player&&player.loadVideo()}function play(){player.play()}function pause(){player.pause()}function stop(){player.stop()}function remove(){player.remove()}function PlayerJW(){function e(e){var t,n=[".mp4",".webm",".ogg",".ogv"],o=e.toLowerCase(),i=null;for(t=0;t<=n.length;t+=1)if(-1!==o.indexOf(n[t])){i=n[t].substr(n[t].lastIndexOf(".")+1);break}return"ogv"===i&&(i="ogg"),i}function t(){for(var t=[],n=0;n<files.length;n+=1)t.push({sources:[{file:files[n],type:e(files[n])}]});return t}function n(){doneEvent()}function o(){clearTimeout(pauseTimer)}function i(){viewerPaused||(clearTimeout(pauseTimer),pauseTimer=setTimeout(function(){jwplayer().play(),jwplayer().setControls(!1),jwplayer().setControls(!0)},1e3*pauseDuration))}function r(e){e&&errorEvent({type:"video",index:jwplayer().getPlaylistIndex()})}function a(e){e&&errorEvent({type:"setup",index:0})}this.loadVideo=function(){jwplayer("player").setup({playlist:t(),width:width,height:height,controls:!autoPlay,stretching:scaleToFit?"uniform":"none"}),jwplayer().onSetupError(function(e){a(e)}),jwplayer().onReady(function(){var e,t=document.getElementById("player").getElementsByTagName("*"),a=t.length;for(e=0;a>e;e+=1)t[e].className+=" notransition";document.getElementById("player").className+=" notransition",jwplayer().setMute(!1),jwplayer().setVolume(volume),jwplayer().onPlaylistComplete(function(){n()}),jwplayer().onPause(function(){i()}),jwplayer().onPlay(function(){o()}),jwplayer().onError(function(e){r(e)}),setTimeout(function(){readyEvent()},200)})},this.play=function(){viewerPaused=!1,autoPlay&&jwplayer().play()},this.pause=function(){viewerPaused=!0,clearTimeout(pauseTimer),jwplayer().pause()},this.stop=function(){this.pause()},this.remove=function(){viewerPaused=!1,jwplayer().remove()}}if("undefined"==typeof config){var config={};"undefined"!=typeof angular&&(angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","components/rv-common-i18n/dist/locales/translation_").constant("LOCALES_SUFIX",".json"),angular.module("risevision.widget.common.storage-selector.config").value("STORAGE_MODAL","http://storage-stage-rva-test.risevision.com/modal.html"))}var RiseVision=RiseVision||{};RiseVision.VideoFolder={},RiseVision.VideoFolder=function(e){"use strict";function t(){e.rpc.call("","rsevent_done",null,h.getString("id"))}function n(){e.rpc.call("","rsevent_ready",null,h.getString("id"),!0,!0,!0,!0,!0)}function o(){var e=document.querySelector("#videoContainer iframe");return e?e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument:null}function i(){var e,t=document.getElementById("videoContainer");e=document.createElement("iframe"),e.setAttribute("allowTransparency",!0),e.setAttribute("frameborder","0"),e.setAttribute("scrolling","no"),t.appendChild(e)}function r(){V=new RiseVision.VideoFolder.Storage(y),V.init()}function a(){var e=RiseVision.VideoFolder.Template.getHTML(y,v),t=o();t&&(t.document.open(),t.document.write(e),t.document.close())}function s(e){v=e,i(),a()}function l(){}function c(){var e=o();e&&e.pause()}function u(){var e=o();k?t():e?e.play():(i(),a())}function d(t,n){Array.isArray(t)&&t.length>0&&"additionalParams"===t[0]&&Array.isArray(n)&&n.length>0&&(y=JSON.parse(n[0]),h=new e.Prefs,document.getElementById("videoContainer").style.height=h.getInt("rsH")+"px",y.width=h.getInt("rsW"),y.height=h.getInt("rsH"),w=new RiseVision.Common.Background(y),w.init(r))}function p(){var e=document.getElementById("videoContainer"),n=o();n&&(n.remove(),n.location.reload(),setTimeout(function(){for(R=!0;e.firstChild;)e.removeChild(e.firstChild);t()},200))}function m(){b?u():(b=!0,n())}function g(e){console.debug("video-folder::playerError()",e),("setup"===e.type||0===e.index)&&(k=!0),p()}function f(){c()}var y,v,h=null,w=null,V=null,b=!1,R=!1,k=!1;return{onStorageInit:s,onStorageRefresh:l,pause:c,play:u,setAdditionalParams:d,playerEnded:p,playerReady:m,playerError:g,stop:f}}(gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){s.style.backgroundImage="url("+e.background.image.url+d+"cb="+(new Date).getTime()+")",t()},c)}function n(){a=!0,e.background.useImage&&!u&&t(),r&&"function"==typeof r&&r()}function o(){var t;s=document.getElementById("background"),l=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,s?e.background.useImage?(s.className=e.background.image.position,s.className=e.background.image.scale?s.className+" scale-to-fit":s.className,u=0!==Object.keys(e.backgroundStorage).length,u?l?(l.addEventListener("rise-storage-response",function(e){e.detail&&e.detail.files&&e.detail.files.length>0&&(s.style.backgroundImage="url("+e.detail.files[0].url+")"),a||n()}),l.setAttribute("folder",e.backgroundStorage.folder),l.setAttribute("fileName",e.backgroundStorage.fileName),l.setAttribute("companyId",e.backgroundStorage.companyId),l.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),d=1===t.length?"?":"&",s.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function i(e){a?e&&"function"==typeof e&&e():(e&&(r=e),o())}var r=null,a=!1,s=null,l=null,c=9e5,u=!1,d="";return{init:i}};var RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Storage=function(e){"use strict";function t(){var t=document.getElementById("videoFolderStorage"),o="",i="";if(t){switch(t.addEventListener("rise-storage-response",function(e){var t=[];e.detail&&e.detail.files&&e.detail.files.length>0&&(e.detail.files.forEach(function(e){t.push(e.url)}),n?(n=!1,RiseVision.VideoFolder.onStorageInit(t)):RiseVision.VideoFolder.onStorageRefresh(t))}),t.setAttribute("companyId",e.storage.companyId),t.setAttribute("folder",e.storage.folder),e.order){case"alpha-asc":o="name",i="asc";break;case"alpha-desc":o="name",i="desc";break;case"date-asc":o="date",i="asc";break;case"date-desc":o="date",i="desc";break;case"random":o="random";break;default:o="name",i="asc"}t.setAttribute("sort",o),t.setAttribute("sortDirection",i),t.go()}}var n=!0;return{init:t}};var files,volume,autoPlay,scaleToFit,pauseDuration,width,height,viewerPaused=!1,pauseTimer=null,player=null,RiseVision=RiseVision||{};RiseVision.VideoFolder=RiseVision.VideoFolder||{},RiseVision.VideoFolder.Template=function(){"use strict";function e(e,n){var o=t;return o=o.replace("%s1",e.width+"px"),o=o.replace("%s2",e.height+"px"),o=o.replace("%s3",e.video.volume),o=o.replace("%s4",e.video.autoplay),o=o.replace("%s5",e.video.scaleToFit),o=o.replace("%s6",e.pause),o=o.replace("%s7",n.join())}var t='<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title></title><script type="text/javascript" src="//s3.amazonaws.com/rise-common/scripts/jw-player/jwplayer.js"></script><script>jwplayer.key="xBXyUtAJ+brFzwc2kNhDg/Sqk8W7rmktAYliYHzVgxo="</script><script type="text/javascript" src="js/player.min.js"></script><style>	body { 		background-color: transparent; 		-moz-user-select: none; 		-webkit-user-select: none; 		-khtml-user-select: none; 		user-select: none; 	} .notransition {    -webkit-transition: none !important;    transition: none !important;  }</style></head><body style="margin:0px;"><div id="player">Loading the player...</div><script language="javascript">	window.oncontextmenu = function() {		return false;	};	try {		player = new PlayerJW();		loadVideo("%s1", "%s2", %s3, %s4, %s5, %s6, "%s7");	} catch (e) {		console.log(e.message);		parent.RiseVision.VideoFolder.playerError();	}</script></body></html>';return{getHTML:e}}(),function(e,t){"use strict";function n(){RiseVision.VideoFolder.play()}function o(){RiseVision.VideoFolder.pause()}function i(){RiseVision.VideoFolder.stop()}function r(){e.removeEventListener("polymer-ready",r),s&&""!==s&&(t.rpc.register("rscmd_play_"+s,n),t.rpc.register("rscmd_pause_"+s,o),t.rpc.register("rscmd_stop_"+s,i),t.rpc.register("rsparam_set_"+s,RiseVision.VideoFolder.setAdditionalParams),t.rpc.call("","rsparam_get",null,s,["additionalParams"]))}var a=new t.Prefs,s=a.getString("id");e.oncontextmenu=function(){return!1},e.addEventListener("polymer-ready",r)}(window,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-4"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiZG9uZUV2ZW50IiwicGFyZW50IiwiUmlzZVZpc2lvbiIsIlZpZGVvRm9sZGVyIiwicGxheWVyRW5kZWQiLCJyZWFkeUV2ZW50IiwicGxheWVyUmVhZHkiLCJlcnJvckV2ZW50IiwiZGF0YSIsInBsYXllckVycm9yIiwibG9hZFZpZGVvIiwid2lkdGhQYXJhbSIsImhlaWdodFBhcmFtIiwidm9sdW1lUGFyYW0iLCJhdXRvUGxheVBhcmFtIiwic2NhbGVUb0ZpdFBhcmFtIiwicGF1c2VQYXJhbSIsImZpbGVzUGFyYW0iLCJ3aWR0aCIsImhlaWdodCIsInZvbHVtZSIsImF1dG9QbGF5Iiwic2NhbGVUb0ZpdCIsInBhdXNlRHVyYXRpb24iLCJmaWxlcyIsInNwbGl0IiwicGxheWVyIiwicGxheSIsInBhdXNlIiwic3RvcCIsInJlbW92ZSIsIlBsYXllckpXIiwiZ2V0VmlkZW9GaWxlVHlwZSIsInVybCIsImkiLCJleHRlbnNpb25zIiwidXJsTG93ZXJjYXNlIiwidG9Mb3dlckNhc2UiLCJ0eXBlIiwibGVuZ3RoIiwiaW5kZXhPZiIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwiZ2V0UGxheWxpc3QiLCJwbGF5bGlzdCIsInB1c2giLCJzb3VyY2VzIiwiZmlsZSIsIm9uUGxheWxpc3RDb21wbGV0ZSIsIm9uUGxheSIsImNsZWFyVGltZW91dCIsInBhdXNlVGltZXIiLCJvblBhdXNlIiwidmlld2VyUGF1c2VkIiwic2V0VGltZW91dCIsImp3cGxheWVyIiwic2V0Q29udHJvbHMiLCJvblBsYXllckVycm9yIiwiZXJyb3IiLCJpbmRleCIsImdldFBsYXlsaXN0SW5kZXgiLCJvblNldHVwRXJyb3IiLCJ0aGlzIiwic2V0dXAiLCJjb250cm9scyIsInN0cmV0Y2hpbmciLCJvblJlYWR5IiwiZWxlbWVudHMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJ0b3RhbCIsImNsYXNzTmFtZSIsInNldE11dGUiLCJzZXRWb2x1bWUiLCJvbkVycm9yIiwiY29uZmlnIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwidmFsdWUiLCJnYWRnZXRzIiwiX2RvbmUiLCJycGMiLCJjYWxsIiwiX3ByZWZzIiwiZ2V0U3RyaW5nIiwiX3JlYWR5IiwiX2dldEZyYW1lT2JqZWN0IiwiaWZyYW1lIiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnRXaW5kb3ciLCJjb250ZW50RG9jdW1lbnQiLCJfYWRkRnJhbWUiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYXBwZW5kQ2hpbGQiLCJfYmFja2dyb3VuZFJlYWR5IiwiX3N0b3JhZ2UiLCJTdG9yYWdlIiwiX2FkZGl0aW9uYWxQYXJhbXMiLCJpbml0IiwiX2NyZWF0ZVBsYXllciIsImh0bWwiLCJUZW1wbGF0ZSIsImdldEhUTUwiLCJfY3VycmVudEZpbGVzIiwibXlGcmFtZU9iaiIsIm9wZW4iLCJ3cml0ZSIsImNsb3NlIiwib25TdG9yYWdlSW5pdCIsInVybHMiLCJvblN0b3JhZ2VSZWZyZXNoIiwiZnJhbWVPYmoiLCJfc2V0dXBFcnJvciIsInNldEFkZGl0aW9uYWxQYXJhbXMiLCJuYW1lcyIsInZhbHVlcyIsIkFycmF5IiwiaXNBcnJheSIsIkpTT04iLCJwYXJzZSIsIlByZWZzIiwic3R5bGUiLCJnZXRJbnQiLCJfYmFja2dyb3VuZCIsIkNvbW1vbiIsIkJhY2tncm91bmQiLCJsb2NhdGlvbiIsInJlbG9hZCIsIl9lbmRlZCIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsIl9pbml0aWFsaXplZCIsImNvbnNvbGUiLCJkZWJ1ZyIsIl9yZWZyZXNoVGltZXIiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJiYWNrZ3JvdW5kIiwiaW1hZ2UiLCJfc2VwYXJhdG9yIiwiRGF0ZSIsImdldFRpbWUiLCJfcmVmcmVzaER1cmF0aW9uIiwidXNlSW1hZ2UiLCJfaXNTdG9yYWdlRmlsZSIsIl9jYWxsYmFjayIsIl9jb25maWd1cmUiLCJzdHIiLCJib2R5IiwiY29sb3IiLCJwb3NpdGlvbiIsInNjYWxlIiwiT2JqZWN0Iiwia2V5cyIsImJhY2tncm91bmRTdG9yYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJmb2xkZXIiLCJmaWxlTmFtZSIsImNvbXBhbnlJZCIsImdvIiwibG9nIiwiY2IiLCJzdG9yYWdlIiwic29ydCIsInNvcnREaXJlY3Rpb24iLCJmb3JFYWNoIiwiX2luaXRpYWxMb2FkIiwib3JkZXIiLCJwYXJhbXMiLCJodG1sU3RyaW5nIiwiVEVNUExBVEUiLCJyZXBsYWNlIiwidmlkZW8iLCJhdXRvcGxheSIsImpvaW4iLCJ3aW5kb3ciLCJwb2x5bWVyUmVhZHkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaWQiLCJyZWdpc3RlciIsInByZWZzIiwib25jb250ZXh0bWVudSIsIl9nYXEiLCJnYSIsImFzeW5jIiwic3JjIiwicHJvdG9jb2wiLCJzIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBa1pBLFFBQVNBLGFBQ1BDLE9BQU9DLFdBQVdDLFlBQVlDLGNBR2hDLFFBQVNDLGNBQ1BKLE9BQU9DLFdBQVdDLFlBQVlHLGNBR2hDLFFBQVNDLFlBQVdDLEdBQ2xCUCxPQUFPQyxXQUFXQyxZQUFZTSxZQUFZRCxHQUc1QyxRQUFTRSxXQUFVQyxFQUFZQyxFQUFhQyxFQUFhQyxFQUFlQyxFQUFpQkMsRUFBWUMsR0FDbkdDLE1BQVFQLEVBQ1JRLE9BQVNQLEVBQ1RRLE9BQVNQLEVBQ1RRLFNBQVdQLEVBQ1hRLFdBQWFQLEVBQ2JRLGNBQWdCUCxFQUNoQlEsTUFBUVAsRUFBV1EsTUFBTSxLQUVyQkMsUUFDRkEsT0FBT2hCLFlBSVgsUUFBU2lCLFFBQ1BELE9BQU9DLE9BR1QsUUFBU0MsU0FDUEYsT0FBT0UsUUFHVCxRQUFTQyxRQUNQSCxPQUFPRyxPQUdULFFBQVNDLFVBQ1BKLE9BQU9JLFNBR1QsUUFBU0MsWUFDUCxRQUFTQyxHQUFpQkMsR0FDeEIsR0FHRUMsR0FIRUMsR0FB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RUFBUUUsSUFBSXFHLFNBQVMsY0FBZ0JELEVBQUkxSixHQUV6Q29ELEVBQVFFLElBQUlxRyxTQUFTLGVBQWlCRCxFQUFJckwsV0FBV0MsWUFBWWtILHFCQUNqRXBDLEVBQVFFLElBQUlDLEtBQUssR0FBSSxjQUFlLEtBQU1tRyxHQUFLLHNCQTdCbkQsR0FBSUUsR0FBUSxHQUFJeEcsR0FBUTJDLE1BQ3RCMkQsRUFBS0UsRUFBTW5HLFVBQVUsS0FHdkI4RixHQUFPTSxjQUFnQixXQUNyQixPQUFPLEdBNEJUTixFQUFPdEIsaUJBQWlCLGdCQUFpQnVCLElBRXhDRCxPQUFRbkcsUUFLWCxJQUFJMEcsTUFBT0EsUUFFWEEsTUFBSzlJLE1BQU0sY0FBZSxrQkFDMUI4SSxLQUFLOUksTUFBTSxtQkFFWCxXQUNFLEdBQUkrSSxHQUFLeEgsU0FBUzJCLGNBQWMsU0FBVzZGLEdBQUd0SixLQUFPLGtCQUFtQnNKLEVBQUdDLE9BQVEsRUFDbkZELEVBQUdFLEtBQU8sVUFBWTFILFNBQVM4RCxTQUFTNkQsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSTVILFNBQVNFLHFCQUFxQixVQUFVLEVBQUkwSCxHQUFFQyxXQUFXQyxhQUFhTixFQUFJSSIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNvbmZpZzogdHJ1ZSAqL1xuLyogZXhwb3J0ZWQgY29uZmlnICovXG5pZiAodHlwZW9mIGNvbmZpZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB2YXIgY29uZmlnID0ge1xuICAgIC8vIHZhcmlhYmxlcyBnbyBoZXJlXG4gIH07XG5cbiAgaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLmNvbW1vbi5pMThuLmNvbmZpZ1wiLCBbXSlcbiAgICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwiY29tcG9uZW50cy9ydi1jb21tb24taTE4bi9kaXN0L2xvY2FsZXMvdHJhbnNsYXRpb25fXCIpXG4gICAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24ud2lkZ2V0LmNvbW1vbi5zdG9yYWdlLXNlbGVjdG9yLmNvbmZpZ1wiKVxuICAgICAgLnZhbHVlKFwiU1RPUkFHRV9NT0RBTFwiLCBcImh0dHA6Ly9zdG9yYWdlLXN0YWdlLXJ2YS10ZXN0LnJpc2V2aXNpb24uY29tL21vZGFsLmh0bWxcIik7XG4gIH1cbn1cblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlciA9IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyID0gKGZ1bmN0aW9uIChnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWRkaXRpb25hbFBhcmFtcztcblxuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfYmFja2dyb3VuZCA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsO1xuXG4gIHZhciBfaW5pdGlhbGl6ZWQgPSBmYWxzZSxcbiAgICBfZW5kZWQgPSBmYWxzZSxcbiAgICBfc2V0dXBFcnJvciA9IGZhbHNlO1xuXG4gIHZhciBfY3VycmVudEZpbGVzO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9kb25lKCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X2RvbmVcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRGcmFtZU9iamVjdCgpIHtcbiAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN2aWRlb0NvbnRhaW5lciBpZnJhbWVcIik7XG5cbiAgICBpZiAoaWZyYW1lKSB7XG4gICAgICByZXR1cm4gKGlmcmFtZS5jb250ZW50V2luZG93KSA/IGlmcmFtZS5jb250ZW50V2luZG93IDpcbiAgICAgICAgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQuZG9jdW1lbnQpID8gaWZyYW1lLmNvbnRlbnREb2N1bWVudC5kb2N1bWVudCA6IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBfYWRkRnJhbWUoKSB7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9Db250YWluZXJcIiksXG4gICAgICBpZnJhbWU7XG5cbiAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1RyYW5zcGFyZW5jeVwiLCB0cnVlKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwgXCIwXCIpO1xuICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIiwgXCJub1wiKTtcblxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICBfc3RvcmFnZSA9IG5ldyBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UoX2FkZGl0aW9uYWxQYXJhbXMpO1xuICAgIF9zdG9yYWdlLmluaXQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jcmVhdGVQbGF5ZXIoKSB7XG4gICAgdmFyIGh0bWwgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlRlbXBsYXRlLmdldEhUTUwoX2FkZGl0aW9uYWxQYXJhbXMsIF9jdXJyZW50RmlsZXMpLFxuICAgICAgbXlGcmFtZU9iaiA9IF9nZXRGcmFtZU9iamVjdCgpO1xuXG4gICAgaWYgKG15RnJhbWVPYmopIHtcbiAgICAgIG15RnJhbWVPYmouZG9jdW1lbnQub3BlbigpO1xuICAgICAgbXlGcmFtZU9iai5kb2N1bWVudC53cml0ZShodG1sKTtcbiAgICAgIG15RnJhbWVPYmouZG9jdW1lbnQuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZUluaXQodXJscykge1xuICAgIF9jdXJyZW50RmlsZXMgPSB1cmxzO1xuICAgIF9hZGRGcmFtZSgpO1xuICAgIF9jcmVhdGVQbGF5ZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcmFnZVJlZnJlc2goLyp1cmxzKi8pIHtcbiAgICAvL1RPRE86IGhhbmRsZSBhIHJlZnJlc2hcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIHZhciBmcmFtZU9iaiA9IF9nZXRGcmFtZU9iamVjdCgpO1xuXG4gICAgaWYgKGZyYW1lT2JqKSB7XG4gICAgICBmcmFtZU9iai5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgdmFyIGZyYW1lT2JqID0gX2dldEZyYW1lT2JqZWN0KCk7XG5cbiAgICBpZiAoIV9zZXR1cEVycm9yKSB7XG4gICAgICBpZiAoZnJhbWVPYmopIHtcbiAgICAgICAgZnJhbWVPYmoucGxheSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2FkZEZyYW1lKCk7XG4gICAgICAgIF9jcmVhdGVQbGF5ZXIoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgX2RvbmUoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMobmFtZXMsIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIG5hbWVzWzBdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzBdKTtcbiAgICAgICAgX3ByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKTtcblxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvQ29udGFpbmVyXCIpLnN0eWxlLmhlaWdodCA9IF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgKyBcInB4XCI7XG5cbiAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMud2lkdGggPSBfcHJlZnMuZ2V0SW50KFwicnNXXCIpO1xuICAgICAgICBfYWRkaXRpb25hbFBhcmFtcy5oZWlnaHQgPSBfcHJlZnMuZ2V0SW50KFwicnNIXCIpO1xuXG4gICAgICAgIC8vIGNyZWF0ZSBhbmQgaW5pdGlhbGl6ZSB0aGUgQmFja2dyb3VuZCBpbnN0YW5jZVxuICAgICAgICBfYmFja2dyb3VuZCA9IG5ldyBSaXNlVmlzaW9uLkNvbW1vbi5CYWNrZ3JvdW5kKF9hZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgICAgX2JhY2tncm91bmQuaW5pdChfYmFja2dyb3VuZFJlYWR5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFbmRlZCgpIHtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWRlb0NvbnRhaW5lclwiKSxcbiAgICAgIG15RnJhbWVPYmogPSBfZ2V0RnJhbWVPYmplY3QoKTtcblxuICAgIGlmIChteUZyYW1lT2JqKSB7XG4gICAgICBteUZyYW1lT2JqLnJlbW92ZSgpO1xuICAgICAgbXlGcmFtZU9iai5sb2NhdGlvbi5yZWxvYWQoKTtcblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9lbmRlZCA9IHRydWU7XG5cbiAgICAgICAgLy8gcmVtb3ZlIHRoZSBpZnJhbWUgYnkgY2xlYXJpbmcgYWxsIGVsZW1lbnRzIGluc2lkZSBkaXYgY29udGFpbmVyXG4gICAgICAgIHdoaWxlIChjb250YWluZXIuZmlyc3RDaGlsZCkge1xuICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZChjb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgICAgIH1cblxuICAgICAgICBfZG9uZSgpO1xuICAgICAgfSwgMjAwKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXllclJlYWR5KCkge1xuICAgIGlmICghX2luaXRpYWxpemVkKSB7XG4gICAgICBfaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgX3JlYWR5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5ZXJFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZGVidWcoXCJ2aWRlby1mb2xkZXI6OnBsYXllckVycm9yKClcIiwgZXJyb3IpO1xuXG4gICAgaWYgKGVycm9yLnR5cGUgPT09IFwic2V0dXBcIiB8fCBlcnJvci5pbmRleCA9PT0gMCkge1xuICAgICAgX3NldHVwRXJyb3IgPSB0cnVlO1xuICAgIH1cblxuICAgIHBsYXllckVuZGVkKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwib25TdG9yYWdlSW5pdFwiOiBvblN0b3JhZ2VJbml0LFxuICAgIFwib25TdG9yYWdlUmVmcmVzaFwiOiBvblN0b3JhZ2VSZWZyZXNoLFxuICAgIFwicGF1c2VcIjogcGF1c2UsXG4gICAgXCJwbGF5XCI6IHBsYXksXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwbGF5ZXJFbmRlZFwiOiBwbGF5ZXJFbmRlZCxcbiAgICBcInBsYXllclJlYWR5XCI6IHBsYXllclJlYWR5LFxuICAgIFwicGxheWVyRXJyb3JcIjogcGxheWVyRXJyb3IsXG4gICAgXCJzdG9wXCI6IHN0b3BcbiAgfTtcblxufSkoZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLkJhY2tncm91bmQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2NhbGxiYWNrID0gbnVsbCxcbiAgICBfcmVhZHkgPSBmYWxzZSxcbiAgICBfYmFja2dyb3VuZCA9IG51bGwsXG4gICAgX3N0b3JhZ2UgPSBudWxsLFxuICAgIF9yZWZyZXNoRHVyYXRpb24gPSA5MDAwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgICBfaXNTdG9yYWdlRmlsZSA9IGZhbHNlLFxuICAgIF9zZXBhcmF0b3IgPSBcIlwiO1xuXG4gIC8qXG4gICAqIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX3JlZnJlc2hUaW1lcigpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIGJhY2tncm91bmRSZWZyZXNoKCkge1xuICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsICsgX3NlcGFyYXRvciArIFwiY2I9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIFwiKVwiO1xuICAgICAgX3JlZnJlc2hUaW1lcigpO1xuICAgIH0sIF9yZWZyZXNoRHVyYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gX2JhY2tncm91bmRSZWFkeSgpIHtcbiAgICBfcmVhZHkgPSB0cnVlO1xuXG4gICAgaWYgKGRhdGEuYmFja2dyb3VuZC51c2VJbWFnZSAmJiAhX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgIC8vIHN0YXJ0IHRoZSByZWZyZXNoIHBvbGwgZm9yIG5vbi1zdG9yYWdlIGJhY2tncm91bmQgaW1hZ2VcbiAgICAgIF9yZWZyZXNoVGltZXIoKTtcbiAgICB9XG5cbiAgICBpZiAoX2NhbGxiYWNrICYmIHR5cGVvZiBfY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgX2NhbGxiYWNrKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NvbmZpZ3VyZSgpIHtcbiAgICB2YXIgc3RyO1xuXG4gICAgX2JhY2tncm91bmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRcIik7XG4gICAgX3N0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJhY2tncm91bmRTdG9yYWdlXCIpO1xuXG4gICAgLy8gc2V0IHRoZSBkb2N1bWVudCBiYWNrZ3JvdW5kXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kID0gZGF0YS5iYWNrZ3JvdW5kLmNvbG9yO1xuXG4gICAgaWYgKF9iYWNrZ3JvdW5kKSB7XG4gICAgICBpZiAoZGF0YS5iYWNrZ3JvdW5kLnVzZUltYWdlKSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5wb3NpdGlvbjtcbiAgICAgICAgX2JhY2tncm91bmQuY2xhc3NOYW1lID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnNjYWxlID8gX2JhY2tncm91bmQuY2xhc3NOYW1lICsgXCIgc2NhbGUtdG8tZml0XCJcbiAgICAgICAgICA6IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZTtcblxuICAgICAgICBfaXNTdG9yYWdlRmlsZSA9IChPYmplY3Qua2V5cyhkYXRhLmJhY2tncm91bmRTdG9yYWdlKS5sZW5ndGggIT09IDApO1xuXG4gICAgICAgIGlmICghX2lzU3RvcmFnZUZpbGUpIHtcbiAgICAgICAgICBzdHIgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsLnNwbGl0KFwiP1wiKTtcblxuICAgICAgICAgIC8vIHN0b3JlIHRoaXMgZm9yIHRoZSByZWZyZXNoIHRpbWVyXG4gICAgICAgICAgX3NlcGFyYXRvciA9IChzdHIubGVuZ3RoID09PSAxKSA/IFwiP1wiIDogXCImXCI7XG5cbiAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGRhdGEuYmFja2dyb3VuZC5pbWFnZS51cmwgKyBcIilcIjtcbiAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF9zdG9yYWdlKSB7XG4gICAgICAgICAgICAvLyBSaXNlIFN0b3JhZ2VcbiAgICAgICAgICAgIF9zdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGUuZGV0YWlsLmZpbGVzWzBdLnVybCArIFwiKVwiO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKCFfcmVhZHkpIHtcbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5mb2xkZXIpO1xuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5jb21wYW55SWQpO1xuICAgICAgICAgICAgX3N0b3JhZ2UuZ28oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCB2YWx1ZSBvZiAnYmFja2dyb3VuZFN0b3JhZ2UnXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIHZhbHVlIG9mICdiYWNrZ3JvdW5kJ1wiKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoY2IpIHtcbiAgICBpZiAoIV9yZWFkeSkge1xuICAgICAgaWYgKGNiKSB7XG4gICAgICAgIF9jYWxsYmFjayA9IGNiO1xuICAgICAgfVxuXG4gICAgICBfY29uZmlndXJlKCk7XG5cbiAgICB9IGVsc2UgaWYgKGNiICYmIHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjYigpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJpbml0XCI6IGluaXRcbiAgfTtcbn07XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlN0b3JhZ2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2luaXRpYWxMb2FkID0gdHJ1ZTtcblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgdmFyIHN0b3JhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvRm9sZGVyU3RvcmFnZVwiKSxcbiAgICAgIHNvcnQgPSBcIlwiLFxuICAgICAgc29ydERpcmVjdGlvbiA9IFwiXCI7XG5cbiAgICBpZiAoIXN0b3JhZ2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdG9yYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJyaXNlLXN0b3JhZ2UtcmVzcG9uc2VcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHVybHMgPSBbXTtcblxuICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLmZpbGVzICYmIGUuZGV0YWlsLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZS5kZXRhaWwuZmlsZXMuZm9yRWFjaChmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgdXJscy5wdXNoKGZpbGUudXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKF9pbml0aWFsTG9hZCkge1xuICAgICAgICAgIF9pbml0aWFsTG9hZCA9IGZhbHNlO1xuXG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VJbml0KHVybHMpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5vblN0b3JhZ2VSZWZyZXNoKHVybHMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiY29tcGFueUlkXCIsIGRhdGEuc3RvcmFnZS5jb21wYW55SWQpO1xuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZm9sZGVyXCIsIGRhdGEuc3RvcmFnZS5mb2xkZXIpO1xuXG4gICAgLy8gU29ydGluZ1xuICAgIHN3aXRjaCAoZGF0YS5vcmRlcikge1xuICAgICAgY2FzZSBcImFscGhhLWFzY1wiOlxuICAgICAgICBzb3J0ID0gXCJuYW1lXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhbHBoYS1kZXNjXCI6XG4gICAgICAgIHNvcnQgPSBcIm5hbWVcIjtcbiAgICAgICAgc29ydERpcmVjdGlvbiA9IFwiZGVzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkYXRlLWFzY1wiOlxuICAgICAgICBzb3J0ID0gXCJkYXRlXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkYXRlLWRlc2NcIjpcbiAgICAgICAgc29ydCA9IFwiZGF0ZVwiO1xuICAgICAgICBzb3J0RGlyZWN0aW9uID0gXCJkZXNjXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInJhbmRvbVwiOlxuICAgICAgICBzb3J0ID0gXCJyYW5kb21cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzb3J0ID0gXCJuYW1lXCI7XG4gICAgICAgIHNvcnREaXJlY3Rpb24gPSBcImFzY1wiO1xuICAgIH1cblxuICAgIHN0b3JhZ2Uuc2V0QXR0cmlidXRlKFwic29ydFwiLCBzb3J0KTtcbiAgICBzdG9yYWdlLnNldEF0dHJpYnV0ZShcInNvcnREaXJlY3Rpb25cIiwgc29ydERpcmVjdGlvbik7XG4gICAgc3RvcmFnZS5nbygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImluaXRcIjogaW5pdFxuICB9O1xufTtcblxudmFyIGZpbGVzO1xudmFyIHZvbHVtZSwgYXV0b1BsYXksIHNjYWxlVG9GaXQsIHBhdXNlRHVyYXRpb247XG52YXIgd2lkdGgsIGhlaWdodDtcblxudmFyIHZpZXdlclBhdXNlZCA9IGZhbHNlO1xudmFyIHBhdXNlVGltZXIgPSBudWxsO1xuXG52YXIgcGxheWVyID0gbnVsbDtcblxuZnVuY3Rpb24gZG9uZUV2ZW50KCkge1xuICBwYXJlbnQuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5ZXJFbmRlZCgpO1xufVxuXG5mdW5jdGlvbiByZWFkeUV2ZW50KCkge1xuICBwYXJlbnQuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5ZXJSZWFkeSgpO1xufVxuXG5mdW5jdGlvbiBlcnJvckV2ZW50KGRhdGEpIHtcbiAgcGFyZW50LlJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGxheWVyRXJyb3IoZGF0YSk7XG59XG5cbmZ1bmN0aW9uIGxvYWRWaWRlbyh3aWR0aFBhcmFtLCBoZWlnaHRQYXJhbSwgdm9sdW1lUGFyYW0sIGF1dG9QbGF5UGFyYW0sIHNjYWxlVG9GaXRQYXJhbSwgcGF1c2VQYXJhbSwgZmlsZXNQYXJhbSkge1xuICB3aWR0aCA9IHdpZHRoUGFyYW07XG4gIGhlaWdodCA9IGhlaWdodFBhcmFtO1xuICB2b2x1bWUgPSB2b2x1bWVQYXJhbTtcbiAgYXV0b1BsYXkgPSBhdXRvUGxheVBhcmFtO1xuICBzY2FsZVRvRml0ID0gc2NhbGVUb0ZpdFBhcmFtO1xuICBwYXVzZUR1cmF0aW9uID0gcGF1c2VQYXJhbTtcbiAgZmlsZXMgPSBmaWxlc1BhcmFtLnNwbGl0KFwiLFwiKTtcblxuICBpZiAocGxheWVyKSB7XG4gICAgcGxheWVyLmxvYWRWaWRlbygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHBsYXkoKSB7XG4gIHBsYXllci5wbGF5KCk7XG59XG5cbmZ1bmN0aW9uIHBhdXNlKCkge1xuICBwbGF5ZXIucGF1c2UoKTtcbn1cblxuZnVuY3Rpb24gc3RvcCgpIHtcbiAgcGxheWVyLnN0b3AoKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlKCkge1xuICBwbGF5ZXIucmVtb3ZlKCk7XG59XG5cbmZ1bmN0aW9uIFBsYXllckpXKCkge1xuICBmdW5jdGlvbiBnZXRWaWRlb0ZpbGVUeXBlKHVybCkge1xuICAgIHZhciBleHRlbnNpb25zID0gW1wiLm1wNFwiLCBcIi53ZWJtXCIsIFwiLm9nZ1wiLCBcIi5vZ3ZcIl0sXG4gICAgICB1cmxMb3dlcmNhc2UgPSB1cmwudG9Mb3dlckNhc2UoKSxcbiAgICAgIHR5cGUgPSBudWxsLFxuICAgICAgaTtcblxuICAgIGZvciAoaSA9IDA7IGkgPD0gZXh0ZW5zaW9ucy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgaWYgKHVybExvd2VyY2FzZS5pbmRleE9mKGV4dGVuc2lvbnNbaV0pICE9PSAtMSkge1xuICAgICAgICB0eXBlID0gZXh0ZW5zaW9uc1tpXS5zdWJzdHIoZXh0ZW5zaW9uc1tpXS5sYXN0SW5kZXhPZihcIi5cIikgKyAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHR5cGUgPT09IFwib2d2XCIpIHtcbiAgICAgIHR5cGUgPSBcIm9nZ1wiO1xuICAgIH1cblxuICAgIHJldHVybiB0eXBlO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0UGxheWxpc3QoKSB7XG4gICAgdmFyIHBsYXlsaXN0ID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBwbGF5bGlzdC5wdXNoKHtcbiAgICAgICAgc291cmNlczogW3tcbiAgICAgICAgICBmaWxlOiBmaWxlc1tpXSxcbiAgICAgICAgICB0eXBlOiBnZXRWaWRlb0ZpbGVUeXBlKGZpbGVzW2ldKVxuICAgICAgICB9XVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBsYXlsaXN0O1xuICB9XG5cbiAgZnVuY3Rpb24gb25QbGF5bGlzdENvbXBsZXRlKCkge1xuICAgIGRvbmVFdmVudCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25QbGF5KCkge1xuICAgIGNsZWFyVGltZW91dChwYXVzZVRpbWVyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUGF1c2UoKSB7XG4gICAgaWYgKCF2aWV3ZXJQYXVzZWQpIHtcbiAgICAgIC8vIHVzZXIgaGFzIHBhdXNlZCwgc2V0IGEgdGltZXIgdG8gcGxheSBhZ2FpblxuICAgICAgY2xlYXJUaW1lb3V0KHBhdXNlVGltZXIpO1xuXG4gICAgICBwYXVzZVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gY29udGludWUgcGxheWluZyB0aGUgY3VycmVudCB2aWRlb1xuICAgICAgICBqd3BsYXllcigpLnBsYXkoKTtcblxuICAgICAgICAvLyB3b3JrYXJvdW5kIGZvciBjb250cm9scyByZW1haW5pbmcgdmlzaWJsZSwgdHVybiB0aGVtIG9mZiBhbmQgb24gYWdhaW5cbiAgICAgICAgandwbGF5ZXIoKS5zZXRDb250cm9scyhmYWxzZSk7XG4gICAgICAgIGp3cGxheWVyKCkuc2V0Q29udHJvbHModHJ1ZSk7XG5cbiAgICAgIH0sIHBhdXNlRHVyYXRpb24gKiAxMDAwKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvblBsYXllckVycm9yKGVycm9yKSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBlcnJvckV2ZW50KHtcbiAgICAgICAgdHlwZTogXCJ2aWRlb1wiLFxuICAgICAgICBpbmRleDogandwbGF5ZXIoKS5nZXRQbGF5bGlzdEluZGV4KClcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU2V0dXBFcnJvcihlcnJvcikge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgZXJyb3JFdmVudCh7XG4gICAgICAgIHR5cGU6IFwic2V0dXBcIixcbiAgICAgICAgaW5kZXg6IDBcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHRoaXMubG9hZFZpZGVvID0gZnVuY3Rpb24oKSB7XG4gICAgandwbGF5ZXIoXCJwbGF5ZXJcIikuc2V0dXAoe1xuICAgICAgcGxheWxpc3Q6IGdldFBsYXlsaXN0KCksXG4gICAgICB3aWR0aCA6IHdpZHRoLFxuICAgICAgaGVpZ2h0IDogaGVpZ2h0LFxuICAgICAgY29udHJvbHM6ICFhdXRvUGxheSxcbiAgICAgIHN0cmV0Y2hpbmcgOiBzY2FsZVRvRml0ID8gXCJ1bmlmb3JtXCIgOiBcIm5vbmVcIlxuICAgIH0pO1xuXG4gICAgandwbGF5ZXIoKS5vblNldHVwRXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICBvblNldHVwRXJyb3IoZXJyb3IpO1xuICAgIH0pO1xuXG4gICAgandwbGF5ZXIoKS5vblJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyXCIpLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKSxcbiAgICAgICAgdG90YWwgPSBlbGVtZW50cy5sZW5ndGgsXG4gICAgICAgIGk7XG5cbiAgICAgIC8vIFdvcmthcm91bmQgZm9yIENocm9tZSBBcHAgUGxheWVyIDx3ZWJ2aWV3PiBub3QgaGFuZGxpbmcgQ1NTMyB0cmFuc2l0aW9uXG4gICAgICBmb3IgKGkgPSAwOyBpIDwgdG90YWw7IGkgKz0gMSkge1xuICAgICAgICBlbGVtZW50c1tpXS5jbGFzc05hbWUgKz0gXCIgbm90cmFuc2l0aW9uXCI7XG4gICAgICB9XG5cbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyXCIpLmNsYXNzTmFtZSArPSBcIiBub3RyYW5zaXRpb25cIjtcblxuICAgICAgandwbGF5ZXIoKS5zZXRNdXRlKGZhbHNlKTtcbiAgICAgIGp3cGxheWVyKCkuc2V0Vm9sdW1lKHZvbHVtZSk7XG5cbiAgICAgIGp3cGxheWVyKCkub25QbGF5bGlzdENvbXBsZXRlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb25QbGF5bGlzdENvbXBsZXRlKCk7XG4gICAgICB9KTtcblxuICAgICAgandwbGF5ZXIoKS5vblBhdXNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb25QYXVzZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGp3cGxheWVyKCkub25QbGF5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb25QbGF5KCk7XG4gICAgICB9KTtcblxuICAgICAgandwbGF5ZXIoKS5vbkVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBvblBsYXllckVycm9yKGVycm9yKTtcbiAgICAgIH0pO1xuXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVhZHlFdmVudCgpO1xuICAgICAgfSwgMjAwKTtcblxuICAgIH0pO1xuICB9O1xuXG4gIHRoaXMucGxheSA9IGZ1bmN0aW9uKCkge1xuICAgIHZpZXdlclBhdXNlZCA9IGZhbHNlO1xuICAgIGlmIChhdXRvUGxheSkge1xuICAgICAgandwbGF5ZXIoKS5wbGF5KCk7XG4gICAgfVxuICB9O1xuXG4gIHRoaXMucGF1c2UgPSBmdW5jdGlvbigpIHtcbiAgICB2aWV3ZXJQYXVzZWQgPSB0cnVlO1xuICAgIGNsZWFyVGltZW91dChwYXVzZVRpbWVyKTtcbiAgICBqd3BsYXllcigpLnBhdXNlKCk7XG4gIH07XG5cbiAgdGhpcy5zdG9wID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wYXVzZSgpO1xuICB9O1xuXG4gIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24oKSB7XG4gICAgdmlld2VyUGF1c2VkID0gZmFsc2U7XG4gICAgandwbGF5ZXIoKS5yZW1vdmUoKTtcbiAgfTtcblxufVxuXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uVmlkZW9Gb2xkZXIgPSBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyIHx8IHt9O1xuXG5SaXNlVmlzaW9uLlZpZGVvRm9sZGVyLlRlbXBsYXRlID0gKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIFRFTVBMQVRFID0gXCJcIiArXG4gICAgXCI8aHRtbD5cIiArXG4gICAgXCI8aGVhZD5cIiArXG4gICAgXCI8bWV0YSBodHRwLWVxdWl2PVxcXCJjb250ZW50LXR5cGVcXFwiIGNvbnRlbnQ9XFxcInRleHQvaHRtbDsgY2hhcnNldD1VVEYtOFxcXCI+XCIgK1xuICAgIFwiPHRpdGxlPjwvdGl0bGU+XCIgK1xuICAgIFwiPHNjcmlwdCB0eXBlPVxcXCJ0ZXh0L2phdmFzY3JpcHRcXFwiIHNyYz1cXFwiLy9zMy5hbWF6b25hd3MuY29tL3Jpc2UtY29tbW9uL3NjcmlwdHMvanctcGxheWVyL2p3cGxheWVyLmpzXFxcIj48L3NjcmlwdD5cIiArXG4gICAgXCI8c2NyaXB0Pmp3cGxheWVyLmtleT1cXFwieEJYeVV0QUorYnJGendjMmtOaERnL1NxazhXN3Jta3RBWWxpWUh6Vmd4bz1cXFwiPC9zY3JpcHQ+XCIgK1xuICAgIFwiPHNjcmlwdCB0eXBlPVxcXCJ0ZXh0L2phdmFzY3JpcHRcXFwiIHNyYz1cXFwianMvcGxheWVyLm1pbi5qc1xcXCI+PC9zY3JpcHQ+XCIgK1xuICAgIFwiPHN0eWxlPlwiICtcbiAgICBcIlx0Ym9keSB7IFwiICtcbiAgICBcIlx0XHRiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsgXCIgK1xuICAgIFwiXHRcdC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7IFwiICtcbiAgICBcIlx0XHQtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOyBcIiArXG4gICAgXCJcdFx0LWtodG1sLXVzZXItc2VsZWN0OiBub25lOyBcIiArXG4gICAgXCJcdFx0dXNlci1zZWxlY3Q6IG5vbmU7IFwiICtcbiAgICBcIlx0fVwiICtcbiAgICBcIiAubm90cmFuc2l0aW9uIHsgXCIgK1xuICAgIFwiICAgLXdlYmtpdC10cmFuc2l0aW9uOiBub25lICFpbXBvcnRhbnQ7IFwiICtcbiAgICBcIiAgIHRyYW5zaXRpb246IG5vbmUgIWltcG9ydGFudDsgXCIgK1xuICAgIFwiIH1cIiArXG4gICAgXCI8L3N0eWxlPlwiICtcbiAgICBcIjwvaGVhZD5cIiArXG4gICAgXCI8Ym9keSBzdHlsZT1cXFwibWFyZ2luOjBweDtcXFwiPlwiICtcbiAgICBcIjxkaXYgaWQ9XFxcInBsYXllclxcXCI+TG9hZGluZyB0aGUgcGxheWVyLi4uPC9kaXY+XCIgK1xuICAgIFwiPHNjcmlwdCBsYW5ndWFnZT1cXFwiamF2YXNjcmlwdFxcXCI+XCIgK1xuICAgIFwiXHR3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uKCkge1wiICtcbiAgICBcIlx0XHRyZXR1cm4gZmFsc2U7XCIgK1xuICAgIFwiXHR9O1wiICtcbiAgICBcIlx0dHJ5IHtcIiArXG4gICAgXCJcdFx0cGxheWVyID0gbmV3IFBsYXllckpXKCk7XCIgK1xuICAgIFwiXHRcdGxvYWRWaWRlbyhcXFwiJXMxXFxcIiwgXFxcIiVzMlxcXCIsICVzMywgJXM0LCAlczUsICVzNiwgXFxcIiVzN1xcXCIpO1wiICtcbiAgICBcIlx0fSBjYXRjaCAoZSkge1wiICtcbiAgICBcIlx0XHRjb25zb2xlLmxvZyhlLm1lc3NhZ2UpO1wiICtcbiAgICBcIlx0XHRwYXJlbnQuUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wbGF5ZXJFcnJvcigpO1wiICtcbiAgICBcIlx0fVwiICtcbiAgICBcIjwvc2NyaXB0PlwiICtcbiAgICBcIjwvYm9keT5cIiArXG4gICAgXCI8L2h0bWw+XCI7XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBnZXRIVE1MKHBhcmFtcywgZmlsZXMpIHtcbiAgICB2YXIgaHRtbFN0cmluZyA9IFRFTVBMQVRFO1xuXG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzMVwiLCBwYXJhbXMud2lkdGggKyBcInB4XCIpO1xuICAgIGh0bWxTdHJpbmcgPSBodG1sU3RyaW5nLnJlcGxhY2UoXCIlczJcIiwgcGFyYW1zLmhlaWdodCArIFwicHhcIik7XG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzM1wiLCBwYXJhbXMudmlkZW8udm9sdW1lKTtcbiAgICBodG1sU3RyaW5nID0gaHRtbFN0cmluZy5yZXBsYWNlKFwiJXM0XCIsIHBhcmFtcy52aWRlby5hdXRvcGxheSk7XG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzNVwiLCBwYXJhbXMudmlkZW8uc2NhbGVUb0ZpdCk7XG4gICAgaHRtbFN0cmluZyA9IGh0bWxTdHJpbmcucmVwbGFjZShcIiVzNlwiLCBwYXJhbXMucGF1c2UpO1xuICAgIGh0bWxTdHJpbmcgPSBodG1sU3RyaW5nLnJlcGxhY2UoXCIlczdcIiwgZmlsZXMuam9pbigpKTtcblxuICAgIHJldHVybiBodG1sU3RyaW5nO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImdldEhUTUxcIjogZ2V0SFRNTFxuICB9O1xuXG59KSgpO1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cywgUmlzZVZpc2lvbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIGlkID0gcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uVmlkZW9Gb2xkZXIucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLlZpZGVvRm9sZGVyLnN0b3AoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBvbHltZXJSZWFkeSgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBvbHltZXItcmVhZHlcIiwgcG9seW1lclJlYWR5KTtcblxuICAgIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wbGF5X1wiICsgaWQsIHBsYXkpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG5cbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgUmlzZVZpc2lvbi5WaWRlb0ZvbGRlci5zZXRBZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2x5bWVyLXJlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbn0pKHdpbmRvdywgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTQnXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9